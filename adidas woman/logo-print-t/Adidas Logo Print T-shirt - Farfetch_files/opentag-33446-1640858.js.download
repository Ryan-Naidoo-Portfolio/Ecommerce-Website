/*
 * Opentag, a tag deployment platform
 * Copyright 2011-2016, Qubit Group
 * http://opentag.qubitproducts.com
 */
(function(){var globalScope=function(){return this}();globalScope.qubit=globalScope.qubit||{};globalScope.qubit.SYSTEM_DEFAULTS={pingServerUrl:"opentag-stats.qubit.com/ping",tellLoadTimesProbability:1}})();
(function(){var ClientConfig={"id":"33446"};try{var global=function(){return this}();if(!global.qubit)global.qubit={};var qubit=global.qubit;if(!qubit.cs)qubit.cs={};qubit.CLIENT_CONFIG=ClientConfig;var cid=ClientConfig.id||"efault";cid="d"+cid;if(!qubit.cs[cid])qubit.cs[cid]={};qubit.cs[cid].ClientConfig=ClientConfig;if(qubit.SYSTEM_DEFAULTS)qubit.cs[cid].SystemDefaults=qubit.SYSTEM_DEFAULTS}catch(e){}})();
(function(){(function(){function getUV(){return global$$0.uv}function initiate(){var uv=getUV();if(!uv||!uv.emit)return false;if(!inititated){inititated=true;for(var i=0;i<unqueuedEvents.length;i++){var tmp=unqueuedEvents[i];if(tmp.on)uv.on.apply(uv,tmp.on);else if(tmp.emit)uv.emit.apply(uv,tmp.emit)}uv.on(/.*/,function(event){var type=event.meta.type;var obj=allEventsByType[type];if(!obj)allEventsByType[type]={current:event,history:[event]};else{obj.current=event;obj.history.push(event)}}).replay();
inititatedSuccessfully=true}return true}(function(){if(!Function.prototype.bind)Function.prototype.bind=function(oThis){if(typeof this!=="function")throw new TypeError("Function.prototype.bind - what is trying "+"to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1);var fToBind=this;var FNOP=function(){};var fBound=function(){return fToBind.apply(this instanceof FNOP?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};FNOP.prototype=this.prototype;fBound.prototype=
new FNOP;return fBound}})();var PKG_ROOT={__anonymous__:true};var GLOBAL=null;try{GLOBAL=(false||eval)("this")}catch(e){}if(!GLOBAL)try{var that=function(){return this};GLOBAL=that()}catch(ex){}PKG_ROOT=GLOBAL;var qubit=PKG_ROOT.qubit||{};if(!PKG_ROOT.qubit)PKG_ROOT.qubit=qubit;var qversion="3.3.2";if(qubit.VERSION&&qubit.VERSION!==qversion)try{console.warn("There is already 'qubit.VERSION' set to: "+qubit.VERSION)}catch(ex){}qubit.VERSION=qversion;try{if(typeof module==="object")module.exports=PKG_ROOT}catch(e){}var EMPTY_FUN=
function(){};var UNDEF;(function(){function Define(){}function _namespace(path,instance,pckg,noOverride,isGlobal){var files=path.split(".");var current=Define.NAMESPACE_BASE||PKG_ROOT;var last=null;var lastName=null;var i;if(isGlobal)current=GLOBAL;var root=current;current=pckg||current;for(i=0;i<files.length-1;i+=1){last=current;lastName=files[i];current[lastName]=current[lastName]||{};current=current[lastName]}last=current;lastName=files[files.length-1];if(GLOBAL.TAGSDK_NS_OVERRIDE)noOverride=false;
if(GLOBAL.TAGSDK_NS_FORCED_OVERRIDE_OPTION!==undefined)noOverride=!GLOBAL.TAGSDK_NS_FORCED_OVERRIDE_OPTION;if(instance!==undefined){if(last[lastName]===undefined||!noOverride)last[lastName]=instance}else last[lastName]=last[lastName]||{};if(instance){instance.CLASSPATH=files.join(".");files.splice(files.length-1,1);instance.PACKAGE_NAME=files.join(".")}return{root:root,object:last,instance:last[lastName]}}Define.global=function(){return GLOBAL};Define.STANDARD_CS_NS="qubit.cs";Define.clientSpaceClasspath=
function(){if(window.qubit.CLIENT_CONFIG)return"qubit.cs.d"+window.qubit.CLIENT_CONFIG.id;return Define.STANDARD_CS_NS};Define.globalNamespace=function(path,instance,pckg,noOverride){return _namespace(path,instance,pckg,noOverride,true)};Define.namespace=function(path,instance,pckg,noOverride){return _namespace(path,instance,pckg,noOverride,false)};Define.clientNamespace=function(path,instance,pckg,noOverride){return Define.namespace(Define.clientSpaceClasspath()+"."+path,instance,pckg,noOverride)};
Define.clazz=function(path,Class,SuperClass,pckg,config){Define.namespace(path,Class,pckg,true);if(typeof SuperClass==="function"){Class.SUPER=SuperClass;Class.superclass=SuperClass;Class.prototype=new SuperClass(config);Class.prototype.SUPER=SuperClass;Class.prototype.CLASS=Class}var names=path.split(".");if(Class.prototype){Class.prototype.CLASSPATH=names.join(".");Class.prototype.CLASS_NAME=names[names.length-1];names.splice(names.length-1,1);Class.prototype.PACKAGE_NAME=names.join(".")}else{Class.CLASSPATH=
names.join(".");Class.STATIC_NAME=names[names.length-1];names.splice(names.length-1,1);Class.PACKAGE_NAME=names.join(".")}return Class};Define.clazz("qubit.Define",Define);Define.clientClazz=function(path,Class,SuperClass,pckg,config){return Define.clazz(Define.clientSpaceClasspath()+"."+path,Class,SuperClass,pckg,config)};Define.STANDARD_VS_NS="qubit.vs";Define.vendorsSpaceClasspath=function(path){var cp=qubit.VENDOR_SPACE_CP;var result=cp===undefined||cp===null?Define.STANDARD_VS_NS:cp;if(path)if(result)return result+
"."+path;else return path;return result};var nsTmp=Define.vendorsSpaceClasspath();var _vspace;if(nsTmp)_vspace=Define.namespace(nsTmp,{},null,true).instance;else _vspace=Define.global();Define.getVendorSpace=function(){return _vspace};Define.vendorNamespace=function(path,instance,pckg,noOverride){path=Define.vendorsSpaceClasspath(path);return Define.namespace(path,instance,pckg,noOverride)};Define.vendorClazz=function(path,Class,SuperClass,pckg,config){path=Define.vendorsSpaceClasspath(path);return Define.clazz(path,
Class,SuperClass,pckg,config)}})();(function(){function Cookie(config){}var cookieAlphabet="abcdefghijklmnopqrstuvwxyz"+"0123456789"+"ABCDEFGHIJKLMNOPQRSTUVWXYZ"+"*!-#$\x26+()@"+"'%./:\x3c\x3e?["+'"]^_`{|}~'+"\\"+";\x3d";var cookieAlphabetMap={};for(var i$$0=0;i$$0<cookieAlphabet.length;i$$0++)cookieAlphabetMap[cookieAlphabet.charAt(i$$0)]=i$$0;qubit.Define.clazz("qubit.Cookie",Cookie);Cookie.cookieAlphabet=cookieAlphabet;Cookie.cookieAlphabetMap=cookieAlphabetMap;Cookie.decode=function(string){return unescape(string)};
Cookie.encode=function(string){return escape(string)};Cookie.set=function(name,value,days,domain,notEncoded){var expires;if(days){var date=new Date;date.setTime(date.getTime()+days*24*60*60*1E3);expires="; expires\x3d"+date.toGMTString()}else expires="";if(!notEncoded){name=Cookie.encode(name);value=Cookie.encode(value)}var cookie=name+"\x3d"+value+expires+"; path\x3d/;";if(domain)cookie+=" domain\x3d"+domain;document.cookie=cookie};var CHUNKS_CACHED;var COOKIE_CACHE={};Cookie.resetCache=function(){CHUNKS_CACHED=
null;COOKIE_CACHE={}};Cookie.getCached=function(name,notDecoded){var cachedName=name+"\x3d"+!!notDecoded;if(COOKIE_CACHE[cachedName]!==undefined)return COOKIE_CACHE[cachedName];var part=name+"\x3d";if(!CHUNKS_CACHED)CHUNKS_CACHED=document.cookie.split(";");for(var i=0;i<CHUNKS_CACHED.length;i++){for(var chunk=CHUNKS_CACHED[i];chunk.charAt(0)===" ";)chunk=chunk.substring(1,chunk.length);if(chunk.indexOf(part)===0){var tmp=chunk.substring(part.length,chunk.length);if(!notDecoded)tmp=Cookie.decode(tmp);
COOKIE_CACHE[cachedName]=tmp;return tmp}}COOKIE_CACHE[cachedName]=null;return null};Cookie.get=function(name,notDecoded){var part=name+"\x3d";var chunks=document.cookie.split(";");for(var i=0;i<chunks.length;i++){for(var chunk=chunks[i];chunk.charAt(0)===" ";)chunk=chunk.substring(1,chunk.length);if(chunk.indexOf(part)===0){var tmp=chunk.substring(part.length,chunk.length);if(!notDecoded)tmp=Cookie.decode(tmp);return tmp}}return null};Cookie.getAllForName=function(name,decoded){if(!name)return[];
var part=name+"\x3d";var chunks=document.cookie.split(";");var cookies=[];for(var i=0;i<chunks.length;i++){for(var chunk=chunks[i];chunk.charAt(0)===" ";)chunk=chunk.substring(1,chunk.length);if(chunk.indexOf(part)===0){var tmp=chunk.substring(part.length,chunk.length);if(decoded)tmp=Cookie.decode(tmp);cookies.push(tmp)}}return cookies};Cookie.getAll=function(decoded){var chunks=document.cookie.split(";");var cookies=[];for(var i=0;i<chunks.length;i++){for(var chunk=chunks[i];chunk.charAt(0)===" ";)chunk=
chunk.substring(1,chunk.length);var name=chunk.substring(0,chunk.indexOf("\x3d"));var tmp=chunk.substring(name.length+1,chunk.length);if(decoded)tmp=Cookie.decode(tmp);cookies.push([name,tmp])}return cookies};Cookie.rm=function(name,domain){Cookie.set(name,"",-1,domain)}})();(function(){function Log(prefix,clazz,collectLocally){this.collectLogs=!!Log.isCollecting();this.collectLocally=collectLocally;this.collection=[];this.getPrefix=function(){var clz="";if(clazz){if(typeof clazz==="function")clz=
clazz(this.ref);else if(clazz.CLASS_NAME)clz=clazz.CLASS_NAME;else if(clazz.constructor&&clazz.constructor.name)clz=clazz.constructor.name;if(clz)clz+=" -\x3e "}return(prefix||"")+clz}}function logger(log,prefix,type,message,plain,style,plainStyle,level){var toPrint;var pass=LEVEL>=level;if(Log.getCollectLevel()>=0||pass){if(plain)toPrint=[message,plainStyle,type];else toPrint=[prefix+log.getPrefix()+message,style,type];toPrint[3]=level;log.collect(toPrint,level);if(pass)log.printMessage.apply(log,
toPrint)}}var Define=qubit.Define;var _console=null;Define.clazz("qubit.opentag.Log",Log);Log.LEVEL_FINEST=4;Log.LEVEL_FINE=3;Log.LEVEL_INFO=2;Log.LEVEL_WARN=1;Log.LEVEL_ERROR=0;Log.LEVEL_NONE=-1;Log.MAX_LOG_LEN=1E4;Log.prototype.MAX_LOG_LEN=-1;var LEVEL=Log.LEVEL_NONE;var COLLECT_LEVEL=Log.LEVEL_NONE;var COLLECT=true;Log.setLevelFromCookie=function(){var cookieLevel=qubit.Cookie.get("qubit.opentag.Log.LEVEL");if(cookieLevel){cookieLevel=+cookieLevel;if(!isNaN(cookieLevel))if(cookieLevel>0){var fine=
Log.LEVEL_FINE;Log.setCollectLevel(cookieLevel>fine?cookieLevel:fine);Log.setLevel(+cookieLevel)}}};Log.setCollecting=function(isCollecting){COLLECT=!!isCollecting};Log.isCollecting=function(){return COLLECT||Log.COLLECT};Log.setLevel=function(level){LEVEL=+level};Log.setCollectAndLevel=function(level){Log.setLevel(level);Log.setCollectLevel(level)};Log.getLevel=function(){return LEVEL};Log.setCollectLevel=function(level){COLLECT_LEVEL=+level};Log.getCollectLevel=function(){return COLLECT_LEVEL};
var collection=[];Log.logsCollection=collection;Log.rePrintAll=function(level,delay,noClean,array){var oldLevel=LEVEL;if(level!==undefined)LEVEL=level;try{if(Log.isCollecting()){try{if(!noClean)_console.clear()}catch(ex){}var collection=array||Log.logsCollection;var counter=0;for(var i=0;i<collection.length;i++)(function(j){var log=collection[j];var logLevel=log[3];if(logLevel!==undefined&&LEVEL>=logLevel){counter++;if(!delay)Log.print.apply(Log,log);else qubit.opentag.Timed.setTimeout(function(){if(level!==
undefined)LEVEL=level;try{Log.print.apply(Log,log)}finally{LEVEL=oldLevel}},counter*delay)}})(i)}}catch(ex){}finally{LEVEL=oldLevel}};var tmp=Define.global();var isStylingSupported=!!(tmp.webkitMediaStream||tmp.webkitURL||tmp.mozContact);Log.isStyleSupported=function(){return isStylingSupported};var altConsole={};Log.setConsole=function(xconsole){_console=xconsole||altConsole;return _console};Log.delayPrint=-1;var _last_run=(new Date).valueOf();Log.prototype.printMessage=function(message,style,type,
level){if(Log.delayPrint>0){var delay=Log.delayPrint;var ago=_last_run-(new Date).valueOf();if(ago>0)delay+=ago;try{qubit.opentag.Timed.setTimeout(function(){this.print(message,style,type,level)}.bind(this),delay)}catch(e){setTimeout(function(){this.print(message,style,type,level)}.bind(this),delay)}_last_run=(new Date).valueOf()+delay}else this.print(message,style,type,level)};Log.prototype.print=function(message,style,type,level){Log.print(message,style,type,level)};Log.print=function(message,style,
type,level){if(level!==undefined&&LEVEL<level)return;try{if(_console&&_console.log)if(style&&Log.isStyleSupported())if(type&&_console[type])_console[type]("%c"+message,style);else _console.log("%c"+message,style);else if(type&&_console[type])_console[type](message);else _console.log(message)}catch(ex){}};Log.prototype.collect=function(toPrint,level){if(level===undefined)level=Log.getCollectLevel();var collected=false;var collectingGlobally=this.collectLogs&&Log.isCollecting()&&Log.getCollectLevel()>=
+level;if(collectingGlobally){collection.push(toPrint);collected=true}if(this.collectLocally&&collectingGlobally){this.collection.push(toPrint);collected=true}if(Log.MAX_LOG_LEN>0)if(collection.length>Log.MAX_LOG_LEN)collection.splice(0,collection.length-Log.MAX_LOG_LEN);if(Log.MAX_LOG_LEN>0||this.MAX_LOG_LEN>0){var len=Log.MAX_LOG_LEN;if(this.MAX_LOG_LEN>0)len=this.MAX_LOG_LEN;if(this.collection.length>len)this.collection.splice(0,this.collection.length-len)}return collected?toPrint:null};Log.clearAllLogs=
function(){try{_console.clear()}catch(e){}finally{collection.splice(0,collection.length)}};Log.getCollectedByLevel=function(level,altCollection){altCollection=altCollection||collection;var results=[];for(var i=0;i<altCollection.length;i++){var log=altCollection[i];var msg=log[0];var lvl=msg[4];if(lvl===level)results.push(log)}return results};Log.prototype.rePrint=function(level,delay,clean){Log.rePrintAll(level,delay,!clean,this.collection)};Log.prototype.FINEST=function(message,plain){logger(this,
"FINEST: ",false,message,plain,"color:#CCCCCC;",false,Log.LEVEL_FINEST)};Log.prototype.FINE=function(message,plain){logger(this,"FINE: ",false,message,plain,"color:#999999;",false,Log.LEVEL_FINE)};Log.prototype.INFO=function(message,plain,style){logger(this,"INFO: ","info",message,plain,style,style,Log.LEVEL_INFO)};Log.prototype.WARN=function(message,plain){logger(this,"WARN: ","warn",message,plain,"color:#26A110;",false,Log.LEVEL_WARN)};Log.prototype.ERROR=function(message,plain){logger(this,"ERROR: ",
"error",message,plain,"color:red;",false,Log.LEVEL_ERROR)};Log.setConsole(Define.global().console);Log.setLevelFromCookie()})();(function(){function addAnonymousAcessor(obj){return Utils.addToArrayIfNotExist(Utils.ANON_VARS,obj)}function escapeRegExp(string){return string.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function existsInPath(object,copy){var len=travelArray.length;for(var i=0;i<len;i++)if(object===travelArray[i][0])return travelArray[i][1];travelArray[travelArray.length]=[object,copy];
return false}function _objectCopy(obj,cfg,maxDeep,start,parentObj){var nodes=false;var noOwn=false;var noFunctions=false;var win=false;var all=false;var copyReference=false;var emptyForMaxDeep=false;if(cfg){all=!!cfg.all;nodes=all||cfg.nodes;win=all||cfg.win;noOwn=all;emptyForMaxDeep=!!cfg.emptyForMaxDeep;noFunctions=cfg.noFunctions&&!all;if(cfg.noOwn!==undefined)noOwn=!!cfg.noOwn;if(cfg.noFunctions!==undefined)noFunctions=!!cfg.noFunctions;if(cfg.win!==undefined)win=!!cfg.win;if(cfg.nodes!==undefined)nodes=
!!cfg.nodes;copyReference=!!cfg.copyReference}if(maxDeep!==undefined&&!maxDeep){if(emptyForMaxDeep)return;return obj}else if(maxDeep!==undefined)maxDeep--;if(!obj||!(obj instanceof Object))return obj;if(!nodes){try{if(obj instanceof Node)return obj}catch(ie){if(obj instanceof ActiveXObject&&obj.nodeType!==undefined)return obj}if(obj===document)return obj}if(!win)if(obj===global)return obj;var copy=obj instanceof Array?[]:{};if(obj instanceof Date)copy=new Date(obj);if(!noFunctions&&obj instanceof
Function){var funStr=String(obj).replace(/\s+/g,"");if(funStr.indexOf("{[nativecode]}")+14===funStr.length)copy=function(){return obj.apply(parentObj||this,arguments)};else copy=function(){return obj.apply(this,arguments)}}if(start===undefined){travelArray=[];start=0}var existingCopy=existsInPath(obj,copy);if(existingCopy)return existingCopy;var i;if(copy instanceof Array)for(i=0;i<obj.length;i++)if(obj[i]===obj[i])copy[copy.length]=_objectCopy(obj[i],cfg,maxDeep,start+1,obj);else copy[copy.length]=
obj[i];else{i=0;for(var prop in obj){if(noOwn||obj.hasOwnProperty(prop))if(obj[prop]===obj[prop])copy[prop]=_objectCopy(obj[prop],cfg,maxDeep,start+1,obj);else copy[prop]=obj[prop];i++}}if(cfg.proto)copy.prototype=_objectCopy(obj.prototype,cfg,maxDeep,start+1,obj);if(copyReference)copy.___copy_ref=obj;return copy}function existsInTraversePath(object,max){for(var i=0;i<max&&i<traverseArray.length;i++)if(object===traverseArray[i])return true;return false}function _traverse(obj,exe,cfg,start,parent,
prop,trackPath,maxDeep){cfg=cfg||{};if(cfg.hasOwn===undefined)cfg.hasOwn=true;if(cfg.objectsOnly&&!(obj instanceof Object))return;if(maxDeep!==undefined&&!maxDeep)return;else if(maxDeep!==undefined)maxDeep--;if(!cfg||!cfg.nodes)try{if(obj instanceof Node)return}catch(ie){if(obj instanceof ActiveXObject&&obj.nodeType!==undefined)return}if(obj===global)return;if(start===undefined){traverseArray=[];start=0}if(existsInTraversePath(obj,start))return;traverseArray[start]=obj;parent=parent||obj;if(parent&&
prop&&parent[prop]!==parent[prop])return;var stopHere=exe(obj,parent,prop,trackPath);if(stopHere)return;var i=0;var objPath="";for(var pprop in obj){if(!cfg.hasOwn||obj.hasOwnProperty(pprop))try{var object=obj[pprop];if(cfg.track)objPath=trackPath?trackPath+"."+pprop:pprop;_traverse(object,exe,cfg,start+1,parent,pprop,objPath,maxDeep)}catch(e){}i++}}var Define=qubit.Define;var Cookie=qubit.Cookie;var Utils=function(){};var global=Define.global();Define.clazz("qubit.opentag.Utils",Utils);Utils.global=
Define.global;Utils.namespace=Define.namespace;Utils.clazz=Define.clazz;Utils.getObjectUsingPath=function(path,base){base=base||global;var parts=path.split(".");for(var i=0;i<parts.length;i++)if(base&&parts[i])base=base[parts[i]];return base};Utils.getParentObject=function(name){var idx=name.lastIndexOf(".");var path=name.substring(0,idx);return Utils.getObjectUsingPath(path)};Utils.variableExists=function(value){return value!==undefined&&value!==null};Utils.ANON_VARS=[];Utils.getAnonymousAcessor=
function(obj){var index=Utils.indexInArray(obj,Utils.ANON_VARS);if(index===-1)index=addAnonymousAcessor(obj);return"qubit.opentag.Utils.ANON_VARS["+index+"]"};Utils.replaceAll=function(string,pattern,replace){return string.replace(new RegExp(escapeRegExp(pattern),"g"),replace)};Utils.secureText=function(string){if(typeof string!=="string")string+="";string=string.replace(/</g,"\x26lt;");string=string.replace(/>/g,"\x26gt;");return string};Utils.getUrl=function(){return document.location.href};Utils.getQueryParam=
function(param){var i;var ii;var params;var url;var query;var queries;var splitQuery;url=Utils.getUrl();if(url.indexOf("?")>0){queries=url.substring(url.indexOf("?")+1).split("\x26");for(i=0,ii=queries.length;i<ii;i+=1){query=queries[i];if(query.indexOf("\x3d")>0){splitQuery=query.split("\x3d");if(splitQuery.length===2&&splitQuery[0]===param)return splitQuery[1]}}}return null};Utils.getElementValue=function(elementId){var el=document.getElementById(elementId);if(el)return el.textContent||el.innerText;
return null};var travelArray=[];Utils.objectCopy=function(obj,cfg){cfg=cfg||{};var res=_objectCopy(obj,cfg,cfg.maxDeep);travelArray=[];return res};var traverseArray=[];Utils.traverse=function(obj,exe,cfg){var u;_traverse(obj,exe,cfg,u,u,u,u,cfg.maxDeep)};Utils.prepareQuotedString=function(string){if(typeof string==="string")return'"'+string.replace(/\"/g,'\\"')+'"';else return string};Utils.expressionToFunction=function(expr,argzString){argzString=argzString||"";var funTemplate="function ("+argzString+
") {"+expr+"}";return Utils.gevalAndReturn(funTemplate).result};Utils.defineWrappedClass=function(classPath,extClass,prototypeTemplate,pckg,constr){var clazz=function(){if(constr)return constr.apply(this,arguments);else return extClass.apply(this,arguments)};Define.clazz(classPath,clazz,extClass,pckg);for(var prop in prototypeTemplate)if(prototypeTemplate.hasOwnProperty(prop)&&prop!=="CONSTRUCTOR")clazz.prototype[prop]=prototypeTemplate[prop];return clazz};Utils.copyAandAddFromB=function(A,B,maxDeep){maxDeep=
maxDeep||8;var copy=this.objectCopy(A,{maxDeep:maxDeep});for(var prop in B)if(B.hasOwnProperty(prop))copy[prop]=B[prop];return copy};Utils.keys=function(obj){if(obj instanceof Object){if(Object.keys)return Object.keys(obj);var keys=[];for(var prop in obj)if(obj.hasOwnProperty(prop))keys[keys.length]=prop;return keys}else throw"keys() called on non-object!";};Utils.getSrcElement=function(evt){var elem;evt=evt||window.event;if(evt.srcElement)elem=evt.srcElement;else if(evt.target)elem=evt.target;return elem};
Utils.addToArrayIfNotExist=function(array,obj,equals){var i=0;for(var exists=false;i<array.length;i+=1){var tmp=equals&&equals(array[i],obj);if(tmp||array[i]===obj){exists=true;break}}if(!exists){array[array.length]=obj;i=-1}return i};Utils.indexInArray=function(array,obj){for(var i=0;i<array.length;i++)if(array[i]===obj)return i;return-1};Utils.existsInArray=function(array,obj){for(var i=0;i<array.length;i++)if(array[i]===obj)return true;return false};Utils.removeFromArray=function(array,obj){var i=
0;for(var total=0;i<array.length;)if(array[i]===obj){array.splice(i,1);total++}else i++;return total};Utils.addClass=function(node,name){var classes;try{node.classList.add(name)}catch(ex){if(node.className===null){node.className=name;return}classes=node.className.split(" ");Utils.addToArrayIfNotExist(classes,name);node.className=classes.join(" ")}};Utils.removeClass=function(node,name){var classes;try{node.classList.remove(name)}catch(ex){if(node.className===null){node.className="";return}classes=
node.className.split(" ");Utils.removeFromArray(classes,name);node.className=classes.join(" ")}};var prefix="try{this.qubitopentagutilsgevalandreturn__var_test__\x3d(";var suffix=");}catch(ex){"+"this.qubitopentagutilsgevalandreturn__var_test__error \x3d ex;}";Utils.gevalAndReturn=function(expression){var G=GLOBAL;G.qubitopentagutilsgevalandreturn__var_test__=undefined;G.qubitopentagutilsgevalandreturn__var_test__error=undefined;expression=prefix+expression+suffix;Utils.geval(expression);var res=
G.qubitopentagutilsgevalandreturn__var_test__;var err=G.qubitopentagutilsgevalandreturn__var_test__error;try{G.qubitopentagutilsgevalandreturn__var_test__=UNDEF;G.qubitopentagutilsgevalandreturn__var_test__error=UNDEF;delete G.qubitopentagutilsgevalandreturn__var_test__;delete G.qubitopentagutilsgevalandreturn__var_test__error}catch(ex){}return{result:res,error:err}};Utils.trim=function(string){try{return String(string).trim()}catch(noTrim){return String(string).replace(/^\s+|\s+$/g,"")}};Utils.setIfUnset=
function(obj,src){if(obj&&src)for(var prop in src)if(src.hasOwnProperty(prop)&&!obj.hasOwnProperty(prop))obj[prop]=src[prop]};var rndSeed=Math.floor(Math.random()*1E12);Utils.UUID=function(){if(!global.__qubit_uuid_cnt_43567bdfhgtb4vt5yeh978__)global.__qubit_uuid_cnt_43567bdfhgtb4vt5yeh978__=(new Date).valueOf();return rndSeed+"."+ ++global.__qubit_uuid_cnt_43567bdfhgtb4vt5yeh978__};Utils.overrideFromLeftToRight=function(A,B){if(A&&B)for(var prop in B)if(B.hasOwnProperty(prop))A[prop]=B[prop];return A};
Utils.geval=function(expression){if(window&&window.execScript)return window.execScript(expression===""?" ":expression);else return function(){return global["eval"].call(global,expression)}()};var _availStack=[];Utils.bodyAvailable=function(callback){var avail=!!document.body;if(avail){if(_availStack){for(var i=0;i<_availStack.length;i++)try{_availStack[i]()}catch(ex){}_availStack=false}callback()}else _availStack.push(callback)};Utils.rmCookiesMatching=function(string){var cookies=Cookie.getAll();
for(var i=0;i<cookies.length;i++){var name=cookies[i][0];if(name.match(string)===0)Cookie.rm(name)}};var _readyCalls=[];var _loaded=false;var _flushed=false;Utils.bodyReady=function(callback){if(_flushed){if(callback)callback();return true}_loaded=_loaded||!!(document.body&&document.readyState==="complete");if(_loaded){_flushed=true;for(var i=0;i<_readyCalls.length;i++)try{_readyCalls[i]()}catch(ex){}if(callback)callback()}else if(callback)_readyCalls.push(callback);return _loaded};var oldOnload=
global.onload;global.onload=function(e){try{Utils.bodyReady()}catch(ex){try{window.qubit.opentag.Utils.bodyReady()}catch(ex1){}}var oldRef=false;try{oldRef=oldOnload}catch(ex2){}if(oldRef)oldRef(e)};(function(){var DOMContentLoaded;var isReady=false;var readyWait=1;var readyList;var readyComplete;var bindReadyComplete;var doScrollCheck;readyComplete=function(wait){var f;if(wait===true)readyWait-=1;if(!readyWait||wait!==true&&!isReady){if(!document.body)return setTimeout(readyComplete,1);isReady=true;
if(wait!==true){readyWait-=1;if(readyWait>0)return}for(;readyList.length>0;){f=readyList.shift();f()}}};doScrollCheck=function(){if(isReady)return;try{document.documentElement.doScroll("left")}catch(e){setTimeout(doScrollCheck,1);return}readyComplete()};bindReadyComplete=function(){if(readyList)return;readyList=[];if(document.readyState==="complete")return setTimeout(readyComplete,1);if(document.addEventListener){document.addEventListener("DOMContentLoaded",DOMContentLoaded,false);window.addEventListener("load",
readyComplete,false)}else if(document.attachEvent){document.attachEvent("onreadystatechange",DOMContentLoaded);window.attachEvent("onload",readyComplete);var toplevel=false;try{toplevel=window.frameElement===null||window.frameElement===undefined}catch(e){}if(document.documentElement.doScroll&&toplevel)doScrollCheck()}};var ready=function(fn){bindReadyComplete();if(isReady)setTimeout(fn,1);else readyList.push(fn)};if(document.addEventListener)DOMContentLoaded=function(){document.removeEventListener("DOMContentLoaded",
DOMContentLoaded,false);readyComplete()};else if(document.attachEvent)DOMContentLoaded=function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",DOMContentLoaded);readyComplete()}};ready(function(){_loaded=true;Utils.bodyReady()})})()})();var JSON={};(function(){function f(n){return n<10?"0"+n:n}function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+
a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function stringifyDate(key){return isFinite(key.valueOf())?key.getUTCFullYear()+"-"+f(key.getUTCMonth()+1)+"-"+f(key.getUTCDate())+"T"+f(key.getUTCHours())+":"+f(key.getUTCMinutes())+":"+f(key.getUTCSeconds())+"Z":null}function str(key,holder){var i;var k;var v;var length;var mind=gap;var partial;var value=holder[key];if(value instanceof Date)value=stringifyDate(value);else if(value instanceof String||value instanceof Number||value instanceof
Boolean)value=value.valueOf();if(typeof rep==="function")value=rep.call(holder,key,value);switch(typeof value){case "string":return quote(value);case "number":return isFinite(value)?String(value):"null";case "boolean":case "null":return String(value);case "object":if(!value)return"null";gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1)try{partial[i]=str(i,value)||"null"}catch(stackExceeded){partial[i]='{"stack_exceeded": null}'}v=
partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1)if(typeof rep[i]==="string"){k=rep[i];try{v=str(k,value)}catch(stackExceeded){v='{"stack_exceeded": null}'}if(v)partial.push(quote(k)+(gap?": ":":")+v)}}else for(k in value)if(Object.prototype.hasOwnProperty.call(value,k)){try{v=str(k,value)}catch(stackExceeded){v='{"stack_exceeded": null}'}if(v)partial.push(quote(k)+
(gap?": ":":")+v)}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var gap;var indent;var meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};var rep;
if(typeof JSON.stringify!=="function")JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number")for(i=0;i<space;i+=1)indent+=" ";else if(typeof space==="string")indent=space;rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number"))throw new Error("JSON.stringify");return str("",{"":value})};if(typeof JSON.parse!=="function")JSON.parse=function(text,reviver){function walk(holder,key){var k;var v;var value=
holder[key];if(value&&typeof value==="object")for(k in value)if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined)value[k]=v;else delete value[k]}return reviver.call(holder,key,value)}var j;text=String(text);cx.lastIndex=0;if(cx.test(text))text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse");}})();var q={};q.html=q.html||{};(function(){function trim(text){return text.replace(/^\s+/,"").replace(/\s+$/,"")}var UVListener={callbacks:{},unfired_events:[],early_callbacks:null,currentUV:null};var uv;var uvLocation="universal_variable";var starterId=0;var POLL_DELAY_MS=500;var timer;UVListener._isArray=function(input){return Object.prototype.toString.call(input)===
"[object Array]"};UVListener._targetChanged=function(keyString,old,newObject){var oldAsObject;var oldTarget;var newTarget;if(newObject===null)if(old==="null")return false;else return true;else if(newObject===undefined)if(old===newObject)return false;else return true;else{oldAsObject=JSON.parse(old);oldTarget=UVListener._getNested(oldAsObject,keyString);newTarget=UVListener._getNested(newObject,keyString);return!UVListener._jsonIsEqual(oldTarget,newTarget)}};UVListener._processCallbacks=function(){var i;
if(UVListener.early_callbacks&&UVListener.early_callbacks.length>0){for(i=0;i<UVListener.early_callbacks.length;i+=1)UVListener.push(UVListener.early_callbacks[i]);UVListener.early_callbacks=null}};UVListener._keyStringToArr=function(keyString){keyString=trim(keyString);if(keyString==="")return[];else{keyString=keyString.replace(/\[(\w+)\]/g,".$1");keyString=keyString.replace(/^\./,"");return keyString.split(".")}};UVListener._getNested=function(object,keyString){var arr=UVListener._keyStringToArr(keyString);
for(var n;arr.length>0;){n=arr.shift();if(object.hasOwnProperty(n))object=object[n];else return}return object};UVListener._jsonIsEqual=function(obj1,obj2){if(typeof obj1!=="string")obj1=JSON.stringify(obj1,UVListener._stripEvents);if(typeof obj2!=="string")obj2=JSON.stringify(obj2,UVListener._stripEvents);return obj1===obj2};UVListener._stripEvents=function(key,value){if(key!=="events")return value;else return undefined};UVListener._on=function(type,func){var typeArray;var key;typeArray=type.split(":");
type=typeArray[0];key=typeArray[1];UVListener.callbacks[type]=UVListener.callbacks[type]||[];if(key)UVListener.callbacks[type].push({keyString:key,func:func});else UVListener.callbacks[type].push({func:func})};UVListener._trigger=function(type,data){var i;var keyString;if(UVListener.callbacks[type])for(i=0;i<UVListener.callbacks[type].length;i+=1)if(typeof UVListener.callbacks[type][i].func==="function"){keyString=UVListener.callbacks[type][i].keyString;if(keyString){if(type==="change"&&UVListener._targetChanged(keyString,
UVListener.currentUV,uv))UVListener.callbacks[type][i].func(data)}else UVListener.callbacks[type][i].func(data)}};UVListener._eventsPush=function(evt){var i;var ii;uv.events[uv.events.length]=evt;evt.time=evt.time||(new Date).getTime();if(UVListener.callbacks.event){i=0;ii=UVListener.callbacks.event.length;for(i;i<ii;i+=1)UVListener.callbacks.event[i].func(evt)}evt.has_fired=true};UVListener._getUnfiredEvents=function(){var i=0;for(i=0;i<uv.events.length;i+=1)if(!uv.events[i].has_fired){UVListener.unfired_events.push(uv.events.splice(i,
1)[0]);i-=1}};UVListener._fireEvents=function(){for(;UVListener.unfired_events.length>0;)uv.events.push(UVListener.unfired_events.shift())};UVListener._resetEventsPush=function(){uv.events=uv.events||[];if(uv.events.push.toString().indexOf("[native code]")!==-1){uv.events.push=UVListener._eventsPush;UVListener._getUnfiredEvents();UVListener._fireEvents()}};UVListener._checkForChanges=function(){if(UVListener.callbacks.change&&UVListener.callbacks.change.length>0)if(!UVListener._jsonIsEqual(UVListener.currentUV,
uv)){UVListener._trigger("change",uv);UVListener.currentUV=JSON.stringify(uv,UVListener._stripEvents)}};UVListener._setUVLocation=function(newLoc){uvLocation=newLoc;UVListener._initUV()};UVListener._initUV=function(){window[uvLocation]=window[uvLocation]||{events:[]};uv=window[uvLocation];if(!uv.events)uv.events=[]};UVListener.push=function(data){if(!UVListener._isArray(data))return;if(data[0]==="on")UVListener._on(data[1],data[2]);else if(data[0]==="trigger"&&data[1])UVListener._trigger(data[1])};
UVListener.init=function(testing,uvLoc){if(uvLoc)uvLocation=uvLoc;UVListener._initUV();if(!window.uv_listener||UVListener._isArray(window.uv_listener)){UVListener.early_callbacks=window.uv_listener||null;window.uv_listener=UVListener;if(!testing)UVListener.start()}else if(uvLoc)window.uv_listener._setUVLocation(uvLocation)};UVListener.start=function(){UVListener.currentUV=JSON.stringify(uv,UVListener._stripEvents);timer=setInterval(function(){UVListener._initUV();UVListener._resetEventsPush();UVListener._checkForChanges()},
POLL_DELAY_MS);UVListener._processCallbacks()};q.html.UVListener=UVListener})();(function(){function Timer(config){if(config){this._rate=config.rate||10;this._smallestRate=-1;if(config.start)this.startPooling();this.config=config}this.inervals=[];this._lck_obj={};this._binded_pool=this._pool.bind(this)}qubit.Define.clazz("qubit.opentag.Timer",Timer);Timer.prototype.timers=[];Timer.prototype.startPooling=function(smallestRate){if(smallestRate&&this.config.dynamic)if(this._smallestRate<0||this._smallestRate>
smallestRate)this._smallestRate=Math.min(Math.floor(smallestRate/2),1500);if(!this.started){this.started=true;setTimeout(this._binded_pool,0)}};Timer.prototype._pool=function(){this.maxFrequent(function(){var name="";if(this.config&&this.config.name)name="["+this.config.name+"]"},5E3,this._lck_obj);this.callTimers();if(this.timers.length!==0){var rate=this._smallestRate>this._rate?this._smallestRate:this._rate;setTimeout(this._binded_pool,rate)}else{this.started=false;this._smallestRate=-1}};Timer.prototype.callTimers=
function(){this.lastCalled=(new Date).valueOf();for(var i=0;i<this.timers.length;i++){var timer=this.timers[i];var stamp=(new Date).valueOf();if(stamp>=timer.time){try{timer.execute()}catch(e){}this.timers.splice(i,1);--i}}};Timer.prototype.cancellAll=function(){this.timers=[]};Timer.prototype.setRate=function(time){this._rate=time};Timer.prototype.maxFrequent=function(fun,time,lockObj){if(!lockObj){fun.__maxFrequent__timer_opentag_qubit_=fun.__maxFrequent__timer_opentag_qubit_||{};lockObj=fun.__maxFrequent__timer_opentag_qubit_}var last=
lockObj.____last__timed__max__frequent____;if(!last||(new Date).valueOf()-last>time){last=(new Date).valueOf();lockObj.____last__timed__max__frequent____=last;fun()}};Timer.prototype.runIfNotScheduled=function(fun,time,lockObj){lockObj=lockObj||fun;if(lockObj.__lastRun__&&(new Date).valueOf()<time+lockObj.__lastRun__)return this.schedule(fun,time,lockObj);else{lockObj.__lastRun__=(new Date).valueOf();fun();return true}};Timer.prototype.schedule=function(fun,time,lockObj){if(lockObj.___scheduled___)return false;
else{lockObj.___scheduled___=(new Date).valueOf();this.setTimeout(function(){lockObj.___scheduled___=false;lockObj.__lastRun__=(new Date).valueOf();fun()},time);return true}};var ids=1;Timer.prototype.setTimeout=function(call,time){var timer={id:ids++,time:(new Date).valueOf()+ +time,execute:call};this.timers.push(timer);this.startPooling(time);return timer};Timer.prototype.setInterval=function(call,time){var interv=setInterval(call,time);this.inervals.push(interv);return interv}})();(function(){qubit.Define.namespace("qubit.opentag.Timed",
new qubit.opentag.Timer({rate:37,dynamic:true}));var Timed=qubit.opentag.Timed;Timed.tillTrue=function(test,callback,often){var runner=function(){if(!test())Timed.setTimeout(runner,often||33);else callback()};runner()}})();q.html.fileLoader={};q.html.fileLoader.load=function(url,preLoadAction,postLoadHandler,parentNode,async,attributes){var scriptEl;var preLoadResult;var loadError;var doPostLoad;var loaded;loaded=false;doPostLoad=function(loadFailed){return function(){if(!loaded){loaded=true;if(loadFailed&&
!loadError)loadError={url:document.location.href};postLoadHandler(url,loadError,loadFailed)}}};try{if(preLoadAction)preLoadResult=preLoadAction(url)}catch(e){preLoadResult=false;postLoadHandler(url,"Exception loading pre",true)}finally{if(preLoadResult!==false){scriptEl=q.html.fileLoader.createScriptEl(url,async,false,attributes);if(postLoadHandler){scriptEl.onload=doPostLoad(false);scriptEl.onerror=doPostLoad(true);scriptEl.onreadystatechange=function(){if(this.readyState==="complete"||this.readyState===
"loaded")setTimeout(function(){doPostLoad(false)()},1)}}if(!parentNode)parentNode=window.document.getElementsByTagName("head")[0];parentNode.appendChild(scriptEl)}}};q.html.fileLoader.createScriptEl=function(path,async,forceReload,attr){var a;var scriptEl=document.createElement("script");scriptEl.type="text/javascript";scriptEl.src=q.html.fileLoader.tidyUrl(path)+(forceReload?"?"+(new Date).getTime():"");if(async!==false){scriptEl.async="true";scriptEl.defer="true"}else{scriptEl.async="false";if(scriptEl.async!==
false)scriptEl.async=false;scriptEl.defer="false";if(scriptEl.defer!==false)scriptEl.defer=false}for(a in attr)if(attr.hasOwnProperty(a))scriptEl.setAttribute(a,attr[a]);return scriptEl};q.html.fileLoader.tidyUrl=function(path){if(path.substring(0,5)==="http:")return path;if(path.substring(0,6)==="https:")return path;return"//"+path};(function(){function Events(config){this.calls={}}var Define=qubit.Define;var Utils=qubit.opentag.Utils;Events.prototype.on=function(name,call){if(!this.calls[name])this.calls[name]=
[];return Utils.addToArrayIfNotExist(this.calls[name],call)};Events.prototype.call=function(name,event){var calls=this.calls[name];if(calls)for(var i=0;i<calls.length;i++)try{calls[i](event)}catch(ex){}};Events.prototype.remove=function(name,call){if(this.calls[name])return Utils.removeFromArray(this.calls[name],call);return null};Events.prototype.removeAll=function(call){var total=0;for(var prop in this.calls)if(this.calls.hasOwnProperty(prop))total+=Utils.removeFromArray(this.calls[prop],call);
return total};Events.prototype.clear=function(){this.calls={}};Define.clazz("qubit.Events",Events)})();(function(){function BaseFilter(config){this.log=new qubit.opentag.Log("",function(){return this.CLASS_NAME+"["+this.config.name+"]"}.bind(this),"collectLogs");this.config={order:0,include:true,name:"Filter-"+counter++,script:undefined,session:undefined,restartable:true};this.runtimeId=Utils.UUID();this.session=null;if(config){for(var prop in config)if(config.hasOwnProperty(prop))this.config[prop]=
config[prop];if(config.session)this.setSession(config.session);this.register(this)}this.events=new qubit.Events({})}var Utils=qubit.opentag.Utils;var counter=0;var filters=[];qubit.Define.clazz("qubit.opentag.filter.BaseFilter",BaseFilter);BaseFilter.state={DISABLED:-3,SESSION:-2,PASS:-1,FAIL:0};var RESTART_EVENT="restart";BaseFilter.prototype.EVENT_TYPES={RESTART_EVENT:RESTART_EVENT};BaseFilter.prototype.prepareForRestart=function(){if(this.config.restartable){this.events.call(RESTART_EVENT,this);
this.reset()}};BaseFilter.prototype.onRestart=function(callback){this.events.on(RESTART_EVENT,callback)};BaseFilter.prototype.reset=function(){this.runtimeId=Utils.UUID();this.enable()};BaseFilter.prototype.disable=function(){this.config.disabled=true};BaseFilter.prototype.enable=function(){this.config.disabled=false};BaseFilter.prototype.match=function(){return true};BaseFilter.prototype.setSession=function(session){this.session=session};BaseFilter.prototype.getSession=function(){return this.session};
BaseFilter.prototype.getState=function(){var passed=BaseFilter.state.PASS;if(this.config.disabled)return BaseFilter.state.DISABLED;if(this.config.script)passed=this.config.script.call(this,passed);if(isNaN(+passed))passed=BaseFilter.state.FAIL;this.lastState=+passed;return passed};BaseFilter.getFilters=function(){return filters};BaseFilter.prototype.register=function(){BaseFilter.register(this)};BaseFilter.register=function(filter){Utils.addToArrayIfNotExist(filters,filter)}})();(function(){var Define=
qubit.Define;var PatternType={CONTAINS:"CONTAINS",MATCHES_EXACTLY:"MATCHES_EXACTLY",STARTS_WITH:"STARTS_WITH",ENDS_WITH:"ENDS_WITH",REGULAR_EXPRESSION:"REGULAR_EXPRESSION",ALL_URLS:"ALL_URLS"};Define.namespace("qubit.opentag.filter.pattern.PatternType",PatternType)})();(function(){function URLFilter(config){this._lockObject={};var defaultConfig={patternType:PatternType.CONTAINS,pattern:""};if(config)for(var prop in config)if(config.hasOwnProperty(prop))defaultConfig[prop]=config[prop];URLFilter.SUPER.call(this,
defaultConfig)}var Utils=qubit.opentag.Utils;var BaseFilter=qubit.opentag.filter.BaseFilter;var Timed=qubit.opentag.Timed;var PatternType=qubit.opentag.filter.pattern.PatternType;qubit.Define.clazz("qubit.opentag.filter.URLFilter",URLFilter,BaseFilter);URLFilter.prototype.PATTERNS=PatternType;URLFilter.prototype.getURL=function(url){return url||Utils.getUrl()};URLFilter.prototype.match=function(url){url=this.getURL(url);var match=true;var pattern=this.config.pattern;switch(this.config.patternType){case PatternType.CONTAINS:match=
url.toLowerCase().indexOf(pattern.toLowerCase())>=0;break;case PatternType.MATCHES_EXACTLY:match=url.toLowerCase()===this.config.pattern.toLowerCase();break;case PatternType.STARTS_WITH:match=url.toLowerCase().indexOf(pattern.toLowerCase())===0;break;case PatternType.ENDS_WITH:match=url.lastIndexOf(pattern.toLowerCase())+pattern.length===url.length;break;case PatternType.REGULAR_EXPRESSION:match=(new RegExp(pattern)).test(url);break;case PatternType.ALL_URLS:match=true;break}return match}})();(function(){function Filter(config){var defaultConfig=
{};if(config){for(var prop in config)if(config.hasOwnProperty(prop)){if(prop==="customStarter"&&config[prop])this.customStarter=config[prop];else if(prop==="customScript"&&config[prop])this.customScript=config[prop];defaultConfig[prop]=config[prop]}this.uid="f"+sessionVariableFilterCount++}this.tagsToRun=[];Filter.SUPER.call(this,defaultConfig)}var BaseFilter=qubit.opentag.filter.BaseFilter;var URLFilter=qubit.opentag.filter.URLFilter;var Utils=qubit.opentag.Utils;var sessionVariableFilterCount=0;
qubit.Define.clazz("qubit.opentag.filter.Filter",Filter,URLFilter);Filter.prototype.customStarter=function(session,ready,tag){ready(false)};Filter.prototype.isSession=function(){if(this.config.sessionDisabled)return false;if(this.customStarter===null&&this.customScript===null)return false;return true};Filter.prototype.customScript=function(session){return true};Filter.prototype.match=function(url){var match=true;try{if(this.customScript){if(this._matchState===undefined)this._matchState=!!this.customScript(this.getSession());
match=this._matchState}}catch(ex){match=false}return match&&Filter.SUPER.prototype.match.call(this,url)};Filter.prototype.runTag=function(tag){Utils.addToArrayIfNotExist(this.tagsToRun,tag);if(!this.starterExecuted){if(!this._starterWasRun){this._starterWasRun=true;var recallUUID=this.runtimeId;var callback=function(rerun){if(recallUUID!==this.runtimeId)return;this.reRun=rerun;this.starterExecuted=(new Date).valueOf();this._processQueuedTagsToRun()}.bind(this);if(this.customStarter)this.customStarter(this.getSession(),
callback,tag);else Filter.prototype.customStarter.call(this,this.getSession(),callback,tag)}}else this._triggerTag(tag)};Filter.prototype._processQueuedTagsToRun=function(){for(var i=0;i<this.tagsToRun.length;i++){var tag=this.tagsToRun[i];this._triggerTag(tag)}};Filter.prototype._triggerTag=function(tag){if(this.reRun===true)tag.run();else tag.runOnce()};Filter.prototype.getState=function(session){if(session)this.setSession(session);var pass=Filter.SUPER.prototype.getState.call(this);if(pass===BaseFilter.state.DISABLED)return BaseFilter.state.DISABLED;
if(pass===BaseFilter.state.PASS)if(this.isSession())pass=BaseFilter.state.SESSION;if(this.config.script)pass=this.config.script.call(this,pass,this.getSession());this.lastState=pass;return pass};Filter.prototype.reset=function(){Filter.SUPER.prototype.reset.call(this);this._matchState=undefined;this._starterWasRun=undefined;this.starterExecuted=undefined;this.tagsToRun=[];this.reRun=undefined}})();q.html.GlobalEval={};q.html.GlobalEval.globalEval=function(src){if(window.execScript)window.execScript(src===
""?" ":src);else{var fn=function(){window["eval"].call(window,src)};fn()}};q.html.HtmlInjector={};q.html.HtmlInjector.inject=function(el,injectStart,str,cb,parentNode){var i;var ii;var d;var scriptsRaw;var scripts;var script;var contents;if(str.toLowerCase().indexOf("\x3cscript")>=0){d=document.createElement("div");d.innerHTML="a"+str;scriptsRaw=d.getElementsByTagName("script");scripts=[];for(i=0,ii=scriptsRaw.length;i<ii;i+=1)scripts.push(scriptsRaw[i]);contents=[];for(i=0,ii=scripts.length;i<ii;i+=
1){script=scripts[i];var s={attributes:q.html.HtmlInjector.getAttributes(script)};if(script.src)s.src=script.src;else s.script=script.innerHTML;contents.push(s);script.parentNode.removeChild(script)}if(d.innerHTML)if(d.innerHTML.length>0)d.innerHTML=d.innerHTML.substring(1);q.html.HtmlInjector.doInject(el,injectStart,d);q.html.HtmlInjector.loadScripts(contents,0,cb,el)}else{d=document.createElement("div");d.innerHTML=str;q.html.HtmlInjector.doInject(el,injectStart,d);if(cb)cb()}};q.html.HtmlInjector.doInject=
function(el,injectStart,d){if(d.childNodes.length>0){for(var fragment=document.createDocumentFragment();d.childNodes.length>0;)fragment.appendChild(d.removeChild(d.childNodes[0]));if(injectStart)q.html.HtmlInjector.injectAtStart(el,fragment);else q.html.HtmlInjector.injectAtEnd(el,fragment)}};q.html.HtmlInjector.injectAtStart=function(el,fragment){if(el.childNodes.length===0)el.appendChild(fragment);else el.insertBefore(fragment,el.childNodes[0])};q.html.HtmlInjector.injectAtEnd=function(el,fragment,
counter){if(!counter)counter=1;if(el===document.body&&document.readyState!=="complete"&&counter<50)setTimeout(function(){q.html.HtmlInjector.injectAtEnd(el,fragment,counter+1)},100);else el.appendChild(fragment)};q.html.HtmlInjector.loadScripts=function(contents,i,cb,parentNode){var ii;var c;var foundSrc=false;for(ii=contents.length;i<ii;i+=1){c=contents[i];if(c.src){foundSrc=true;break}else q.html.GlobalEval.globalEval(c.script)}if(foundSrc)q.html.fileLoader.load(c.src,null,function(){q.html.HtmlInjector.loadScripts(contents,
i+1,cb,parentNode)},parentNode,false,c.attributes);if(cb&&i===ii)cb()};q.html.HtmlInjector.getAttributes=function(node){var a;var aLength;var attributes;var val;var name;var map={};if(node){attributes=node.attributes;aLength=attributes.length;for(a=0;a<aLength;a++){val=attributes[a].value;name=attributes[a].name.toLowerCase();if(val!==""&&(name==="id"||name==="class"||name==="charset"||name.substr(0,5)==="data-"))map[name]=val}return map}};(function(){function saveDocWriteMethods(){redirectedDocWriteMethods=
redirectedDocWriteMethods||{write:document.write,writeln:document.writeln}}function unlockDocWriteMethods(){document.write=redirectedDocWriteMethods.write;document.writeln=redirectedDocWriteMethods.writeln;redirectedDocWriteMethods=null}var BaseFilter=qubit.opentag.filter.BaseFilter;var Utils=qubit.opentag.Utils;var HtmlInjector=q.html.HtmlInjector;var FileLoader=q.html.fileLoader;var Filter=qubit.opentag.filter.Filter;var TagsUtils=function(){};qubit.Define.clazz("qubit.opentag.TagsUtils",TagsUtils);
var _bodyLoaded=false;TagsUtils.bodyLoaded=function(){if(_bodyLoaded)return true;_bodyLoaded=!!(document.body&&document.readyState!=="loading");return _bodyLoaded};TagsUtils.bodyAvailable=function(callback){return!!document.body};var loadedURLs={};var STATE={SUCCESS:"success",FAIL:"failure",INIT:"not started"};TagsUtils.loadScript=function(config){var url=config.url;var loadingCheck=function(passedUrlFromLoader,loadError,loadFailed){loadedURLs[url].error=loadError;if(loadFailed){loadedURLs[url].state=
STATE.FAIL;config.onerror()}else{loadedURLs[url].state=STATE.SUCCESS;config.onsuccess()}};if(loadedURLs[url]){if(config.noMultipleLoad)return loadingCheck(url,loadedURLs[url].error,loadedURLs[url].state===STATE.FAIL);loadedURLs[url].count+=1}else loadedURLs[url]={count:1,state:null};var useWrite=!config.async;var loaded=TagsUtils.bodyLoaded();if(useWrite&&loaded);useWrite=useWrite&&!loaded;if(useWrite)TagsUtils.writeScriptURL(url,function(allOk,error){loadingCheck(url,error,!allOk)});else FileLoader.load(url,
false,loadingCheck,config.node,config.async)};var redirectedDocWriteMethods=null;TagsUtils.redirectDocumentWritesToArray=function(array,log){var text=array;saveDocWriteMethods();document.write=function(t){text.push(t)};document.writeln=function(t){text.push(t)}};TagsUtils.flushDocWritesArray=function(array,location,append,log,cb){var el=location;if(el&&array){var flushed=array.splice(0,array.length);try{TagsUtils.injectHTML(el,append,flushed.join("\n"),cb||EMPTY_FUN);return true}catch(ex){}}else{var message=
"Flushing location not found!";return false}if(cb)cb();return true};TagsUtils.unlockDocumentWrites=function(){if(redirectedDocWriteMethods)unlockDocWriteMethods()};var accessorBasePath=TagsUtils.prototype.PACKAGE_NAME+".TagsUtils._writeScriptURL_callbacks";var accesorBase={};qubit.Define.namespace(accessorBasePath,accesorBase,GLOBAL,true);var wsCounter=0;var startFrom=(new Date).valueOf();TagsUtils.writeScriptURL=function(url,callback){var callName="_"+startFrom+"_"+wsCounter++;var accessorName=accessorBasePath+
"."+callName;var called=false;accesorBase[callName]=function(error){if(called)return;called=true;if(error)callback(false,"error while loading script "+url);else callback(true);accesorBase[callName]=undefined;delete TagsUtils.writeScriptURL.callbacks[callName]};var jsIE='if(this.readyState \x3d\x3d\x3d "loaded" || '+'this.readyState \x3d\x3d\x3d "complete"){ try {'+accessorName+"(true)"+"} catch (ex) {}}";var jsNonIE="try{"+accessorName+"(false)}catch(ex){}";var jsNonIEerr="try{"+accessorName+"(true)}catch(ex){}";
var scr="scr";var value;url=FileLoader.tidyUrl(url);value="\x3c"+scr+"ipt onload\x3d'"+jsNonIE+"'  onerror\x3d'"+jsNonIEerr+"' onreadystatechange\x3d'"+jsIE+"' type\x3d'text/javascript' "+" src\x3d'"+url+"'\x3e"+"\x3c/"+scr+"ipt\x3e";if(redirectedDocWriteMethods){unlockDocWriteMethods();document.write(value);saveDocWriteMethods()}else document.write(value);Utils.bodyReady(function(){if(!called){called=true;callback(true)}})};TagsUtils.writeScriptURL.callbacks={};var SESSION=BaseFilter.state.SESSION;
var PASS=BaseFilter.state.PASS;var FAIL=BaseFilter.state.FAIL;TagsUtils.filtersState=function(filters,session,tag,runLastSessionFilterIfPresent){filters=filters.sort(function(a,b){try{var bOrder=b.config.order;var aOrder=a.config.order;if(isNaN(-aOrder))aOrder=0;if(isNaN(-bOrder))bOrder=0;return bOrder-aOrder}catch(nex){return 0}});var decision=PASS;if(!filters||filters.length===0)return decision;var lastReadyToProcessFilter=null;var disabledFiltersPresent=false;var sessionFiltersPresent=false;var waitingResponse=
0;var response;var lastSessionFilter;var sessionFiltersToRun=[];var filter;var lastUnmatched;for(var i=0;i<filters.length;i++){filter=filters[i];filter.setSession(session);if(filter.match()){response=filter.getState();if(response>0){if(waitingResponse===0||waitingResponse>response)waitingResponse=response}else if(response===BaseFilter.state.DISABLED)disabledFiltersPresent=true;else if(response===SESSION){sessionFiltersPresent=true;lastReadyToProcessFilter=filter;lastSessionFilter=filter;sessionFiltersToRun.push(filter)}else lastReadyToProcessFilter=
filter}else lastUnmatched=filter}var onlyAwaitingOrDisabledFiltersPresent=false;if(lastReadyToProcessFilter===null){onlyAwaitingOrDisabledFiltersPresent=true;if(!disabledFiltersPresent)decision=FAIL;else decision=PASS}else if(lastReadyToProcessFilter.config.include)decision=response;else decision=response===PASS?FAIL:PASS;if(waitingResponse>0&&(decision===PASS||onlyAwaitingOrDisabledFiltersPresent))decision=waitingResponse;if(decision===SESSION||decision===PASS&&sessionFiltersPresent){if(!lastSessionFilter.config.include)return FAIL;
decision=SESSION;if(lastSessionFilter instanceof Filter&&lastSessionFilter.isSession())if(runLastSessionFilterIfPresent)for(var c=0;c<sessionFiltersToRun.length;c++)try{sessionFiltersToRun[c].runTag(tag)}catch(ex){}}if(tag.config.dedupe&&decision===PASS)if(lastUnmatched&&lastUnmatched instanceof Filter&&lastUnmatched.isSession()){tag.sendDedupePing=true;decision=FAIL}return decision};TagsUtils.injectHTML=function(location,append,html,callback){return HtmlInjector.inject(location,!append?1:0,html,
callback||EMPTY_FUN)};TagsUtils.getHTMLLocationForTag=function(tag){var el;var name=tag.prepareLocationObject(tag.config.locationObject);switch(name){case "HEAD":el=document.getElementsByTagName("head")[0];break;case "BODY":el=document.body;break;default:if(name)el=document.getElementById(name);else el=document.body}return el}})();(function(){function BaseVariable(config){this.config={};this.handlers=[];this.parameters=null;this.callHandlersOnRead=false;if(config){this.uniqueId="BV"+BV_COUNTER++;
BaseVariable.ALL_VARIABLES[this.uniqueId]=this;for(var prop in config)if(config.hasOwnProperty(prop)){this.config[prop]=config[prop];if(prop==="value")this.value=config.value}var ret=BaseVariable.register(this);if(ret&&ret!==this);return ret}}function checkIfChangedAndContinue(){if(observingStopped)return false;for(var i=0;i<OBSERVED_VARIABLES.length;i++)try{var variable=OBSERVED_VARIABLES[i];variable.getValue()}catch(ex){}Timed.setTimeout(checkIfChangedAndContinue,BaseVariable.CHECK_POLL_RATE);return true}
var Utils=qubit.opentag.Utils;var Timed=qubit.opentag.Timed;var BV_COUNTER=0;qubit.Define.clazz("qubit.opentag.pagevariable.BaseVariable",BaseVariable);BaseVariable.ALL_VARIABLES={};var OBSERVED_VARIABLES=[];BaseVariable.OBSERVED_VARIABLES=OBSERVED_VARIABLES;BaseVariable.pageVariables=[];BaseVariable.register=function(variable){if(variable instanceof BaseVariable){for(var i=0;i<BaseVariable.pageVariables.length;i++){var regVar=BaseVariable.pageVariables[i];if(variable===regVar)return regVar}BaseVariable.pageVariables.push(variable);
return variable}return null};BaseVariable.prototype.getValue=function(){this._updateCurrentValue(this.value);return this.currentValue};BaseVariable.prototype._updateCurrentValue=function(newValue){if(!this.valuesAreEqual(newValue,this.currentValue)){this.oldValue=this.currentValue;this.currentValue=newValue;if(!observingStopped||this.callHandlersOnRead)this._handleValueChanged();return true}return false};BaseVariable.prototype.getDefaultValue=function(){return this.defaultValue};BaseVariable.prototype.setDefaultValue=
function(string){this.defaultValue=string};BaseVariable.prototype.exists=function(useDefaults){var exists=Utils.variableExists(this.getValue());if(useDefaults)exists=exists||Utils.variableExists(this.getDefaultValue());return exists};BaseVariable.prototype.getRelativeValue=function(useDefaults,defaultValue){var pageValue=this.getValue();if(!Utils.variableExists(pageValue))pageValue=defaultValue;var defLoc;if(useDefaults&&!Utils.variableExists(pageValue)){defLoc=this.getDefaultValue();if(Utils.variableExists(defLoc))pageValue=
defLoc}return pageValue};BaseVariable.prototype.replaceToken=function(token,string,altValue,useExpressionAccessor){var exists=this.exists();var value=exists?this.getValue():altValue;token="\\$\\{"+token+"\\}";if(useExpressionAccessor||value instanceof Array){var acessorString;if(exists)acessorString=this.getValueAccessorString();else acessorString=Utils.getAnonymousAcessor(value);return string.replace(new RegExp(token,"g"),acessorString)}else return string.replace(new RegExp(token,"g"),value)};BaseVariable.prototype.getAccessorString=
function(){return"qubit.opentag.pagevariable.BaseVariable.ALL_VARIABLES."+this.uniqueId};BaseVariable.prototype.getValueAccessorString=function(){return this.getAccessorString()+".getValue()"};BaseVariable.prototype.onValueChanged=function(callback,startObserving){if(Utils.addToArrayIfNotExist(this.handlers,callback)===-1);if(startObserving!==false)this.startObservingForChanges()};BaseVariable.prototype.deatchOnValueChanged=function(callback){if(Utils.removeFromArray(this.handlers,callback)>0);};
BaseVariable.prototype._handleValueChanged=function(){var event={oldValue:this.oldValue,newValue:this.currentValue,variable:this};for(var i=0;i<this.handlers.length;i++)try{this.handlers[i](event)}catch(e){}};var observingStopped=true;BaseVariable.CHECK_POLL_RATE=333;BaseVariable.prototype.startObservingForChanges=function(){this.addToObservedVariables();if(observingStopped){observingStopped=false;checkIfChangedAndContinue()}};BaseVariable.prototype.stopObservingForChanges=function(){this.removeFromObservedVariables();
if(OBSERVED_VARIABLES.length===0)observingStopped=true};BaseVariable.prototype.addToObservedVariables=function(){Utils.addToArrayIfNotExist(OBSERVED_VARIABLES,this)};BaseVariable.prototype.removeFromObservedVariables=function(){Utils.removeFromArray(OBSERVED_VARIABLES,this)};BaseVariable.prototype.getObservedVariables=function(){return OBSERVED_VARIABLES};BaseVariable.prototype.valuesAreEqual=function(a,b){return a===b}})();(function(){function Expression(config){this._lockExprObject={};Expression.SUPER.apply(this,
arguments)}var Utils=qubit.opentag.Utils;var Timed=qubit.opentag.Timed;qubit.Define.clazz("qubit.opentag.pagevariable.Expression",Expression,qubit.opentag.pagevariable.BaseVariable);Expression.prototype.getValue=function(){var ret;var error;var value=this.value;try{if(value&&value.indexOf("[#]")===-1){var tmp=Utils.gevalAndReturn(value);ret=tmp.result;this.failMessage=null;error=tmp.error}else ret=Expression.parseUVArray(value)}catch(e){error=e}if(error){var msg="could not read value of expression: \n"+
value+"\nexact cause: "+error;if(this.failMessage!==msg)this.failMessage=msg;ret=null}var differs=this._updateCurrentValue(ret);return ret};Expression.parseUVArray=function(uv){var parts=uv.split("[#]");var array=Utils.gevalAndReturn(parts[0]).result;var collection=[];var pathOfElements=parts[1];if(pathOfElements.indexOf(".")===0)pathOfElements=pathOfElements.replace(".","");for(var i=0;i<array.length;i++){var element=Utils.getObjectUsingPath(pathOfElements,array[i]);collection.push(element)}return collection};
Expression.prototype.replaceToken=function(token,string,altValue,exp){if(this.getValue()instanceof Array)exp=true;return Expression.SUPER.prototype.replaceToken.call(this,token,string,altValue,exp)}})();(function(){function DOMText(config){DOMText.SUPER.apply(this,arguments)}var Utils=qubit.opentag.Utils;qubit.Define.clazz("qubit.opentag.pagevariable.DOMText",DOMText,qubit.opentag.pagevariable.BaseVariable);DOMText.prototype.getValue=function(){var val=Utils.getElementValue(this.value);this._updateCurrentValue(val);
return val}})();(function(){function Cookie(config){Cookie.SUPER.apply(this,arguments);this._lockObject={}}qubit.Define.clazz("qubit.opentag.pagevariable.Cookie",Cookie,qubit.opentag.pagevariable.BaseVariable);Cookie.prototype.getValue=function(){var val=qubit.Cookie.get(this.value);this._updateCurrentValue(val);return val}})();(function(){function URLQuery(config){URLQuery.SUPER.apply(this,arguments)}var Utils=qubit.opentag.Utils;qubit.Define.clazz("qubit.opentag.pagevariable.URLQuery",URLQuery,
qubit.opentag.pagevariable.BaseVariable);URLQuery.prototype.getValue=function(){var val=Utils.getQueryParam(this.value);this._updateCurrentValue(val);return val}})();(function(){function UniversalVariable(config){UniversalVariable.SUPER.apply(this,arguments)}qubit.Define.clazz("qubit.opentag.pagevariable.UniversalVariable",UniversalVariable,qubit.opentag.pagevariable.Expression)})();(function exportUv(){function createUv(){function logLevel(level){log.level=level}function emit(type,event){log.info(type,
"event emitted");event=clone(event||{});event.meta=event.meta||{};event.meta.type=type;eventQueue.push(event);processNextEvent();uv.listeners=filter(uv.listeners,function(l){return!l.disposed})}function on(type,callback,context){function replay(){log.info("Replaying events");queueEmittedEvents(function(){forEach(uv.events,function(event){if(listener.disposed)return;if(!matches(type,event.meta.type))return;callback.call(context,event)})});return subscription}function dispose(){log.info("Disposing event handler");
listener.disposed=true;return subscription}log.info("Attaching event handler for",type);var listener={type:type,callback:callback,disposed:false,context:context||window};uv.listeners.push(listener);var subscription={replay:replay,dispose:dispose};return subscription}function queueEmittedEvents(fn){log.info("Calling event handlers");callingHandlers++;try{fn()}catch(e){log.error("UV API Error",e.stack)}callingHandlers--;processNextEvent()}function processNextEvent(){if(eventQueue.length===0)log.info("No more events to process");
if(eventQueue.length>0&&callingHandlers>0)log.info("Event will be processed later");if(eventQueue.length>0&&callingHandlers===0){log.info("Processing event");var event=eventQueue.shift();uv.events.push(event);queueEmittedEvents(function(){forEach(uv.listeners,function(listener){if(listener.disposed)return;if(!matches(listener.type,event.meta.type))return;try{listener.callback.call(listener.context,event)}catch(e){log.error("Error emitting UV event",e.stack)}})})}}function once(type,callback,context){var subscription=
uv.on(type,function(){callback.apply(context||window,arguments);subscription.dispose()});return subscription}function forEach(list,iterator){var length=list.length;for(var i=0;i<length;i++)iterator(list[i],i)}function clone(input){var output={};for(var key in input)if(input.hasOwnProperty(key))output[key]=input[key];return output}function matches(test,subject){return typeof test==="string"?test===subject:test.test(subject)}function filter(list,iterator){var l=list.length;var output=[];for(var i=0;i<
l;i++)if(iterator(list[i]))output.push(list[i]);return output}var eventQueue=[];var callingHandlers=0;var log={info:function logInfo(){if(log.level>logLevel.INFO)return;if(console&&console.info)console.info.apply(console,arguments)},error:function logError(){if(log.level>logLevel.ERROR)return;if(console&&console.error)console.error.apply(console,arguments)}};logLevel.ALL=0;logLevel.INFO=1;logLevel.ERROR=2;logLevel.OFF=3;logLevel(logLevel.ERROR);var uv={on:on,emit:emit,once:once,events:[],listeners:[],
logLevel:logLevel};return uv}if(typeof module==="object"&&module.exports)module.exports=createUv;else if(window&&window.uv===undefined)window.uv=createUv()})();var allEventsByType={};var unqueuedEvents=[];var inititated=false;var inititatedSuccessfully=false;var global$$0=qubit.Define.global();var PubSub={allEventsByType:allEventsByType,subscribe:function(eventName,callback){if(inititatedSuccessfully){var uv=getUV();uv.on(eventName,callback)}else unqueuedEvents.push({on:[eventName,callback]})},getEventHistory:function(name){return this.allEventsByType[name]},
publish:function(eventName,event){if(inititatedSuccessfully){var uv=getUV();uv.emit(eventName,event)}else unqueuedEvents.push({emit:[eventName,event]})},connect:function(){initiate()}};PubSub.connect();qubit.Define.namespace("qubit.qprotocol.PubSub",PubSub);(function(){function QProtocolVariable(config){QProtocolVariable.SUPER.apply(this,arguments)}var PubSub=qubit.qprotocol.PubSub;var Utils=qubit.opentag.Utils;var DELIMITER=":";qubit.Define.clazz("qubit.opentag.pagevariable.QProtocolVariable",QProtocolVariable,
qubit.opentag.pagevariable.BaseVariable);QProtocolVariable.prototype.init=function(){if(this.initialized)return false;else this.initialized=(new Date).valueOf();this.callHandlersOnRead=true;if(!this.handlerAttached){var _this=this;var result=this.getValueAndPath(this.value);this.eventName=result[0];this.objectPath=result[1];this.updateValue();PubSub.subscribe(this.eventName,function(event){_this.updateValue(event)});this.handlerAttached=(new Date).valueOf()}};QProtocolVariable.prototype.getValueAndPath=
function(value){var eventName=value;var opath;if(eventName){var idx=value.indexOf(DELIMITER);if(idx!==-1){eventName=value.substring(0,idx);opath=value.substring(idx+1)}}return[eventName,opath]};QProtocolVariable.prototype.getValue=function(){this.init();return this.currentValue};QProtocolVariable.prototype.getEventsHistory=function(){return PubSub.getEventHistory(this.eventName)};QProtocolVariable.prototype.updateValue=function(event){if(!event){var history=this.getEventsHistory();if(history)event=
history.current}var newValue;var opath=this.objectPath;if(event&&opath)newValue=Utils.getObjectUsingPath(opath,event);else newValue=event;this._updateCurrentValue(newValue);return newValue};QProtocolVariable.prototype.startObservingForChanges=function(){};QProtocolVariable.prototype.stopObservingForChanges=function(){}})();(function(){function TagHelper(){}function findParamatersForVariable(tag,varRef){var ret=[];try{var params=tag.parameters;if(params)for(var i=0;i<params.length;i++)if(tag.getVariableForParameter(params[i])===
varRef)ret.push(params[i])}catch(ex){}return ret}var Utils=qubit.opentag.Utils;var TagsUtils=qubit.opentag.TagsUtils;var Timed=qubit.opentag.Timed;var BaseVariable=qubit.opentag.pagevariable.BaseVariable;var Expression=qubit.opentag.pagevariable.Expression;var UniversalVariable=qubit.opentag.pagevariable.UniversalVariable;var DOMText=qubit.opentag.pagevariable.DOMText;var Cookie=qubit.opentag.pagevariable.Cookie;var URLQuery=qubit.opentag.pagevariable.URLQuery;qubit.Define.clazz("qubit.opentag.TagHelper",
TagHelper);TagHelper.injectHTMLForLoader=function(tag,callback,tryWrite,altHtml){var html=altHtml!==undefined?altHtml:tag.getHtml();if(html){var append=tag.config.locationPlaceHolder==="END";var location=TagsUtils.getHTMLLocationForTag(tag);tag.injectHTMLNotFinished=true;try{if(location)TagsUtils.injectHTML(location,append,html,function(){tag.injectHTMLNotFinished=false;if(callback)try{callback()}catch(e){}}.bind(tag));else if(tryWrite&&document.readyState==="loading"){document.write(html);tag.injectHTMLNotFinished=
false}else tag.injectHTMLFailed=(new Date).valueOf()}catch(ex){tag.injectHTMLNotFinished=false;tag.injectHTMLFailed=(new Date).valueOf()}}};TagHelper.getAllVariablesWithParameters=function(tag){var vars=tag.getPageVariables();var results=[];for(var i=0;i<vars.length;i++){var pageVar=vars[i];var parameters=findParamatersForVariable(tag,pageVar);for(var j=0;j<parameters.length;j++)results.push({parameter:parameters[j],variable:pageVar})}return results};var _lock_obj={};TagHelper.allParameterVariablesReadyForTag=
function(tag,tryDefaults){var useDefaults=tryDefaults;var allReady=true;var vars=tag.getPageVariables();for(var i=0;i<vars.length;i++){var pageVar=vars[i];try{var parameters=findParamatersForVariable(tag,pageVar);var exist=pageVar.exists();if(!exist&&useDefaults){if(parameters.length>0)exist=!!parameters[0].defaultValue;exist=exist||pageVar.exists(true)}if(!exist){allReady=false;break}}catch(ex){allReady=false;break}}return allReady};var JS_VALUE="2";var QUERY_PARAM="3";var COOKIE_VALUE="4";var ELEMENT_VALUE=
"5";TagHelper.validateAndGetVariableForParameter=function(param){if(param.hasOwnProperty("variable")&&param.variable)param.variable=TagHelper.initPageVariable(param.variable);return param.variable};TagHelper.initPageVariable=function(cfg){if(!cfg||cfg instanceof BaseVariable)return cfg;if(typeof cfg==="string"){var tmp=Utils.getObjectUsingPath(cfg);if(tmp&&tmp instanceof BaseVariable)return tmp}switch(cfg.type){case JS_VALUE:return new Expression(cfg);case QUERY_PARAM:return new URLQuery(cfg);case COOKIE_VALUE:return new Cookie(cfg);
case ELEMENT_VALUE:return new DOMText(cfg);case "EPRESSION":return new Expression(cfg);case "URL_PARAMETER":return new URLQuery(cfg);case "COOKIE_VALUE":return new Cookie(cfg);case "DOM_VALUE":return new DOMText(cfg);default:return new BaseVariable(cfg)}}})();(function(){function GenericLoader(config){this.log=new Log("",function(){return this.CLASS_NAME+"["+this.config.name+"]"}.bind(this),"collectLogs");this.urlsLoaded=0;this.urlsFailed=0;this.runCounter=0;this.events=new qubit.Events({});this._depLoadedHandler=
function(){if(this.dependenciesLoaded()&&this.awaitingDependencies)this._triggerLoadingAndExecution()}.bind(this);this.config={name:"Tag-"+nameCounter++,async:true,usesDocumentWrite:false,timeout:this.LOADING_TIMEOUT,dependencies:[],url:null,urlLocation:null,locationPlaceHolder:"END",locationObject:null,dontWaitForInjectionLocation:false,noMultipleLoad:false,loadDependenciesOnLoad:false,restartable:true};this.restartCounter=0;this.cancelled=false;this.runtimeId=Utils.UUID();this.delayDocWrite=false;
this.dependencies=[];this._lockObject={count:0};this._lockObjectDepsLoaded={};this.genericDependencies=[];if(config){if(!config.name){var n="Tag-"+nameCounter++;this.config.name=n}this.addState("INITIAL");for(var prop in config)this.config[prop]=config[prop];if(config.genericDependencies)this.genericDependencies=this.genericDependencies.concat(config.genericDependencies);if(config.dependencies)this.dependencies=config.dependencies.concat(this.dependencies);if(config.PACKAGE)this._package=config.PACKAGE;
this.onInit()}}function _waitForDependencies(){if(this.cancelled){this._handleCancel();return}this.waitForDependenciesFinished=(new Date).valueOf();var fullBodyNeededAndUnLoaded=this._fullBodyNeededAndUnLoaded();var interactiveBodyNeededButNotReady=this._bodyNeededButNotAvailable();if(fullBodyNeededAndUnLoaded||interactiveBodyNeededButNotReady)this.waitForDependenciesFinished=false;else{if(!this.timeoutCountdownStart)this.timeoutCountdownStart=(new Date).valueOf();if(this.allDependenciesLoaded())this._markLoadedSuccesfuly();
else if(this._loadingOutOfTimeFrames()){this.loadingTimedOut=(new Date).valueOf();if(this.allDependenciesLoaded(true))this._markLoadedSuccesfuly();else{this.addState("TIMED_OUT");this._markLoadingDependenciesFailed();this._triggerOnLoadTimeout()}}else this.waitForDependenciesFinished=false}if(!this.waitForDependenciesFinished)this._setTimeout(_waitForDependencies.bind(this),65);else this.addState("LOADED_DEPENDENCIES")}var Utils=qubit.opentag.Utils;var TagsUtils=qubit.opentag.TagsUtils;var Timed=
qubit.opentag.Timed;var TagHelper=qubit.opentag.TagHelper;var nameCounter=0;var Log=qubit.opentag.Log;qubit.Define.clazz("qubit.opentag.GenericLoader",GenericLoader);var AFTER_EVENT="after";var BEFORE_EVENT="before";var RESTART_EVENT="restart";GenericLoader.prototype.EVENT_TYPES={AFTER_EVENT:AFTER_EVENT,BEFORE_EVENT:BEFORE_EVENT,RESTART_EVENT:RESTART_EVENT};GenericLoader.prototype.onInit=EMPTY_FUN;GenericLoader.prototype.LOADING_TIMEOUT=5*1E3;GenericLoader.prototype.getHtml=function(){if(this.config.html)return this.config.html;
if(this.htmlContent)return Utils.trim(this.htmlContent);return null};GenericLoader.prototype._executeScript=function(){var success=false;try{this.script();success=true}catch(ex){this.addState("EXECUTED_WITH_ERRORS");this.executedWithErrors=(new Date).valueOf();this._onError(ex)}finally{this._onExecute(success)}};GenericLoader.prototype.getTimeout=function(){return this._getTimeout()};GenericLoader.prototype._getTimeout=function(chain){var tout=+this.config.timeout;var deps=this.dependencies;if(tout!==
-1&&deps.length>0){var max=0;chain=chain||[];var present=Utils.indexInArray(chain,this)!==-1;if(!present){chain[chain.length]=this;for(var i=0;i<deps.length;i++){var val=deps[i]._getTimeout(chain);if(val>max)max=val}if(max>0)tout+=max}else return 0}return tout};GenericLoader.prototype._onExecute=function(noErrors){this.onExecute(noErrors)};GenericLoader.prototype.onExecute=EMPTY_FUN;GenericLoader.prototype._flushDocWrites=function(cb){var ret=true;this._docWriteNotFlushed=false;try{var loc=TagsUtils.getHTMLLocationForTag(this);
if(loc&&this._securedWrites&&this._securedWrites.length>0){var append=this.config.locationPlaceHolder==="END";ret=TagsUtils.flushDocWritesArray(this._securedWrites,loc,append,this.log,cb);if(ret)this._docWriteFlushed=(new Date).valueOf();else this._docWriteNotFlushed=(new Date).valueOf()}}catch(ex){this._onError(ex)}if(cb)cb();if(this._securedWrites&&this._securedWrites.length>0){ret=false;this._docWriteNotFlushed=(new Date).valueOf()}return ret};GenericLoader.prototype.log=EMPTY_FUN;GenericLoader.prototype.finished=
function(){return!!this.runIsFinished};GenericLoader.prototype.script=function(){};GenericLoader.prototype.before=function(){this.beforeRun=(new Date).valueOf();try{this.events.call(BEFORE_EVENT,this)}catch(ex){this._onError(ex)}};GenericLoader.prototype.onBefore=function(callback){this.events.on(BEFORE_EVENT,callback)};GenericLoader.prototype.after=function(success){this.afterRun=(new Date).valueOf();try{this.events.call(AFTER_EVENT,{success:success,tag:this})}catch(ex){this._onError(ex)}};GenericLoader.prototype.onAfter=
function(callback){this.events.on(AFTER_EVENT,callback)};GenericLoader.prototype.runOnce=function(){if(!this._runOnceTriggered&&!this.scriptExecuted){this._runOnceTriggered=(new Date).valueOf();this.run()}};GenericLoader.CANCEL_ALL=false;GenericLoader.prototype.run=function(){if(!isNaN(this.config.runningLimit))if(this.config.runningLimit<=this.runCounter)return false;if(this.cancelled||GenericLoader.CANCEL_ALL){this._handleCancel();return false}if(this.isRunning)return false;if(this.lastRun)this.reset();
this.lastRun=this.isRunning=(new Date).valueOf();this.runCounter++;this._ignoreDeps=!!this.ignoreDependencies;if(!this._ignoreDeps&&!this.dependenciesLoaded()){this._attachDepsEventsToContinue();return false}return this._triggerLoadingAndExecution()};GenericLoader.prototype._triggerLoadingAndExecution=function(){this.awaitingDependencies=-(new Date).valueOf();this.load();if(this._ignoreDeps)this.execute();else this.waitForDependenciesAndExecute();return true};GenericLoader.prototype._attachDepsEventsToContinue=
function(){this.awaitingDependencies=(new Date).valueOf();var deps=this.dependencies;for(var i=0;i<deps.length;i++)try{deps[i].events.on("success",this._depLoadedHandler)}catch(ex){}};GenericLoader.prototype.dependenciesLoaded=function(){var deps=this.dependencies;for(var i=0;i<deps.length;i++)if(deps[i]!==this){var executed=+deps[i].scriptExecuted>0;if(!executed)return false}return true};GenericLoader.prototype._setTimeout=function(cb,time){this._wasTimed=(new Date).valueOf();var _runtimeId=this.runtimeId;
var cbWrapped=function(){if(this.runtimeId===_runtimeId)return cb()}.bind(this);return Timed.setTimeout(cbWrapped,time)};GenericLoader.prototype._handleCancel=function(){this.addState("CANCELLED");try{this.onCancel()}catch(ex){this._onError(ex)}};GenericLoader.prototype.waitForDependenciesAndExecute=function(){if(this.loadedDependencies)this.execute();else if(this.loadingDependenciesFailed){this._markFailure();this._markFinished()}else this._setTimeout(this.waitForDependenciesAndExecute.bind(this),
30)};GenericLoader.prototype.execute=function(){this._triggerExecution()};GenericLoader.prototype._triggerExecution=function(){if(this.cancelled){this._handleCancel();return}if(this.scriptExecuted)return;var finished=true;if(this.shouldWaitForDocWriteProtection())finished=false;else{if(!this._beforeEntered){this._beforeEntered=(new Date).valueOf();var cancel=false;try{cancel=this.before()}catch(ex){this._onError(ex)}if(cancel){this._markFailure();this._markFinished();return}}finished=this.loadExecutionURLsAndHTML(this._triggerExecution.bind(this))}if(this.scriptExecuted)return;
if(this.unexpectedFail)finished=true;if(!finished)this._setTimeout(this._triggerExecution.bind(this),30);else{this._flushDocWrites();if(this.scriptLoadingFailed||this.injectHTMLFailed||this.unexpectedFail)this._markFailure();else{this.scriptExecuted=(new Date).valueOf();this.addState("EXECUTED");this._executeScript()}if(this.cancelled){this._handleCancel();return false}else{var successful=this.scriptExecuted>0;try{if(!this.afterRun){this.afterRun=(new Date).valueOf();this.after(successful)}}catch(ex){this.executedWithErrors=
(new Date).valueOf()}if(!this.executedWithErrors)if(successful)this.events.call("success")}this._flushDocWrites();this._markFinished()}};GenericLoader.prototype._markFailure=function(){this.scriptExecuted=-(new Date).valueOf();this.addState("FAILED_TO_EXECUTE")};GenericLoader.prototype._markFinished=function(){this.runIsFinished=(new Date).valueOf();this.isRunning=false;if(GenericLoader.LOCK_DOC_WRITE===this){this._flushDocWrites();TagsUtils.unlockDocumentWrites();GenericLoader.LOCK_DOC_WRITE=false}this.onFinished(true)};
GenericLoader.prototype.onFinished=EMPTY_FUN;GenericLoader.prototype.onCancel=EMPTY_FUN;GenericLoader.prototype.onFinished=EMPTY_FUN;GenericLoader.prototype.shouldWaitForDocWriteProtection=function(){if(this.willSecureDocumentWrite())if(!GenericLoader.LOCK_DOC_WRITE){GenericLoader.LOCK_DOC_WRITE=this;this._secureWriteAndCollectForExecution()}else if(GenericLoader.LOCK_DOC_WRITE!==this){if(!this._lockedDocWriteInformed)this._lockedDocWriteInformed=(new Date).valueOf();return true}return false};GenericLoader.prototype.runWithoutDependencies=
function(){this.ignoreDependencies=true;this.run()};GenericLoader.prototype.loadExecutionURLsAndHTML=function(callback){if(this.cancelled){this._handleCancel();return true}if(!this._loadExecutionURLsAndHTMLInformed)this._loadExecutionURLsAndHTMLInformed=true;this._triggerURLsLoading(callback);if(!this.loadURLsNotFinished){this._flushDocWrites();this._triggerHTMLInjection();this._flushDocWrites();if(!this.injectHTMLNotFinished){this._flushDocWrites();if(!this._docWriteNotFlushed){if(this._docWriteFlushed);
return true}}}return false};GenericLoader.prototype._triggerURLsLoading=function(callback){if(!this._urlLoadTriggered&&this.config.url){this._urlLoadTriggered=true;this.loadURLs(false,callback)}};GenericLoader.prototype._triggerHTMLInjection=function(){if(!this._injectHTMLTriggered&&this.getHtml()){this._injectHTMLTriggered=true;this.injectHTML()}};GenericLoader.prototype.STATE={INITIAL:0,STARTED:1,LOADING_DEPENDENCIES:2,LOADED_DEPENDENCIES:4,LOADING_URL:8,LOADED_URL:16,EXECUTED:32,EXECUTED_WITH_ERRORS:64,
FAILED_TO_LOAD_DEPENDENCIES:128,FAILED_TO_LOAD_URL:256,FAILED_TO_EXECUTE:512,TIMED_OUT:1024,UNEXPECTED_FAIL:2048,CANCELLED:2048*2};GenericLoader.prototype.addState=function(stateName){if(this.STATE.hasOwnProperty(stateName)){this.state=this.state|this.STATE[stateName];try{this.onStateChange(stateName)}catch(ex){this._onError(ex)}}};GenericLoader.prototype.onStateChange=EMPTY_FUN;GenericLoader.prototype.cancel=function(){this.cancelled=(new Date).valueOf()};GenericLoader.prototype.unCancel=function(){this.cancelled=
false};GenericLoader.prototype.state=GenericLoader.prototype.STATE.INITIAL;GenericLoader.prototype._markLoadedSuccesfuly=function(){this.loadedDependencies=(new Date).valueOf();this.onAllDependenciesLoaded()};GenericLoader.prototype._secureWriteAndCollectForExecution=function(){if(!this._securedWrites){this._securedWrites=[];TagsUtils.redirectDocumentWritesToArray(this._securedWrites,this.log)}};GenericLoader.prototype._markLoadingDependenciesFailed=function(){this.addState("FAILED_TO_LOAD_DEPENDENCIES");
this.loadingDependenciesFailed=(new Date).valueOf()};GenericLoader.prototype.allDependenciesLoaded=function(tryDefaults,arrayToAdd){return this.getDependenciesToBeLoaded(tryDefaults,arrayToAdd).length===0};GenericLoader.prototype.getDependenciesToBeLoaded=function(tryDefaults,arrayToAdd){var failures=arrayToAdd||[];if(!this.injectionLocationReady())failures.push("injection location");var i;var deps=this.dependencies;for(i=0;i<deps.length;i++)if(deps[i]!==this){var executed=+deps[i].scriptExecuted>
0;if(!executed){var name=deps[i].config?deps[i].config.name:"anonymous";failures.push("dependant Tag with name -\x3e "+name)}}for(i=0;i<this.genericDependencies.length;i++){var ready=this.genericDependencies[i](this);if(!ready)failures.push("this.genericDependencies["+i+"] (index: "+i+")")}if(failures!=="");return failures};GenericLoader.prototype.docWriteAsksToWaitForBody=function(){return!!(this.delayDocWrite&&this.config.usesDocumentWrite)};GenericLoader.prototype._bodyNeededButNotAvailable=function(){if(this._dontWaitForInjections())return false;
return this._isBodyLocationNeeded()&&!TagsUtils.bodyAvailable()};GenericLoader.prototype._isBodyLocationNeeded=function(){if(!this.isLoadingAsynchronously())return false;if(this._isBodyLocationSet())return true;else{var atHead=this.config.locationObject==="HEAD";return atHead&&this.config.locationPlaceHolder==="END"}};GenericLoader.prototype._isBodyLocationSet=function(){var locObj=this.config.locationObject;return!locObj||locObj==="BODY"};GenericLoader.prototype._fullBodyNeededAndUnLoaded=function(){if(this._dontWaitForInjections())return false;
var needed=false;if(this._isBodyLocationNeeded())needed=this.config.locationPlaceHolder==="END";needed=needed||(this.fullbodyNeeded||this.docWriteAsksToWaitForBody());return needed&&!Utils.bodyReady()};GenericLoader.prototype._dontWaitForInjections=function(){return this.config.dontWaitForInjectionLocation||this.dontWaitForInjectionLocation||GenericLoader.dontWaitForInjectionLocation};GenericLoader.prototype.injectionLocationReady=function(){if(this._dontWaitForInjections())return true;if(this._fullBodyNeededAndUnLoaded())return false;
if(!this.isLoadingAsynchronously())return true;return!!TagsUtils.getHTMLLocationForTag(this)};GenericLoader.prototype._loadingOutOfTimeFrames=function(){if(this.getTimeout()<0)return false;return(new Date).valueOf()-this.timeoutCountdownStart>this.getTimeout()};GenericLoader.prototype.loadDependencies=function(){this._loadDependencies()};GenericLoader.prototype.addClientDependenciesList=function(array,ns){return this.addDependenciesList(array,qubit.Define.clientSpaceClasspath())};GenericLoader.prototype.addDependenciesList=
function(array,ns){if(!array||array.length===0)return;if(!this.failedDependenciesToParse)this.failedDependenciesToParse=[];var dependencies=this.dependencies;for(var i=0;i<array.length;i++){var item=array[i];var bad=false;if(item instanceof GenericLoader)dependencies.push(item);else if(typeof item==="string"){var original=item;if(ns)item=ns+"."+item;var obj=Utils.getObjectUsingPath(item);if(obj)if(obj instanceof GenericLoader)dependencies.push(obj);else bad=true;else this.failedDependenciesToParse.push(original)}else bad=
true;if(bad){this.badDepsObjects=this.badDepsObjects||[];Utils.addToArrayIfNotExist(this.badDepsObjects,item)}}};GenericLoader.prototype._loadDependencies=function(chain){chain=chain||[];var deps=this.dependencies;var present=Utils.indexInArray(chain,this)!==-1;if(!present){chain[chain.length]=this;for(var i=0;i<deps.length;i++)deps[i].load(chain)}};GenericLoader.prototype.onError=EMPTY_FUN;GenericLoader.prototype._onError=function(msg){try{this.onError(msg)}catch(ex){}};GenericLoader.prototype._triggerOnLoadTimeout=
function(){this.onLoadTimeout()};GenericLoader.prototype.onLoadTimeout=EMPTY_FUN;GenericLoader.prototype.onScriptsLoadSuccess=EMPTY_FUN;GenericLoader.prototype.onScriptLoadError=EMPTY_FUN;GenericLoader.prototype.onAllDependenciesLoaded=EMPTY_FUN;GenericLoader.prototype.onBeforeLoad=null;GenericLoader.prototype.load=function(){if(this.loadStarted)return;else{this.loadStarted=(new Date).valueOf();try{if(this.onBeforeLoad)this.onBeforeLoad()}catch(ex){this._onError(ex)}}this.addState("LOADING_DEPENDENCIES");
try{if(!this._ignoreDeps&&this.config.loadDependenciesOnLoad)this.loadDependencies()}catch(ex){throw ex;}_waitForDependencies.call(this)};GenericLoader.prototype._singleUrlLoadHandler=function(success,urls,callback){++this.urlsLoaded;if(!success)++this.urlsFailed;if(this.urlsLoaded===urls.length){this.loadURLsNotFinished=false;if(success&&this.urlsFailed===0){this.addState("LOADED_URL");this.urlsLoaded=(new Date).valueOf();try{if(callback)callback(true)}catch(ex){this._onError(ex)}finally{this.onScriptsLoadSuccess()}}else{var message=
"error loading urls. Failed "+this.urlsFailed;this._onError(message);this.addState("FAILED_TO_LOAD_URL");this.urlsLoaded=-(new Date).valueOf();try{this.scriptLoadingFailed=true;if(callback)callback(false)}catch(ex){this._onError(ex)}finally{this.onScriptLoadError(message)}}}};GenericLoader.prototype.loadURLs=function(urlz,callback){var urls=urlz||this.config.url;this.addState("LOADING_URL");try{if(urls&&!(urls instanceof Array))urls=[urls];for(var i=0;i<urls.length;i++){this.loadURLsNotFinished=true;
var url=urls[i];url=this.prepareURL(url);this.loadURL(url,function(success){this._singleUrlLoadHandler(success,urls,callback)}.bind(this))}}catch(ex){this.loadURLsNotFinished=false;this.addState("UNEXPECTED_FAIL");this.unexpectedFail=(new Date).valueOf();this._onError(ex)}};GenericLoader.prototype.prepareLocationObject=function(loc){return loc};GenericLoader.prototype.prepareURL=function(url){return url};GenericLoader.prototype.prepareHTML=function(html){return html};GenericLoader.prototype.loadURL=
function(url,callback,location){var passedUrl=url;this.addState("LOADING_URL");TagsUtils.loadScript({onsuccess:function(){try{if(callback)callback(true)}catch(ex){}}.bind(this),onerror:function(){try{if(callback)callback(false)}catch(ex){}}.bind(this),url:passedUrl,node:location||this.config.urlLocation,async:this.isLoadingAsynchronously(),noMultipleLoad:this.config.noMultipleLoad})};GenericLoader.prototype.onRestart=function(callback){this.events.on(RESTART_EVENT,callback)};GenericLoader.prototype.prepareForRestart=
function(){if(this.config.restartable){var tmp=this.restartCounter+1;this.events.call(RESTART_EVENT,this);this.reset();this.restartCounter=tmp}};GenericLoader.prototype.restart=function(){if(this.config.restartable){this.prepareForRestart();this.run()}};GenericLoader.prototype.reset=function(){var u;this._injectHTMLTriggered=u;this._loadExecutionURLsAndHTMLInformed=u;this._lockedDocWriteInformed=u;this._runOnceTriggered=u;this._urlLoadTriggered=u;this.afterRun=u;this.beforeRun=u;this.filtersRunTriggered=
u;this.injectHTMLFailed=u;this.loadStarted=u;this.loadURLsNotFinished=u;this.loadedDependencies=u;this.loadingDependenciesFailed=u;this.loadingTimedOut=u;this.runIsFinished=u;this.scriptExecuted=u;this.scriptLoadingFailed=u;this.delayDocWrite=u;this._securedWrites=u;this.state=0;this.unexpectedFail=u;this.urlsFailed=0;this.urlsLoaded=0;this.waitForDependenciesFinished=u;this.isRunning=u;this.lastRun=u;this.cancelled=u;this._beforeEntered=u;this.awaitingDependencies=u;this.timeoutCountdownStart=u;
this.restartCounter=0;this.runtimeId=Utils.UUID();this.addState("INITIAL")};GenericLoader.prototype.isLoadingAsynchronously=function(){if(this._wasTimed)return true;return!!(this.config.async||this.forceAsynchronous)};GenericLoader.prototype.willSecureDocumentWrite=function(){return this.config.usesDocumentWrite&&this.isLoadingAsynchronously()};GenericLoader.prototype.injectHTML=function(callback){var tryWriteIfNoLocation=!this.docWriteAsksToWaitForBody();var html=this.prepareHTML(this.getHtml());
if(html)TagHelper.injectHTMLForLoader(this,callback,tryWriteIfNoLocation,html)};GenericLoader.prototype.clone=function(){var clone=new GenericLoader(this.config);return clone}})();(function(){function BaseTag(config){var defaults={filterTimeout:config&&config.filterTimeout||this.FILTER_WAIT_TIMEOUT,PACKAGE:config&&config.PACKAGE,dedupe:false,needsConsent:false,inactive:false,variables:null,runner:null,disabled:false,locked:false,reRunOnVariableChange:false};Utils.setIfUnset(config,defaults);BaseTag.SUPER.apply(this,
arguments);this.namedVariables={};this._runtimeMarkers={};this.parameters=[];this.filters=[];this.session=null;this.owningContainer=null;this.pingSent=false;this.oldPingSent=false;this.dedupePingSent=false;this.oldDedupePingSent=false;this.reRunCounter=0;if(config){this.addState("INITIAL");try{BaseTag.register(this)}catch(ex){}this.setupConfig(config);this.uniqueRefString=null;if(config.init)try{config.init.call(this,config)}catch(ex){}this.onTagInit();this.handleVariableChange=this._handleVariableChange.bind(this)}}
function _getSetNamedVariable(tag,token){var namedVariables=tag.namedVariables;var variable=TagHelper.initPageVariable(namedVariables[token]);namedVariables[token]=variable;return variable}var Utils=qubit.opentag.Utils;var TagsUtils=qubit.opentag.TagsUtils;var Timed=qubit.opentag.Timed;var BaseFilter=qubit.opentag.filter.BaseFilter;var GenericLoader=qubit.opentag.GenericLoader;var TagHelper=qubit.opentag.TagHelper;var BaseVariable=qubit.opentag.pagevariable.BaseVariable;var Cookie=qubit.Cookie;var Define=
qubit.Define;Define.clazz("qubit.opentag.BaseTag",BaseTag,GenericLoader);BaseTag.prototype.setupConfig=function(config){if(!config)return;if(config.filters)this.addFilters(config.filters);if(config.parameters)this.addParameters(config.parameters);if(config.variables)for(var prop in config.variables)if(config.variables.hasOwnProperty(prop)){var param=this.getParameterByTokenName(prop);if(param){var variable=config.variables[prop];param.variable=variable;if(variable.defaultValue!==undefined)param.defaultValue=
variable.defaultValue;if(variable.uv!==undefined)param.uv=variable.uv}}if(config.locked)this.lock()};BaseTag.prototype.valueForToken=function(token,defaults){var param=this.getParameterByTokenName(token);if(param){if(defaults===undefined)if(this.loadingTimedOut)defaults=true;return this.getParameterValue(param,defaults)}var namedVariables=this.namedVariables;if(namedVariables&&namedVariables[token]){var variable=_getSetNamedVariable(this,token);if(variable)return variable.getRelativeValue(defaults)}return undefined};
BaseTag.prototype.addParameters=function(parameters){this.parameters=this.parameters.concat(parameters)};BaseTag.prototype.LOADING_TIMEOUT=5*1E3;BaseTag.prototype.FILTER_WAIT_TIMEOUT=-1;BaseTag.prototype._isVariable=function(variable){return variable!==null&&variable!==undefined};BaseTag.prototype.run=function(){if(this.destroyed)throw"Tag is destroyed.";this.resolveAllDynamicData();this.runPostInitialisationSection();var params=this.parameters;if(params)for(var i=0;i<params.length;i++){var variable=
this.getVariableForParameter(params[i]);if(!this._isVariable(variable)){this._markLoadingDependenciesFailed();this._markFinished();return}}if(this.config.runner){var ret=false;try{this.addState("AWAITING_CALLBACK");ret=this._runner=(new Date).valueOf();this.config.runner.call(this)}catch(e){}return ret}else{this._runner=false;return this.start()}};BaseTag.prototype.lock=function(){this.locked=true;this._unlock=null};BaseTag.prototype.unlock=function(){this.locked=false;if(this._unlock){this._unlock();
this._unlock=false}};BaseTag.prototype.start=function(){if(!this.locked)return BaseTag.SUPER.prototype.run.call(this);else{this._unlock=function(){return BaseTag.SUPER.prototype.run.call(this)}.bind(this);return false}};BaseTag.prototype.startOnce=function(){if(!this.locked)return BaseTag.SUPER.prototype.runOnce.call(this);else{this._unlock=function(){return BaseTag.SUPER.prototype.runOnce.call(this)}.bind(this);return false}};BaseTag.prototype.getFilters=function(){return this.filters};BaseTag.prototype.runOnceIfFiltersPass=
function(){if(!this._runOnceIfFiltersPassTriggered&&!this.scriptExecuted){this._runOnceIfFiltersPassTriggered=(new Date).valueOf();this.runIfFiltersPass()}};BaseTag.prototype.runIfFiltersPass=function(){if(this.destroyed)throw"Tag is destroyed.";this.resolveAllDynamicData();this.runPostInitialisationSection();var state=this.filtersState(true);this.addState("FILTER_ACTIVE");if(!this.filtersRunTriggered)this.filtersRunTriggered=(new Date).valueOf();if(state===BaseFilter.state.SESSION){this.addState("AWAITING_CALLBACK");
this.awaitingCallback=(new Date).valueOf()}else if(state===BaseFilter.state.PASS){this.filtersPassed=(new Date).valueOf();try{this.onFiltersPassed()}catch(ex){}this.run()}else if(state===BaseFilter.state.FAIL){this._markFiltersFailed();this._markFinished()}else if(state>0){var tout=this.config.filterTimeout;if(tout<0||(new Date).valueOf()-this.filtersRunTriggered>tout){if(!this._awaitingForFilterInformed){this._awaitingForFilterInformed=(new Date).valueOf();try{this.onFiltersDelayed()}catch(ex){}}this._setTimeout(this.runIfFiltersPass.bind(this),
state)}else{this._markFiltersFailed();this._markFinished();this.filtersRunTimedOut=(new Date).valueOf()}}try{this.onFiltersCheck(state)}catch(e){}return state};BaseTag.prototype._markFiltersFailed=function(){this.addState("FILTERS_FAILED");this.filtersPassed=-(new Date).valueOf()};BaseTag.prototype.STATE={INITIAL:0,FILTER_ACTIVE:1,AWAITING_CALLBACK:2,FILTERS_FAILED:4,STARTED:8,LOADING_DEPENDENCIES:16,LOADED_DEPENDENCIES:32,LOADING_URL:64,LOADED_URL:128,EXECUTED:256,EXECUTED_WITH_ERRORS:512,FAILED_TO_LOAD_DEPENDENCIES:1024,
FAILED_TO_LOAD_URL:2048,FAILED_TO_EXECUTE:4096,TIMED_OUT:4096*2,UNEXPECTED_FAIL:4096*2*2,CANCELLED:4096*2*2*2};BaseTag.prototype.addState=function(stateName){BaseTag.SUPER.prototype.addState.call(this,stateName);try{BaseTag.onStateChange(this)}catch(ex){}this.stateStack=[];var s=this.STATE;var current=this.state;var stack=this.stateStack;if(current&s.INITIAL)stack.push("Initial state.");if(current&s.FILTER_ACTIVE)stack.push("Tag running with filters pass triggered.");if(current&s.FILTERS_FAILED)stack.push("Filters failed to pass.");
if(current&s.AWAITING_CALLBACK)stack.push("Awaiting callback to run this tag. Not pooling.");if(current&s.STARTED)stack.push("Tag is initialised and loading has been started.");if(current&s.LOADING_DEPENDENCIES)stack.push("Dependencies are being loaded.");if(current&s.LOADED_DEPENDENCIES)stack.push("Dependencies loading process has been finished.");if(current&s.LOADING_URL)stack.push("External URL is being loaded.");if(current&s.LOADED_URL)stack.push("External URL has been loaded.");if(current&s.EXECUTED)stack.push("Main script has been executed.");
if(current&s.EXECUTED_WITH_ERRORS)stack.push("Main script has been executed but errors occured.");if(current&s.FAILED_TO_LOAD_DEPENDENCIES)stack.push("Dependencies has failed to load.");if(current&s.FAILED_TO_LOAD_URL)stack.push("URL location failed to load.");if(current&s.FAILED_TO_EXECUTE)stack.push("Script failed to execute.");if(current&s.TIMED_OUT)stack.push("Script timed out awaiting for dependencies.");if(current&s.UNEXPECTED_FAIL)stack.push("Script occured UNEXPECTED exception and is failed.");
if(current&s.CANCELLED)stack.push("Tag has been cancelled.")};BaseTag.prototype.onTagInit=EMPTY_FUN;BaseTag.prototype.postInitialisationSection=EMPTY_FUN;BaseTag.onStateChange=EMPTY_FUN;BaseTag.prototype.onFiltersDelayed=EMPTY_FUN;BaseTag.prototype.onFiltersPassed=EMPTY_FUN;BaseTag.prototype.onFiltersCheck=EMPTY_FUN;BaseTag.prototype.state=BaseTag.prototype.STATE.INITIAL;BaseTag.prototype.arePageVariablesLoaded=function(tryDefaults){return TagHelper.allParameterVariablesReadyForTag(this,tryDefaults)};
BaseTag.prototype.getDependenciesToBeLoaded=function(tryDefaults,arrayToAdd){var failures=arrayToAdd||[];if(!this.arePageVariablesLoaded(tryDefaults))failures.push("page variables");return BaseTag.SUPER.prototype.getDependenciesToBeLoaded.call(this,tryDefaults,failures)};BaseTag.prototype.resolveAllDynamicData=function(){this.resolvePageVariables();this.resolveDependencies();this.resolveFilters()};BaseTag.prototype.resolveDependencies=function(){var map=this.failedDependenciesToParse;if(map){this.failedDependenciesToParse=
null;this.addDependenciesList(map,Define.clientSpaceClasspath())}return this.dependencies};BaseTag.prototype.addClientVariablesMap=function(map){this.unresolvedClientVariablesMap=this._addVariablesMap(map,Define.clientSpaceClasspath());return this.unresolvedClientVariablesMap};BaseTag.prototype.resolvePageVariables=function(){var map=this.unresolvedClientVariablesMap;if(map){this.unresolvedClientVariablesMap=null;this.addClientVariablesMap(map)}map=this.unresolvedVariablesMap;if(map){this.unresolvedVariablesMap=
null;this.addVariablesMap(map)}return this.getPageVariables()};BaseTag.prototype.addVariablesMap=function(map){this.unresolvedVariablesMap=this._addVariablesMap(map);return this.unresolvedVariablesMap};BaseTag.prototype._addVariablesMap=function(map,ns){if(!map)return;var unresolvedVariablesMap={};var namedVariables=this.namedVariables;for(var prop in map)if(map.hasOwnProperty(prop)){var item=map[prop];if(item instanceof BaseVariable)namedVariables[prop]=item;else if(typeof item==="string"){var original=
item;if(ns)item=ns+"."+item;var obj=Utils.getObjectUsingPath(item);if(obj)if(obj instanceof BaseVariable)namedVariables[prop]=obj;else namedVariables[prop]=item;else unresolvedVariablesMap[prop]=original}else;}return unresolvedVariablesMap};BaseTag.prototype.prepareURL=function(url){return this.replaceTokensWithValues(url)};BaseTag.prototype.prepareLocationObject=function(loc){return this.replaceTokensWithValues(loc)};BaseTag.prototype.prepareHTML=function(html){if(html)html=this.replaceTokensWithValues(html);
return html};BaseTag.prototype._executeScript=function(){if(this.config&&this.config.script)if(typeof this.config.script==="function")this.script=this.config.script;else{var expr=this.replaceTokensWithValues(String(this.config.script));this.script=Utils.expressionToFunction(expr).bind(this)}BaseTag.SUPER.prototype._executeScript.call(this)};BaseTag.prototype.replaceTokensWithValues=function(string){if(!string||string.indexOf("${")===-1)return string;var params=this.parameters;if(params)for(var i=
0;i<params.length;i++){var parameter=params[i];var variable=this.getVariableForParameter(parameter);if(variable){var token=params[i].token;var value=this.valueForToken(token);string=variable.replaceToken(token,string,value)}}return string};BaseTag.prototype.getParameter=function(name){var params=this.parameters;var ret=null;if(params)for(var i=0;i<params.length;i++)if(params[i].name===name)ret=params[i];return ret};BaseTag.prototype.setParameterValueByTokenName=function(tokenName,variable){var param=
this.getParameterByTokenName(tokenName);if(param!==null){param.variable={value:variable};return true}return false};BaseTag.prototype.getParameterValue=function(parameterOrName,defaults){var param=typeof parameterOrName==="string"?this.getParameter(parameterOrName):parameterOrName;if(param){var variable=this.getVariableForParameter(param);if(variable)try{var value;if(defaults&&param.defaultValue!=="")value=Utils.gevalAndReturn(param.defaultValue).result;value=variable.getRelativeValue(defaults,value);
return value}catch(ex){return undefined}}return undefined};BaseTag.prototype.filtersState=function(runLastSessionFIlterIfPresent){var run=runLastSessionFIlterIfPresent;return TagsUtils.filtersState(this.filters,this.session,this,run)};BaseTag.prototype.addFilter=function(filter){Utils.addToArrayIfNotExist(this.filters,filter)};BaseTag.prototype.addFilters=function(filters){for(var i=0;i<filters.length;i++)this.addFilter(filters[i])};BaseTag.prototype.addClientFiltersList=function(filters){this.unresolvedClientFilterClasspaths=
this.addFiltersList(filters,Define.clientSpaceClasspath());return this.unresolvedClientFilterClasspaths};BaseTag.prototype.resolveFilters=function(){var list=this.unresolvedClientFilterClasspaths;if(list){this.unresolvedClientFilterClasspaths=null;this.addClientFiltersList(list)}return this.filters};BaseTag.prototype.addFiltersList=function(filters,ns){var unresolved=[];for(var i=0;i<filters.length;i++)try{var filter=filters[i];var tmp=filter;var cp=null;if(typeof filter==="string"){cp=filter;if(ns)filter=
ns+"."+filter;filter=Utils.getObjectUsingPath(filter)}if(typeof filter==="function"){var FilterClass=filter;filter=new FilterClass}if(!filter);if(!filter instanceof BaseFilter)filter=null;if(filter)this.addFilter(filter);else if(cp)Utils.addToArrayIfNotExist(unresolved,cp)}catch(ex){this.failedFilters=this.failedFilters||[];this.failedFilters.push(filters[i])}return unresolved};BaseTag.prototype.reset=function(){BaseTag.SUPER.prototype.reset.call(this);var u;this.filtersPassed=u;this.dedupePingSent=
false;this.oldDedupePingSent=false;this.pingSent=false;this.oldPingSent=false;this._runOnceIfFiltersPassTriggered=u;this.filtersRunTriggered=u;this._runner=u;this.reRunCounter=0;this.detachVariablesChangedListeners()};BaseTag.prototype.resetFilters=function(){for(var i=0;i<this.filters.length;i++)this.filters[i].reset()};BaseTag.prototype.getParameterByTokenName=function(name){var ret=null;if(this.parameters){var params=this.parameters;for(var i=0;i<params.length;i++)if(params[i].token===name)ret=
params[i]}return ret};BaseTag.prototype.removeFilter=function(filter){Utils.removeFromArray(this.filters,filter)};var _counter_tag_map=0;var tags=[];var tagAccessorsMap={};var UNIQUE_REF={};BaseTag.register=function(tag){var index=Utils.addToArrayIfNotExist(tags,tag);if(index===-1)tag._tagIndex=tags.length-1;else tag._tagIndex=index;if(tag.config.id){var str="Q"+tag.config.id;UNIQUE_REF[str]=tag;tag.uniqueId=str}else UNIQUE_REF[tag.CLASSPATH]=tag};BaseTag.getById=function(id){return UNIQUE_REF[String(id)]};
BaseTag.prototype.getById=BaseTag.getById;BaseTag.prototype.unregister=function(ref){BaseTag.unregister(ref||this)};BaseTag.prototype.destroy=function(){this.destroyed=true;this.cancel();BaseTag.unregister(this)};BaseTag.unregister=function(tag){var index=Utils.removeFromArray(tags,tag);tag._tagIndex=-1};BaseTag.getTags=function(){return tags};BaseTag.getAccessorsMap=function(){return tagAccessorsMap};BaseTag.prototype.getTags=function(){return tags};BaseTag.prototype.getPageVariables=function(){var params=
this.parameters;var vars=[];if(params)for(var i=0;i<params.length;i++){var v=this.getVariableForParameter(params[i]);if(this._isVariable(v))Utils.addToArrayIfNotExist(vars,v)}if(this.namedVariables)for(var key in this.namedVariables)Utils.addToArrayIfNotExist(vars,_getSetNamedVariable(this,key));return vars};BaseTag.prototype.getAccessorString=function(){if(!this._accessorsMapKey){this._accessorsMapKey="_"+_counter_tag_map++;tagAccessorsMap[this._accessorsMapKey]=this}return"qubit.opentag.BaseTag.getAccessorsMap()."+
this._accessorsMapKey};BaseTag.prototype.getVariableForParameter=function(param){var variable;var namedVariables=this.namedVariables;if(namedVariables&&namedVariables[param.token])variable=_getSetNamedVariable(this,param.token);if(!variable)variable=TagHelper.validateAndGetVariableForParameter(param);return variable};BaseTag.prototype.printVariablesState=function(){var res=[];var pairs=TagHelper.getAllVariablesWithParameters(this);for(var i=0;i<pairs.length;i++){var param=pairs[i].parameter;var variable=
pairs[i].variable;var val;if(param&&param.token)val=this.valueForToken(param.token);else val=variable.getRelativeValue(true);var tmp={name:variable.config.name,exists:variable.exists(),token:param?param.token:null,value:val,variable:variable};res.push(tmp)}return res};BaseTag.prototype._triggerOnLoadTimeout=function(){this.onLoadTimeout()};BaseTag.prototype.getId=function(){return this._getUniqueId()};BaseTag.prototype._getUniqueId=function(){if(this.config.id)return this.config.id;if(String(this.CLASSPATH).indexOf(Define.STANDARD_CS_NS)===
0)return this.CLASSPATH.substring(Define.STANDARD_CS_NS.length+1);else return this.CLASSPATH+"#"+this.config.name};var forceCookiePrefix="qubit.tag.forceRunning_";var disableCookiePrefix="qubit.tag.disableRunning_";var cookieRunAll="qubit.tag.forceAllToRun";BaseTag.prototype.cookieSaysToRunEvenIfDisabled=function(){var id=this._getUniqueId();var ret=!!Cookie.getCached(cookieRunAll);if(!ret)ret=!!Cookie.getCached(forceCookiePrefix+id);return ret};BaseTag.prototype.setCookieForcingTagToRun=function(){var id=
this._getUniqueId();Cookie.set(forceCookiePrefix+id,"true");Cookie.resetCache()};BaseTag.setCookieForcingTagsToRun=function(){Cookie.set(cookieRunAll,"true");Cookie.resetCache()};BaseTag.prototype.setCookieToDisable=function(){var id=this._getUniqueId();Cookie.set(disableCookiePrefix+id,"true");Cookie.resetCache()};BaseTag.prototype.rmCookieToDisable=function(){var id=this._getUniqueId();Cookie.rm(disableCookiePrefix+id);Cookie.resetCache()};BaseTag.prototype.disabledByCookie=function(){var id=this._getUniqueId();
return!!Cookie.getCached(disableCookiePrefix+id)};BaseTag.rmCookieForcingTagsToRun=function(){Cookie.rm(cookieRunAll);Cookie.resetCache()};BaseTag.prototype.rmCookieForcingTagToRun=function(){var id=this._getUniqueId();Cookie.rm(forceCookiePrefix+id);Cookie.resetCache()};BaseTag.rmAllDisablingCookies=function(){Utils.rmCookiesMatching(disableCookiePrefix);Cookie.resetCache()};BaseTag.rmAllCookiesForcingTagToRun=function(){Utils.rmCookiesMatching(forceCookiePrefix);BaseTag.rmCookieForcingTagsToRun()};
BaseTag.prototype.onVariableChanged=function(callback){this.attachVariablesChangedListeners(true);this.events.on("variableChanged",callback)};BaseTag.prototype._handleVariableChange=function(event){this.events.call("variableChanged",event);if(!this.isRunning&&this.config.reRunOnVariableChange){if(!isNaN(this.config.reRunLimit))if(this.config.reRunLimit<=this.reRunCounter)return;var counterVal=this.reRunCounter+1;this.reset();this.reRunCounter=counterVal;this.resetFilters();this.runIfFiltersPass()}};
BaseTag.prototype.attachVariablesChangedListeners=function(force){var variables=this.getPageVariables();var startObserving=!!(this.config.reRunOnVariableChange||this.config.observeVariables||force);if(startObserving)for(var i=0;i<variables.length;i++){var variable=variables[i];variable.onValueChanged(this.handleVariableChange,startObserving)}};BaseTag.prototype.detachVariablesChangedListeners=function(){var variables=this.getPageVariables();for(var i=0;i<variables.length;i++){var variable=variables[i];
variable.deatchOnValueChanged(this.handleVariableChange)}};BaseTag.prototype._markFinished=function(){BaseTag.SUPER.prototype._markFinished.call(this);this.attachVariablesChangedListeners()};BaseTag.prototype.prepareForRestart=function(noFilters){if(this.config.restartable){BaseTag.SUPER.prototype.prepareForRestart.call(this,false);if(!noFilters){var filters=this.getFilters();for(var i=0;i<filters.length;i++)filters[i].prepareForRestart()}}};BaseTag.prototype.restart=function(noFilters){if(this.config.restartable){this.prepareForRestart(noFilters);
this.runIfFiltersPass()}};BaseTag.prototype.runPostInitialisationSection=function(){if(!this._postInitialisationRun){this._postInitialisationRun=true;if(this.postInitialisationSection)try{this.postInitialisationSection()}catch(ex){}}}})();(function(){function LibraryTag(config){Utils.setIfUnset(config,LibraryTag.defaultConfig);if(this.singleton){var path=this.PACKAGE_NAME+"."+this.CLASS_NAME;var zuper=qubit.opentag.Utils.getObjectUsingPath(path,PKG_ROOT);if(zuper.__instance)return zuper.__instance;
zuper.__instance=this}LibraryTag.SUPER.call(this,config)}function extractAndEvalFunctionBody(fun,tag){var expr=fun.toString();expr=expr.replace(/\s*function\s*\([\w\s,_\d\$]*\)\s*\{/,"");expr=expr.substring(0,expr.lastIndexOf("}"));expr=expr.replace(/(["']\s*\+\s*)\s*_*\w+\s*\.\s*valueForToken\s*\(\s*'([^']*)'\s*\)/g,'$1"${$2}"');expr=expr.replace(/\s*_*\w+\s*\.\s*valueForToken\s*\(\s*'([^']*)'\s*\)(\s*\+\s*["'])/g,'"${$1}"$2');expr=expr.replace(/(["']\s*\+\s*)\s*_*\w+\s*\.\s*valueForToken\s*\(\s*"([^"]*)"\s*\)/g,
'$1"${$2}"');expr=expr.replace(/\s*_*\w+\s*\.\s*valueForToken\s*\(\s*"([^"]*)"\s*\)(\s*\+\s*["'])/g,'"${$1}"$2');expr=expr.replace(/(\s*)_*\w+\s*\.\s*valueForToken\s*\(\s*'([^']*)'(\s*)\)/g,"$1${$2}$3");expr=expr.replace(/(\s*)_*\w+\s*\.\s*valueForToken\s*\(\s*"([^"]*)"(\s*)\)/g,"$1${$2}$3");expr=tag.replaceTokensWithValues(expr);Utils.geval(expr)}var Utils=qubit.opentag.Utils;var Define=qubit.Define;qubit.Define.clazz("qubit.opentag.LibraryTag",LibraryTag,qubit.opentag.BaseTag);LibraryTag.defaultConfig=
{vendor:null,imageUrl:null,description:"",async:false,isPrivate:false,upgradeable:true,html:"",parameters:[],prePostWindowScope:false};LibraryTag.prototype.pre=function(){};LibraryTag.prototype.post=function(){};LibraryTag.prototype.before=function(){LibraryTag.SUPER.prototype.before.call(this);try{var cfg=this.config;if(cfg&&cfg.pre)if(typeof cfg.pre==="function")this.pre=cfg.pre;else{var expr=this.replaceTokensWithValues(String(cfg.pre));this.pre=Utils.expressionToFunction(expr).bind(this)}if(this.config.prePostWindowScope&&
this.pre!==LibraryTag.prototype.pre&&this.pre.toString)extractAndEvalFunctionBody(this.pre,this);else this.pre()}catch(ex){return true}return false};LibraryTag.prototype.after=function(success){LibraryTag.SUPER.prototype.after.call(this,success);try{var cfg=this.config;if(cfg&&cfg.post)if(typeof cfg.post==="function")this.post=cfg.post;else{var expr=this.replaceTokensWithValues(String(cfg.post));this.post=Utils.expressionToFunction(expr).bind(this)}if(this.config.prePostWindowScope&&this.post!==LibraryTag.prototype.post&&
this.post.toString)extractAndEvalFunctionBody(this.post,this);else this.post(success)}catch(ex){}};LibraryTag.define=function(namespace,libConfig){namespace=namespace.replace(/^[\.]+/g,"").replace(/[\.]+$/g,"").replace(/\.+/g,".");namespace=qubit.Define.vendorsSpaceClasspath(namespace);var libraryDefaultConfig={};if(libConfig.getDefaultConfig)libraryDefaultConfig=libConfig.getDefaultConfig();var constr=libConfig.CONSTRUCTOR;var prototypeTemplate={};for(var prop in libConfig)if(prop!=="config")prototypeTemplate[prop]=
libConfig[prop];var constructor=function(cfg){cfg=cfg||{};cfg=Utils.overrideFromLeftToRight(libraryDefaultConfig,cfg);var ret=qubit.opentag.LibraryTag.call(this,cfg);if(constr)constr.call(this,cfg);if(ret)return ret};var ret$$0=qubit.opentag.Utils.defineWrappedClass(namespace,LibraryTag,prototypeTemplate,GLOBAL,constructor);var ns=Define.STANDARD_VS_NS+".";if(namespace.indexOf(ns)!==0)Utils.namespace(ns+namespace,ret$$0);return ret$$0};LibraryTag.getLibraryByClasspath=function(namespace){return Utils.getObjectUsingPath(namespace,
qubit.Define.getVendorSpace())}})();(function(){function CustomTag(config){var defaults={url:null,html:"",locationPlaceHolder:"NOT_END",locationObject:"BODY",async:true};Utils.setIfUnset(config,defaults);CustomTag.SUPER.call(this,config)}var Utils=qubit.opentag.Utils;qubit.Define.clazz("qubit.opentag.CustomTag",CustomTag,qubit.opentag.LibraryTag)})();(function(){var Utils=qubit.opentag.Utils;var BaseFilter=qubit.opentag.filter.BaseFilter;var Tags=function(){};qubit.Define.clazz("qubit.opentag.Tags",
Tags);Tags.getById=function(id){return qubit.opentag.BaseTag.getById(String(id))};Tags.getAllTagsByState=function(){return qubit.opentag.Container.getAllTagsByState(Tags.getTags())};Tags.findTagByName=function(match){var tags=this.getTags();var results=[];for(var i=0;i<tags.length;i++)if(tags[i].config.name===match)results.push(tags[i]);return results};Tags.findTagByMatch=function(match){var tags=this.getTags();var results=[];for(var i=0;i<tags.length;i++)if(tags[i].config.name.match(match))results.push(tags[i]);
return results};Tags.findTagContainers=function(tag){var containers=Tags.getContainers();var containing=[];for(var i=0;i<containers.length;i++){var tagsMap=containers[i].tags;for(var prop in tagsMap)if(tagsMap[prop]===tag){containing.push(containers[i]);break}}return containing};Tags.getTags=function(){return qubit.opentag.BaseTag.getTags()};Tags.resetAllTags=function(skipFilters){var tags=Tags.getTags();for(var i=0;i<tags.length;i++){tags[i].reset();if(!skipFilters)tags[i].resetFilters()}};Tags.getContainersPageVariables=
function(){var containers=Tags.getContainers();var vars=[];for(var i=0;i<containers.length;i++)vars=vars.concat(containers.getPageVariables());return vars};Tags.getAllPageVariables=function(){var tags=Tags.getTags();var vars=[];for(var i=0;i<tags.length;i++)vars=vars.concat(tags[i].getPageVariables());return vars};Tags.cancelAll=function(){var tags=Tags.getTags();for(var i=0;i<tags.length;i++)tags[i].cancel()};Tags.resetAll=function(skipFilters){var tags=Tags.getTags();for(var i=0;i<tags.length;i++){tags[i].reset();
if(!skipFilters)tags[i].resetFilters()}};Tags.getPageVariableByName=function(name){var vars=Tags.getAllPageVariables();var rets=[];for(var i=0;i<vars.length;i++)if(vars[i].config.name===name)rets.push(vars[i]);return rets};Tags.getLoadTime=function(tag){var start=tag.beforeRun;var end=tag.runIsFinished;if(isNaN(end))return{tag:tag,loadTime:null};else return{tag:tag,loadTime:end-start}};Tags.getLoadTimes=function(tags){var ret=[];if(tags instanceof qubit.opentag.BaseTag){ret.push([Tags.getLoadTime(tags[prop])]);
return ret}tags=tags||Tags.getTags();var array=tags instanceof Array;if(array)for(var i=0;i<tags.length;i++){if(tags[i]instanceof qubit.opentag.BaseTag)ret.push(Tags.getLoadTime(tags[i]))}else for(var prop in tags)if(tags[prop]instanceof qubit.opentag.BaseTag)ret.push(Tags.getLoadTime(tags[prop]));return ret};Tags.forceAllContainersAndTagsToRunIfDisabled=function(){qubit.opentag.Container.setCookieForDisabledContainersToRun();qubit.opentag.BaseTag.setCookieForcingTagsToRun()};Tags.rmAllContainersAndTagsForcingFlags=
function(){qubit.opentag.Container.rmCookieForDisabledContainersToRun();qubit.opentag.BaseTag.rmAllCookiesForcingTagToRun()};Tags.getContainers=function(){return qubit.opentag.Container.getContainers()};Tags.findAllTagsByClassPath=function(startsWith){var start=(new Date).valueOf();var ret=[];var excludes=[];try{excludes.push(qubit.opentag.CustomTag);excludes.push(qubit.opentag.LibraryTag)}catch(ex){}var tags=Tags.getTags();for(var i=0;i<tags.length;i++){var tag=tags[i];if(Utils.indexInArray(excludes,
tag)<0&&tag.PACKAGE_NAME.indexOf(startsWith)===0)ret.push(tag)}return ret};Tags.findAllTags=function(pckg,maxDeep){var BaseTag=qubit.opentag.BaseTag;var ret;var excludes=[];var start=(new Date).valueOf();try{excludes.push(qubit.opentag.CustomTag);excludes.push(qubit.opentag.LibraryTag)}catch(ex){}ret=Tags.findAllInstances(pckg,BaseTag,excludes,maxDeep);return ret};var findAllIn=function(pckg,check,excludes,maxDeep){var instances=[];if(typeof pckg==="string")pckg=Utils.getObjectUsingPath(pckg);if(pckg){var cfg=
{objectsOnly:true};if(maxDeep)cfg.maxDeep=true;var fun=function(obj,parent,propName,trackPath){if(check(obj)){for(var i=0;i<excludes.length;i++)if(excludes[i]===obj)return true;Utils.addToArrayIfNotExist(instances,obj);return true}return false}.bind(this);Utils.traverse(pckg,fun,cfg)}return instances};Tags.findAllInstances=function(pckg,clazz,excludes,maxDeep){var check=function(obj){return obj instanceof clazz};return findAllIn(pckg,check,excludes,maxDeep)};Tags.findAllInheriting=function(pckg,clazz,
excludes,maxDeep){var check=function(obj){return obj.prototype instanceof clazz};return findAllIn(pckg,check,excludes,maxDeep)};Tags.findAllFilters=function(pckg,maxDeep){var excludes=[];try{excludes.push(qubit.opentag.filter.Filter);excludes.push(qubit.opentag.filter.URLFilter)}catch(ex){}return Tags.findAllInheriting(pckg,BaseFilter,excludes,maxDeep)}})();q.cookie={};q.cookie.PageView={};q.cookie.PageView.update=function(){var a;var r;r=function _(){return Math.floor(1+Math.random()*65536).toString(36).substring(1)};
if(!window.__pageViewId__){a=(new Date).getTime().toString(36);window.__pageViewId__=a+r()+r()+r()}return window.__pageViewId__};q.html.PostData=function(url,data,type,contentType){var _post;var agent;var isIe;var isIe9;var isOldIe;var fullUrl;var loaded;var retry;var retryDelay;var retryCount;retryCount=2;retryDelay=5E3;loaded=false;retry=function(){if(retryCount>0)setTimeout(function(){if(!loaded){retryCount-=1;_post()}},retryDelay)};agent=navigator.userAgent.toLowerCase();isIe=agent.indexOf("msie")!==
-1;isIe9=agent.indexOf("msie 9")!==-1;isOldIe=agent.indexOf("msie 7")!==-1||agent.indexOf("msie 6")!==-1;fullUrl=("https:"===document.location.protocol?"https:":"http:")+url;type=type||"POST";_post=function(){var xhr;try{xhr=null;try{xhr=new XMLHttpRequest}catch(e1){}if(xhr&&!isIe)xhr.open(type,fullUrl,true);else if(typeof XDomainRequest!=="undefined"){xhr=new XDomainRequest;xhr.open(type,fullUrl)}else xhr=null;try{xhr.withCredentials=false}catch(e2){}if(xhr.setRequestHeader)if(contentType)xhr.setRequestHeader("Content-Type",
contentType);else xhr.setRequestHeader("Content-Type","text/plain;charset\x3dUTF-8");xhr.onload=function(){loaded=true};xhr.onreadystatechange=function(){};xhr.ontimeout=function(){};xhr.onerror=function(){};xhr.onprogress=function(){};xhr.send(data)}catch(err){try{try{q.html.fileLoader.load(fullUrl)}catch(err2){if(window.console&&window.console.log)window.console.log(err)}}catch(e){}}};if(isOldIe){q.html.fileLoader.load(fullUrl);return}else _post()};(function(){function Ping(){}function prepareContainerMsg(container,
config){var msgObject={};msgObject.clientId=""+config.clientId;msgObject.containerId=""+container.getContainerId();msgObject.classpath=""+container.PACKAGE_NAME;msgObject.opentagStats=true;if(container.sentPing)msgObject.containerLoad=false;else{container.sentPing=(new Date).valueOf();msgObject.containerLoad=true}msgObject.isS3=false;msgObject.pageViewId=q.cookie.PageView.update();msgObject.tags=[];return msgObject}var appJsonCT="text/plain;charset\x3dUTF-8";qubit.Define.clazz("qubit.opentag.Ping",
Ping);Ping.prototype.sendErrors=function(container,errors){};Ping.getPingID=function(tag){if(tag.config.id)return tag.config.id;var idx=tag.PACKAGE_NAME.lastIndexOf(".");if(idx!==-1)return tag.PACKAGE_NAME.substring(idx+1);else return tag.PACKAGE_NAME};Ping.prototype.send=function(container,loadTimes){var config=container.config;var msgObject=prepareContainerMsg(container,config);var tagLogs=msgObject.tags;var pingURL=config.pingServerUrl;for(var i=0;i<loadTimes.length;i++){var tag=loadTimes[i].tag;
var loadTime=loadTimes[i].loadTime;if(loadTime===null||isNaN(loadTime))continue;var tagMsg={};var tagID=Ping.getPingID(tag);if(!tag.pingSent&&tagID&&loadTime!==null)if(tagID!==undefined){tagMsg.tagId=tagID;tagMsg.loadTime=loadTime;tagMsg.fired=true;tagLogs.push(tagMsg);tag.pingSent=true}else;else if(tag.pingSent);else if(loadTime===null);}if(pingURL&&(tagLogs.length>0||msgObject.containerLoad)){var pingString=JSON.stringify(msgObject);var url="//"+pingURL;q.html.PostData(url,pingString,"POST",appJsonCT)}else{if(!tagLogs.length);
if(!pingURL);}};Ping.prototype.sendDedupe=function(container,tags){var config=container.config;var msgObject=prepareContainerMsg(container,config);var pingURL=config.pingServerUrl;var tagLogs=msgObject.tags;for(var i=0;i<tags.length;i++){var tag=tags[i];var tagId=Ping.getPingID(tag);var tagMsg={};if(tagId===undefined);else if(!tag.dedupePingSent){tagMsg.tagId=""+tagId;tagMsg.fired=false;tagMsg.loadTime=0;tagLogs.push(tagMsg);tag.dedupePingSent=true}}if(pingURL&&(tagLogs.length>0||msgObject.containerLoad)){var pingString=
JSON.stringify(msgObject);var url="//"+pingURL;q.html.PostData(url,pingString,"POST",appJsonCT)}else{if(!tagLogs.length);if(!pingURL);}}})();q.cookie.SimpleSessionCounter={};q.cookie.SimpleSessionCounter._cookieName="_qst_s";q.cookie.SimpleSessionCounter._sessionCookie="_qsst_s";q.cookie.SimpleSessionCounter.update=function(domain){var c;var s;var ga;var mins=30;c=qubit.Cookie.get(q.cookie.SimpleSessionCounter._cookieName);s=qubit.Cookie.get(q.cookie.SimpleSessionCounter._sessionCookie);if(!c)c=1;
else{c=parseInt(c,10);if(!s||parseInt(s,10)<(new Date).getTime()-mins*60*1E3)c+=1}qubit.Cookie.set(q.cookie.SimpleSessionCounter._cookieName,c,365,domain);qubit.Cookie.set(q.cookie.SimpleSessionCounter._sessionCookie,(new Date).getTime().toString(),null,domain);return c};(function(){function LZW(config){if(config)if(config.alphabet){this.alphabet=config.alphabet;this.dict={};for(var i=0;i<this.alphabet.length;i++)this.dict[this.alphabet[i]]=i}else{this.alphabet=defaultAlphabet;this.dict=xdict}}function getFromDict(code,
dict){for(var p in dict)if(code===dict[p])return p;return null}var defaultAlphabet=[];var len=Math.pow(2,8);for(var c=0;c<len;c++)defaultAlphabet.push(String.fromCharCode(c));var xdict={};for(var i$$0=0;i$$0<defaultAlphabet.length;i$$0++)xdict[defaultAlphabet[i$$0]]=i$$0;var Define=qubit.Define;Define.clazz("qubit.compression.LZW",LZW);LZW.prototype.encode=function(string){var dictsize=this.alphabet.length;var extDict={};var results=[];var index=0;var curr=string.charAt(index++);var next;for(var dict=
this.dict;!!(next=string.charAt(index++));){var newWord=curr+next;if(dict.hasOwnProperty(newWord)||extDict.hasOwnProperty(newWord))curr=newWord;else{var val=dict.hasOwnProperty(curr)?dict[curr]:extDict[curr];if(val===undefined)throw"Dictionary base is to small for those contents: "+curr;results.push(val);extDict[newWord]=dictsize++;curr=next}}if(curr!=="")results.push(extDict.hasOwnProperty(curr)?extDict[curr]:dict[curr]);return results};LZW.prototype.decode=function(codes){var dict=this.dict;var dictSize=
this.alphabet.length;var chunk;var locdict={};var prevChar=getFromDict(codes[0],dict);var prevChunk=prevChar;var results=[prevChar];for(var i=1;i<codes.length;i++){var currentCode=codes[i];chunk=getFromDict(currentCode,dict);if(chunk===null){if(locdict.hasOwnProperty(currentCode))chunk=locdict[currentCode];if(chunk===null)chunk=prevChunk+prevChar}results.push(chunk);prevChar=chunk.charAt(0);locdict[dictSize++]=prevChunk+prevChar;prevChunk=chunk}return results.join("")}})();(function(){function converToMex(number){var rest=
0;var minus=number<0;if(minus)number=-number;var newNum="";var first=true;do{rest=number%maxMnum;if(first){newNum=UmexToMexMap[mnums[rest]];first=false}else newNum=mnums[rest]+newNum;number=(number-rest)/maxMnum}while(number>0);if(minus)return"-"+newNum;return newNum}function convertFromMex(mexNum){var newNum=0;var pow=0;var first=true;for(var i=0;i<mexNum.length;i++){var cur=mexNum.charAt(mexNum.length-1-i);if(first){first=false;cur=mex.charAt(UmexMap[cur])}newNum+=mexMap[cur]*Math.pow(maxMnum,pow++)}return newNum}
function Compressor(config){}var mex="abcdefghijklmnopqrstuvwxyz"+"0123456789"+"'%./:\x3c\x3e?[";var Umex="ABCDEFGHIJKLMNOPQRSTUVWXYZ"+"*!-+()@{|}"+'"]^_`~$\x26#';var mexMap={};for(var c=0;c<mex.length;c++)mexMap[mex.charAt(c)]=c;var UmexMap={};for(var ii=0;ii<mex.length;ii++)UmexMap[Umex.charAt(ii)]=ii;var UmexToMexMap={};for(var iii=0;iii<mex.length;iii++)UmexToMexMap[mex.charAt(iii)]=Umex.charAt(iii);var mnums=mex.split("");var maxMnum=mnums.length;var lzw=new qubit.compression.LZW({});var Define=
qubit.Define;Define.clazz("qubit.compression.Compressor",Compressor);Compressor.prototype.compress=function(string,lz){var array=(lz||lzw).encode(string);var result=[];for(var i=0;i<array.length;i++)result.push(String.fromCharCode(array[i]));return result.join("")};Compressor.prototype.compressAnsi=function(string,lz){var array=(lz||lzw).encode(string);var result=[];for(var i=0;i<array.length;i++){var num=converToMex(array[i]);result.push(num)}return result.join("")};Compressor.prototype.decompressAnsi=
function(code,lz){var array=[];var curr="";for(var i=0;i<code.length;i++){var ch=code.charAt(i);if(UmexMap.hasOwnProperty(ch)){var num=curr+ch;curr="";num=convertFromMex(num);array.push(num)}else curr+=ch}return(lz||lzw).decode(array)};Compressor.prototype.decompress=function(code,lz){var array=[];for(var i=0;i<code.length;i++)array.push(code.charCodeAt(i));return(lz||lzw).decode(array)}})();(function(){function prepareDefinitions(array){var definitions=[];for(var i=0;i<array.length;i++){var preparedString=
escapeRegExp(array[i][0]);definitions.push([new RegExp(preparedString,"g"),"*"+array[i][1]])}return definitions}function getDefinitionByChar(ch,definitions){for(var i=0;i<definitions.length;i++)if(definitions[i][1]===ch)return definitions[i][0];return null}function Encoder(config){this._regexDefs=regexDefinitions;this._defs=definitions;if(config)if(config.definitions){this._regexDefs=prepareDefinitions(config.definitions);this._defs=config.definitions}}function replaceWithUTFEncoding(string,range){var rewrite=
[];for(var i=0;i<string.length;i++){var inRange=true;if(range)inRange=string.charCodeAt(i)<=range;var inCookieAlphabet=Cookie.cookieAlphabetMap.hasOwnProperty(string.charAt(i));if(inRange&&!inCookieAlphabet)rewrite.push("*"+string.charCodeAt(i)+".");else rewrite.push(string.charAt(i))}return rewrite.join("")}function replaceWithDynamicDictionary(ddict,string){string=string.replace(/@/g,"@@");var dict=[];var i=0;for(var j=0;i<ddict.length;i++){var pattern=ddict[i][0];var rx=new RegExp(escapeRegExp(pattern),
"g");var out=string.replace(rx,"@"+j+"-");if(out!==string){dict.push(ddict[i][0]);j++;string=out}}return[string,dict]}function escapeRegExp(string){return string.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function dynamicDictionary(str){var parts={};var word="";for(var i=0;i<str.length;i++){var ch=str.charAt(i);if(!dynamicDictCharsMap[ch]){if(isNaN(parts[word]))parts[word]=str.split(word).length-1;word=""}else word+=ch}var dict=[];for(var prop in parts)if(parts.hasOwnProperty(prop)){var occurringNum=
parts[prop];if(occurringNum>=MIN_OCCURENCE_LEN&&prop.length>=MIN_WORD_LEN)dict.push([prop,occurringNum])}dict=dict.sort(function(a,b){if(a[0].length===b[0].length)return 0;if(b[0].length>a[0].length)return 1;else return-1});return dict}function decodeDynamicDictionary(string,ddict){if(!ddict||ddict.length===0||!string)return string;var ret="";var codeWord=false;var collectingNum=false;var codeNum="";for(var i=0;i<string.length;i++){var ch=string.charAt(i);if(ch==="@"||codeWord||collectingNum)if(codeWord||
collectingNum){codeWord=false;if(ch==="@")ret+="@";else if(!isNaN(+("-"+ch))){collectingNum=true;codeNum=codeNum+ch}else if(collectingNum){if(ddict&&ch==="-"&&ddict[+codeNum])ret+=ddict[+codeNum];else ret+="@"+codeNum+ch;codeNum="";collectingNum=false}else ret+="@"+ch}else codeWord=true;else ret+=ch}if(codeNum)ret+="@"+codeNum;if(codeWord)ret+="@";return ret}var Define=qubit.Define;var Cookie=qubit.Cookie;var definitions=[['","referrer":[{"url":"http://',"1-"],['","referrer":[{"url":"https://',"2-"],
[',"referrer":[{"url":"http://',"3-"],[',"referrer":[{"url":"https://',"4-"],[',"sessionStartTime":',"5-"],["www.google.co.uk","6-"],["www.google.","7-"],['"sessionStartTime":',"8-"],['"landing":"',"9-"],["http%3A%2F%2Fwww","10-"],['"landing":',"L"],['"time":',"A"],['"pageViews":',"P"],['"sessionCount":',"B"],['"referrer":',"R"],['"url":"http://www.',"J"],['"url":"https://www.',"M"],['"url":"',"I"],['"url":',"U"],["http://www.","W"],["https://www.","V"],["%2Fen%2Ftsuk%2F","K"],['"sessionLandingPage":',
"F"],["http%3A%2F%2F","D"],["http://","H"],["https://","X"],['""',"O"],['",',"Y"],['":{}}',"z"],["\x3c","S"],["\x3e","G"],["[","Z"],["]","E"],["{","a"],["}","b"],["(","c"],[")","d"],["!","e"],["#","f"],["$","g"],["!","q"],["'","i"],[":","j"],["?","k"],["^","x"],["`","m"],["|","n"],["~","o"],["%","v"],[",","C"]];var regexDefinitions=prepareDefinitions(definitions);Define.clazz("qubit.opentag.compression.Encoder",Encoder);Encoder.prototype.encode=function encode(string,limitUTFRange){var ret=string.replace(/\*/g,
"**");var ininitalDdict=dynamicDictionary(ret);for(var i=0;i<this._regexDefs.length;i++){var pair=this._regexDefs[i];ret=ret.replace(pair[0],pair[1])}ret=ret.replace(/;/g,"*-");ret=ret.replace(/&/g,"*.");ret=ret.replace(/\\/g,"*/");ret=ret.replace(/=/g,"*+");ret=ret.replace(/\n/g,"*N");ret=ret.replace(/ /g,"*_");ret=ret.replace(/\t/g,"*T");ret=ret.replace(/"/g,"*Q");var ddict=dynamicDictionary(ret);ddict.concat(ininitalDdict);var result=replaceWithDynamicDictionary(ddict,ret);var actualDict=result[1];
var replacementsOccured=actualDict.length>0;if(replacementsOccured)ret=result[0];if(!limitUTFRange)ret=replaceWithUTFEncoding(ret);else ret=replaceWithUTFEncoding(ret,limitUTFRange);if(replacementsOccured)return"Y"+actualDict.join("*")+"@"+ret;else return"N"+ret};var dynamicDictChars="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ+_.";var dynamicDictCharsMap={};for(var i$$0=0;i$$0<dynamicDictChars.length;i$$0++)dynamicDictCharsMap[dynamicDictChars.charAt(i$$0)]=true;var MIN_WORD_LEN=
4;var MIN_OCCURENCE_LEN=2;Encoder.prototype.decode=function(string){var ddict=null;if(string.charAt(0)==="N")string=string.substring(1);else if(string.charAt(0)==="Y"){var qMkIdx=string.indexOf("@");if(qMkIdx>=0){ddict=string.substring(1,qMkIdx);ddict=ddict.split("*");string=string.substring(qMkIdx+1);string=decodeDynamicDictionary(string,ddict)}}var ret="";var codeWord=false;var collectingNum=false;var utfNum="";for(var i=0;i<string.length;i++){var ch=string.charAt(i);if(ch==="*"||codeWord||collectingNum)if(codeWord||
collectingNum){codeWord=false;if(!isNaN(+("-"+ch))){utfNum=utfNum+ch;collectingNum=true}else if(collectingNum){if(ch===".")ret+=String.fromCharCode(+utfNum);else if(ch==="-"&&getDefinitionByChar(utfNum+"-",this._defs))ret+=getDefinitionByChar(utfNum+"-",this._defs);else ret+="*"+utfNum+ch;utfNum="";collectingNum=false}else if(ch==="*")ret+="*";else if(ch==="-")ret+=";";else if(ch==="/")ret+="\\";else if(ch===".")ret+="\x26";else if(ch==="+")ret+="\x3d";else if(ch==="N")ret+="\n";else if(ch==="_")ret+=
" ";else if(ch==="T")ret+="\t";else if(ch==="Q")ret+='"';else if(getDefinitionByChar(ch,this._defs)!==null){var def=getDefinitionByChar(ch,this._defs);ret+=def}else ret+="*"+ch}else codeWord=true;else ret+=ch}if(utfNum)ret+="*"+utfNum;if(codeWord)ret+="*";return ret}})();(function(){function CookieCompressor(config){this.testBinary=false;this.binSupported=binSupported;if(config){this.compressor=new qubit.compression.Compressor;this.encoder=new qubit.opentag.compression.Encoder({})}}var Define=qubit.Define;
var Cookie=qubit.Cookie;var binSupported=false;Define.clazz("qubit.opentag.compression.CookieCompressor",CookieCompressor);CookieCompressor.prototype.compress=function(string,forceCompression){if(typeof string!=="string"||string==="")return string;var encoded=this.encoder.encode(string);var binOut;if(this.binSupported||this.testBinary){var bin=this.compressor.compress(encoded);binOut='"B'+this.encoder.encode(bin,128)+'"';Cookie.set("__qtag_test_bin__",binOut,undefined,undefined,true);var o=Cookie.get("__qtag_test_bin__",
true);Cookie.rm("__qtag_test_bin__");if(o&&o!==binOut)binOut=null}var ansiOut;var compressed=this.encoder.encode(this.compressor.compressAnsi(encoded));if(!forceCompression&&encoded.length<=compressed.length)ansiOut="E"+encoded;else ansiOut="C"+compressed;if(binOut&&binOut.length<ansiOut.length)return binOut;else return ansiOut};CookieCompressor.prototype.decompress=function(string){if(typeof string!=="string"||string==="")return string;if(string.charAt(0)==='"')string=string.substring(1,string.length-
1);var code=string.charAt(0);string=string.substring(1);switch(code){case "E":return this.encoder.decode(string);case "C":var tmp=this.compressor.decompressAnsi(this.encoder.decode(string));return this.encoder.decode(tmp);case "B":var tmp1=this.compressor.decompress(this.encoder.decode(string));return this.encoder.decode(tmp1);default:throw"This code is not supported! Code: "+code;}}})();(function(){var Cookie=qubit.Cookie;var Utils=qubit.opentag.Utils;var Session=function(){};qubit.Define.clazz("qubit.opentag.Session",
Session);var compressor=new qubit.opentag.compression.CookieCompressor({});Session.readCompressedCookie=function(name){var cookie=Cookie.get(name,true);return compressor.decompress(cookie)};Session.setupSession=function(container){var config=container.config;var session;var i;var cookie;var cookieText;var cookieName;var now;session={};session.sessionCount=q.cookie.SimpleSessionCounter.update(config.cookieDomain);cookieName="qtag_"+container.getContainerId();var xCookieName="x_qtag_"+container.getContainerId();
cookie=Cookie.get(cookieName);var nonCompressedCookie=!!cookie;if(cookie===null){cookie=Cookie.get(xCookieName,true);cookie=compressor.decompress(cookie)}if(cookie)try{cookie=JSON.parse(cookie)}catch(e){cookie={sc:0,sessionCount:0,pageViews:0,sessionStartTime:0,referrer:[],sessionLandingPage:"",__v:{}}}else cookie={sc:0,sessionCount:0,pageViews:0,sessionStartTime:0,referrer:[],sessionLandingPage:"",__v:{}};now=(new Date).getTime();if(session.sessionCount!==parseInt(cookie.sc,10)){cookie.sessionStartTime=
now;cookie.sc=session.sessionCount;cookie.sessionCount+=1;cookie.referrer.push({url:Session.getReferrer(),landing:Utils.getUrl().substring(0,300),time:now});cookie.sessionLandingPage=Utils.getUrl().substring(0,300)}else if(Session.isReferrerDifferent())if(!Session.referrerIsSameAsPrevious(cookie.referrer,now,30*60*1E3)){cookie.referrer.push({url:Session.getReferrer(),landing:Utils.getUrl().substring(0,300),time:now});cookie.sessionLandingPage=Utils.getUrl().substring(0,300);cookie.sessionStartTime=
now;cookie.sessionCount+=1}session.sessionCount=cookie.sessionCount;session.sessionStartTime=cookie.sessionStartTime;session.pageStartTime=now;cookie.pageViews+=1;session.pageViews=cookie.pageViews;session.sessionLandingPage=cookie.sessionLandingPage;session.referrer=cookie.referrer;if(session.referrer.length>5)session.referrer.splice(2,session.referrer.length-5);cookieText=JSON.stringify(cookie);for(i=0;compressor.compress(cookieText).length>config.maxCookieLength&&i<5;){if(cookie.referrer.length>=
3)cookie.referrer.splice(2,1);else if(cookie.referrer.length===2)cookie.referrer=[cookie.referrer[0]];else if(cookie.referrer.length===1)cookie.referrer=[];cookieText=JSON.stringify(cookie);i+=1}session.referrer=cookie.referrer;if(nonCompressedCookie)Cookie.rm(cookieName);var xCookieText=compressor.compress(cookieText);Cookie.rm(xCookieName);if(config.maxCookieLength>0)Cookie.set(xCookieName,xCookieText,365,config.cookieDomain,true);session.setVariable=function(key,value,time){var t=!!time?time:0;
cookie.__v[key]=[value,t];var xCookieText=compressor.compress(JSON.stringify(cookie));if(config.maxCookieLength>0)Cookie.set(xCookieName,xCookieText,365,config.cookieDomain,true);else Cookie.rm(xCookieName)};session.getCookie=function(name,compressed){var res=Cookie.get(name,true);if(res&&(compressed||name.indexOf("x_")===0))try{res=compressor.decompress(res)}catch(ex){}else if(res!==null)res=Cookie.decode(res);return res};session.getVariable=function(key){var v;var t;var now;v=cookie.__v[key];if(v){t=
v[1];if(t===0||t>(new Date).getTime())return v[0]}return null};session.on=function(event,el,fn){if(el.attachEvent)el.attachEvent("on"+event,fn);else if(el.addEventListener)el.addEventListener(event,fn,false)};session.getTagCookie=function(){return Session.readCompressedCookie(xCookieName)};Session.lastSession=session;return session};Session.referrerIsSameAsPrevious=function(referrers,now,overlapDuration){var url;var landing;var lastReferrer;if(referrers.length>0){url=Session.getReferrer();landing=
Utils.getUrl().substring(0,300);lastReferrer=referrers[referrers.length-1];return lastReferrer.url===url&&lastReferrer.landing===landing&&lastReferrer.time+overlapDuration>now}return false};Session.isReferrerDifferent=function(){var start;var end;var ref;ref=Session.getReferrer();start=ref.indexOf("://");if(start===-1)return true;start+=3;try{if(ref.substring(start).indexOf(Session.getDomain())!==0)return true;return false}catch(ex){return true}};Session.getReferrer=function(){if(document.referrer)return document.referrer.substring(0,
300);return"direct"};Session.getDomain=function(){return document.location.host}})();(function(){function Quick(){}var LibraryTag=qubit.opentag.LibraryTag;var Define=qubit.Define;Quick.library=function(){return LibraryTag.define.apply(LibraryTag,arguments)};Quick.libraryRef=function(){return LibraryTag.getLibraryByClasspath.apply(LibraryTag.getLibraryByClasspath,arguments)};Define.namespace("qubit.Quick",Quick)})();(function(){function Container(config){this.runQueue=[];this.tags=[];this.config={cookieDomain:"",
maxCookieLength:1E3,gzip:true,delayDocWrite:false,clientId:"",name:"",tellLoadTimesProbability:null,pingServerUrl:null,trackSession:null,disabled:false,containerId:"",scanTags:false,noPings:false,restartable:true};this.ignoreTagsState=false;if(config){this.setConfig(config);if(!config.name)this.config.name="Cont-"+_counter++;Container.register(this);if(Container.NO_PINGS)this.config.noPings=true;this.ping=new qubit.opentag.Ping(this.config);this._sendPingsTrigger=this.sendPings.bind(this);if(config.init)try{config.init.call(this,
config)}catch(ex){}var _this=this;this._tagLoadedHandler=function(event){if(_this._containerAlreadySentPings){_this.sendPingsNotTooOften();if(event.success);}}}this.events=new qubit.Events({});return this}function attachRenamedIfExist(obj,src,name,steps){if(obj[name]){steps[name]=steps[name]+1||1;name+="("+steps[name]+")"}obj[name]=src}var Utils=qubit.opentag.Utils;var BaseFilter=qubit.opentag.filter.BaseFilter;var Filter=qubit.opentag.filter.Filter;var BaseTag=qubit.opentag.BaseTag;var Timed=qubit.opentag.Timed;
var Tags=qubit.opentag.Tags;var Session=qubit.opentag.Session;var Cookie=qubit.Cookie;var _counter=1;try{window.opentag_consentGiven=function(){Container.consentIsGiven=true;var all=Container.getContainers();for(var i=0;i<all.length;i++)try{all[i].run()}catch(ex){}}.bind(this)}catch(ex){}qubit.Define.clazz("qubit.opentag.Container",Container);var containers$$0=[];var RESTART_EVENT="restart";Container.prototype.EVENT_TYPES={RESTART_EVENT:RESTART_EVENT};Container.register=function(ref){Utils.addToArrayIfNotExist(containers$$0,
ref)};Container.prototype.isTellingLoadTimes=function(){var value=this.config.tellLoadTimesProbability;if(value===null)value=0;return value>Math.random()};Container.prototype.destroy=function(withTags){this.destroyed=true;this.unregister();for(var i=0;i<this.tags.length;i++){var tag=this.tags[i];if(tag.owningContainer===this){tag.owningContainer=null;if(withTags&&tag instanceof BaseTag)tag.destroy()}}this.tags=[]};Container.destroyAll=function(withTags){var items=Container.getContainers();for(var i=
0;i<items.length;i++)items[i].destroy(withTags)};Container.findContainersByName=function(name){var items=Container.getContainers();var results=[];for(var i=0;i<items.length;i++)if(items[i].config.name===name)results.push(items[i]);return results};Container.getById=function(id){var items=Container.getContainers();for(var i=0;i<items.length;i++)if(items[i].getContainerId()===id)return items[i];return null};Container.prototype.unregister=function(withTags){Container.unregister(this,withTags)};Container.unregister=
function(ref,withTags){Utils.addToArrayIfNotExist(containers$$0,ref);var index=Utils.removeFromArray(containers$$0,ref);if(withTags){for(var i=0;i<ref.tags.length;i++){var tag=ref.tags[i];if(tag.owningContainer===ref){tag.owningContainer=null;if(tag instanceof BaseTag)tag.unregister()}}ref.tags=[]}if(!index||index.length===0);};Container.prototype.hasConsent=function(){return Cookie.get("qubitconsent")==="Accepted"};Container.prototype.register=function(ref){Container.register(ref||this)};Container.getContainers=
function(){return containers$$0};Container.prototype.getContainers=function(){return Container.getContainers()};Container.prototype.onTagRegistered=function(tag){};Container.prototype.registerTag=function(tag){if(tag.owningContainer!==null)return false;else{this.tags.push(tag);tag.owningContainer=this;tag.onAfter(this._tagLoadedHandler);try{this.onTagRegistered(tag)}catch(ex){}}return true};Container.prototype.unregisterTag=function(tag){if(tag.owningContainer===this)tag.owningContainer=null;for(var i=
0;i<this.tags.length;)if(this.tags[i]===tag)this.tags.splice(i,1);else i++};Container.prototype.registerTags=function(tags){for(var i=0;i<tags.length;i++)this.registerTag(tags[i])};Container.prototype.setConfig=function(config){for(var prop in config)this.config[prop]=config[prop]};Container.prototype.run=function(force){this.runTags({command:"runOnceIfFiltersPass"},force)};Container.prototype.runWithoutFilters=function(force){this.runTags({command:"run"},force)};Container.prototype.containerScriptLoadedSynchronously=
function(){var i;var ii;var script;var scripts;var src;scripts=document.getElementsByTagName("script");for(i=0,ii=scripts.length;i<ii;i+=1){script=scripts[i];src=script.getAttribute("src");if(!!src&&src.indexOf(""+this.config.clientId+"-"+this.getContainerId()+".js")>0)return script.getAttribute("async")===null&&(script.getAttribute("defer")===false||script.getAttribute("defer")===""||script.getAttribute("defer")===null)}return true};Container.prototype.prepareSessionIfNeeded=function(){var trackSession=
this.config.trackSession;if(trackSession!==true&&trackSession!==false)for(var j=0;j<this.tags.length;j++){var tmpTag=this.tags[j];tmpTag.resolveAllDynamicData();var filters=tmpTag.getFilters();for(var i=0;i<filters.length;i++){var filter=filters[i];if(filter instanceof Filter&&filter.isSession()){this.trackSession=true;break}}if(this.trackSession)break}else this.trackSession=trackSession;if(Container.TRACK_SESSION)this.trackSession=true;if(this.trackSession)this.session=Session.setupSession(this);
if(this.session);};Container.runtimeCounter=Container.runtimeCounter||1;Container.prototype.runTags=function(config,force){if(this.destroyed)throw"Container has been destroyed.";if(!force){if(this.config.disabled){this.sendPingsNotTooOften();return}if(Container.LOCKED||Utils.global().QUBIT_CONTAINERS_LOCKED){this.sendPingsNotTooOften();return}}if(this.onBeforeRun)try{this.onBeforeRun()}catch(ex){}var forceAsync=!this.containerScriptLoadedSynchronously();var command="runIfFiltersPass";if(config&&config.command)command=
config.command;this.runningStarted=(new Date).valueOf();if(this.config.scanTags)if(!this._scanned){this.scanForTags();this._scanned=(new Date).valueOf()}this.prepareSessionIfNeeded();var orderedTags=this.getTagsInOrder();var runtimeMark="___otctnmk"+Container.runtimeCounter++;for(var z=0;z<orderedTags.length;z++)try{var tag=orderedTags[z];if(this.includedToRun(tag))this._checkAndRun(tag,command,forceAsync,runtimeMark)}catch(ex){}Timed.setTimeout(function(){this.sendPingsNotTooOften()}.bind(this),
3100);this.waitForAllTagsToFinish();for(var c=0;c<orderedTags.length;c++){orderedTags[c]._runtimeMarkers[runtimeMark]=undefined;delete orderedTags[c]._runtimeMarkers[runtimeMark]}};Container.prototype.getTagsInOrder=function(){var tagsOrdered=[];for(var i=0;i<this.tags.length;i++){var tmpTag=this.tags[i];var priority=tmpTag.config.priority;if(+priority>0){var prIndex=0;for(var c=0;c<tagsOrdered.length;c++){var tmpTagOrdered=tagsOrdered[c];if(tmpTagOrdered){var priorityAlreadyIn=+tmpTagOrdered.config.priority;
if(priorityAlreadyIn>0&&priorityAlreadyIn>priority)prIndex++;else break}}tagsOrdered.splice(prIndex,0,tmpTag)}else tagsOrdered.push(tmpTag)}return tagsOrdered};Container.prototype._checkAndRun=function(tag,command,forceAsync,runtimeMark){if(!tag._runtimeMarkers[runtimeMark])tag._runtimeMarkers[runtimeMark]=true;else return;var deps=tag.resolveDependencies();if(deps.length>0)for(var i=0;i<deps.length;i++)this._checkAndRun(deps[i],command,forceAsync,runtimeMark);this._tagRunner(tag,command,forceAsync)};
Container.prototype._tagRunner=function(tag,command,forceAsync){try{if(this.includedToRun(tag)){if(forceAsync)tag.forceAsynchronous=true;if(this.config.delayDocWrite)tag.delayDocWrite=true;tag.session=tag.session||this.session;tag[command]()}}catch(ex){}};Container.prototype.getContainerId=function(){if(this.config.containerId)return this.config.containerId;else{if(this._pkgName)return this._pkgName;var idx=this.PACKAGE_NAME.split(".");idx=idx[idx.length-1];this._pkgName=idx;return idx}};Container.prototype.includedToRun=
function(tag){if(!tag)return false;var cfg=tag.config;if(cfg.inactive)return false;if(cfg.disabled)if(!tag.cookieSaysToRunEvenIfDisabled())return false;if(tag.disabledByCookie())return false;var consentOk=Container.consentIsGiven||!cfg.needsConsent||this.hasConsent();var atInitialState=tag.state===BaseTag.prototype.STATE.INITIAL;return this.ignoreTagsState||consentOk&&atInitialState};Container.prototype.scanForTags=function(clean,pkg){if(clean)this.tags=[];var tags;if(pkg&&typeof pkg==="object")tags=
this.findAllTags(pkg);else tags=this.findAllTagsByClassPath();this.registerTags(tags);return tags};Container.prototype.findAllTags=function(pckg,maxDeep){pckg=pckg||this.tagsPackageName||this.PACKAGE_NAME;return Tags.findAllTags(pckg,maxDeep)};Container.prototype.findAllTagsByClassPath=function(startsWith){startsWith=startsWith||this.PACKAGE_NAME;return Tags.findAllTagsByClassPath(startsWith)};Container.prototype.findAllFilters=function(pckg,maxDeep){pckg=pckg||this.tagsPackageName||this.PACKAGE_NAME;
return Tags.findAllFilters(pckg,maxDeep)};Container.prototype.waitForAllTagsToFinish=function(){if(this._waitForAllTagsToFinishWaiting)return;if(!this._lastWaited)this._lastWaited=(new Date).valueOf();var timedOut=(new Date).valueOf()-this._lastWaited>15*1E3;var finished=this.allTagsFinished()||timedOut;if(!this._showFinishedOnce&&finished){this._lastWaited=null;if(timedOut);this._showFinishedOnce=true;this.runningFinished=(new Date).valueOf();this._containerAlreadySentPings=(new Date).valueOf();
this.sendPingsNotTooOften();if(this.onTagsInitiallyRun)this.onTagsInitiallyRun()}else if(!finished){this._waitForAllTagsToFinishWaiting=true;this._showFinishedOnce=false;Timed.setTimeout(function(){this._waitForAllTagsToFinishWaiting=false;this.waitForAllTagsToFinish()}.bind(this),100)}else;};Container.prototype.onTagsInitiallyRun=EMPTY_FUN;Container.prototype.resetAllTags=function(skipFilters){for(var i=0;i<this.tags.length;i++){this.tags[i].reset();if(!skipFilters)this.tags[i].resetFilters()}};
Container.prototype._prepareTagsToRestart=function(noFilters){for(var i=0;i<this.tags.length;i++)this.tags[i].prepareForRestart(noFilters)};Container.prototype.reset=function(skipTags,skipFilters){this.runningFinished=undefined;this._waitForAllTagsToFinishWaiting=undefined;this.runningStarted=undefined;this._showFinishedOnce=undefined;if(!skipTags)this.resetAllTags(skipFilters)};Container.prototype.onRestart=function(callback){this.events.on(RESTART_EVENT,callback)};Container.prototype.restart=function(skipTags,
skipFilters){if(this.config.restartable){this.events.call(RESTART_EVENT,this);this.reset(true,true);if(!skipTags)this._prepareTagsToRestart(skipFilters);this.run()}};Container.restartAll=function(noTags,noFilters){var containers=Container.getContainers();for(var i=0;i<containers.length;i++)try{containers[i].restart(noTags,noFilters)}catch(ex){log.ERROR("Restart failed for container "+containers[i].config.name,ex)}};Container.resetAll=function(skipTags,skipFilters){var containers=Container.getContainers();
for(var i=0;i<containers.length;i++)try{containers[i].reset(skipTags,skipFilters)}catch(ex){log.ERROR("Reset failed for container "+containers[i].config.name,ex)}};Container.prototype.sendPingsNotTooOften=function(){this._sndLck=this._sndLck||{};Timed.runIfNotScheduled(this._sendPingsTrigger,2E3,this._sndLck)};Container.prototype.sendPings=function(){if(this.config.noPings)return;var i;if(this.isTellingLoadTimes()){var results=this.getAllTagsByState();var loadTimes=[];if(results.run)loadTimes=Tags.getLoadTimes(results.run);
this.lastPingsSentTime=(new Date).valueOf();this.ping.send(this,loadTimes);loadTimes=Tags.getLoadTimes();var deduplicatedTagsToBeSent=[];for(i=0;i<loadTimes.length;i++){var tag=loadTimes[i].tag;if(tag.config.dedupe&&tag.sendDedupePing)deduplicatedTagsToBeSent.push(tag)}if(deduplicatedTagsToBeSent.length>0){this.lastDedupePingsSentTime=(new Date).valueOf();this.ping.sendDedupe(this,deduplicatedTagsToBeSent)}if(results.other){loadTimes=Tags.getLoadTimes(results.other);var otherTagsToBeSent=[];for(i=
0;i<loadTimes.length;i++)otherTagsToBeSent.push(loadTimes[i]);if(otherTagsToBeSent.length>0)this.ping.send(this,otherTagsToBeSent)}if(results.awaiting){loadTimes=Tags.getLoadTimes(results.awaiting);var awaitingTagsToBeSent=[];for(i=0;i<loadTimes.length;i++)awaitingTagsToBeSent.push(loadTimes[i]);if(awaitingTagsToBeSent.length>0)this.ping.send(this,awaitingTagsToBeSent)}}else this.ping.send(this,[])};Container.prototype.getAllTagsByState=function(){return Container.getAllTagsByState(this.tags)};Container.getAllTagsByState=
function(tags){var runScripts=null;var other=null;var filterReady=null;var failed=null;var consent=null;var locked=null;var steps={};var LOWEST_FAIL_STATE=BaseTag.prototype.STATE.EXECUTED_WITH_ERRORS;for(var i=0;i<tags.length;i++){var tag=tags[i];if(tag instanceof BaseTag){var name=tag.config.name;if(tag.scriptExecuted>0){runScripts=runScripts||{};attachRenamedIfExist(runScripts,tag,name,steps)}else if(tag.locked){locked=locked||{};attachRenamedIfExist(locked,tag,name,steps)}else if(tag.scriptExecuted<
0||tag.state>=LOWEST_FAIL_STATE){failed=failed||{};attachRenamedIfExist(failed,tag,name)}else if(tag.filtersState()===BaseFilter.state.SESSION||tag.filtersState()>0){filterReady=filterReady||{};attachRenamedIfExist(filterReady,tag,name,steps)}else if(tag.config.needsConsent){consent=consent||{};attachRenamedIfExist(consent,tag,name,steps)}else{other=other||{};attachRenamedIfExist(other,tag,name,steps)}}}return{run:runScripts,failed:failed,awaiting:filterReady,consent:consent,locked:locked,other:other}};
Container.prototype.allTagsFinished=function(){for(var i=0;i<this.tags.length;i++){var tag=this.tags[i];if(tag instanceof qubit.opentag.BaseTag){var state=tag.filtersState();if(!tag.config.disabled){var notFailedAndUnlocked=tag.filtersState()<0&&!tag.locked;var tagNotFinishedOrNotRunner=!(tag.finished()||tag.config.runner&&!tag.isRunning);if(notFailedAndUnlocked&&tagNotFinishedOrNotRunner){var isNotSession=state!==BaseFilter.state.SESSION;var doesWaitForDeps=+tag.awaitingDependencies>0;if(isNotSession&&
!doesWaitForDeps)return false}}}}return true};Container.prototype.getPageVariables=function(){var vars=[];for(var j=0;j<this.tags.length;j++){var tVars=this.tags[j].getPageVariables();for(var i=0;i<tVars.length;i++)Utils.addToArrayIfNotExist(vars,tVars[i])}return vars};Container.getPageVariableByName=function(name){var vars=this.getAllPageVariables();var rets=[];for(var i=0;i<vars.length;i++)if(vars[i].config.name===name)rets.push(vars[i]);return rets};var disableCookiePrefix="qubit.opentag.disableContainerRunning_";
var forceCookiePrefix="qubit.opentag.forceContainerRunning";Container.prototype._getCookieNameForDisabling=function(){return disableCookiePrefix+this.getContainerId()+this.config.name};Container.prototype.disabledByCookie=function(){return!!Cookie.getCached(this._getCookieNameForDisabling())};Container.prototype.setCookieToDisable=function(){Cookie.set(this._getCookieNameForDisabling(),"true");Cookie.resetCache()};Container.prototype.rmCookieToDisable=function(){Cookie.rm(this._getCookieNameForDisabling());
Cookie.resetCache()};Container.rmAllDisablingCookies=function(){Utils.rmCookiesMatching(disableCookiePrefix);Cookie.resetCache()};Container.setCookieForDisabledContainersToRun=function(){Cookie.set(forceCookiePrefix,"true");Cookie.resetCache()};Container.rmCookieForDisabledContainersToRun=function(){Cookie.rm(forceCookiePrefix);Cookie.resetCache()}})();(function(){function Main(){}function requestedDebugMode(){var isDebug=false;if(Cookie.get("opentag_debug")||document.location.href.indexOf("opentag_debug")>=
0)isDebug=true;return isDebug}function requestedDebugTool(){var isDebug=false;if(Cookie.get("opentag_debug_tool")||document.location.href.indexOf("opentag_debug_tool")>=0)isDebug=true;return isDebug}function disabled(){try{var fun=GLOBAL.TAGSDK_MAIN_DISABLED_FUNCTION;if(fun&&fun())return true}catch(ex){}if(document.location.href.indexOf("opentag_disabled\x3dtrue")>=0)return true;return false}function setIfUnset(object,property,value){if(value&&(object[property]===undefined||object[property]===""||
object[property]===null))object[property]=value}function pruneContainerPackage(container){var name=container.PACKAGE_NAME.split(".");name=name[name.length-1];var pkg=Utils.getParentObject(container.PACKAGE_NAME);pkg[name]=null;delete pkg[name]}function getClientId(container){var parent=Utils.getParentObject(container.PACKAGE_NAME);var cfg=parent.ClientConfig;if(cfg&&cfg.clientId)return cfg.clientId;else{var parts=container.PACKAGE_NAME.split(".");return parts[parts.length-2].substring(1)}}var Cookie=
qubit.Cookie;var Utils=qubit.opentag.Utils;qubit.opentag.Log.setLevelFromCookie();Main.run=function(){var needDebugModeButNotInDebug=false;if(disabled())return;var selfDebug=false;var debugToolRequested=requestedDebugTool();var debugRequested=debugToolRequested||requestedDebugMode();if(!selfDebug&&debugRequested){if(!qubit.DEBUG_MODE)GLOBAL.TAGSDK_NS_OVERRIDE=true;else GLOBAL.TAGSDK_NS_OVERRIDE=false;needDebugModeButNotInDebug=true}if(qubit.DEBUG_MODE)GLOBAL.TAGSDK_NS_OVERRIDE=false;try{q.html.UVListener.init()}catch(uvInitFalure){}Main.runAllContainers(needDebugModeButNotInDebug)};
Main.runAllContainers=function(needDebugModeButNotInDebug){try{var containers=qubit.opentag.Container.getContainers();for(var i=0;i<containers.length;i++){var container=containers[i];var contCfg=container.config;if(!container.runningStarted&&!container.configuredInMain){contCfg.scanTags=true;var clientConfig=Utils.getParentObject(container.PACKAGE_NAME).ClientConfig;if(clientConfig)setIfUnset(container.config,"clientId",clientConfig.id);var sysDefaults=Utils.getParentObject(container.PACKAGE_NAME).SystemDefaults;
if(sysDefaults){setIfUnset(contCfg,"pingServerUrl",sysDefaults.pingServerUrl);setIfUnset(contCfg,"tellLoadTimesProbability",sysDefaults.tellLoadTimesProbability)}container.configuredInMain=true;if(needDebugModeButNotInDebug){container.destroy(true);pruneContainerPackage(container);Main.loadDebugVersion(container)}else if(!GLOBAL.QUBIT_OPENTAG_STOP_MAIN_EXECUTION)container.run();else(function(){var runner=qubit.opentag.RUN_STOPPED_EXECUTON;qubit.opentag.RUN_STOPPED_EXECUTON=function(){try{if(runner)runner()}finally{container.run()}}})(container)}}}catch(ex){}};
Main.loadDebugVersion=function(container){var debugScript=document.createElement("script");var url;var scriptURL=container.config.scriptURL;var clientId=getClientId(container);var containerId=container.getContainerId();if(scriptURL){url=scriptURL;var dLen="-debug.js".length;if(url.lastIndexOf("-debug.js")!==url.length-dLen){url=url.substring(0,url.length-".js".length);url+="-debug.js"}}var urlCDN="//d3c3cq33003psk.cloudfront.net/opentag-"+clientId+"-"+containerId+"-debug.js";if(url&&urlCDN!==url)debugScript.src=
url;else debugScript.src="//s3-eu-west-1.amazonaws.com/opentag/opentag-"+clientId+"-"+containerId+"-debug.js";document.getElementsByTagName("head")[0].appendChild(debugScript)};qubit.Define.namespace("qubit.opentag.Main",Main)})()})()})();(function(){})();(function(){var instance=qubit.opentag.pagevariable.Expression;var variable=new instance({"name":"Current Domain"});var pkg="live.variables.CurrentDomain1";qubit.Define.clientNamespace(pkg,variable);variable.value='(function () {\n  return document.URL.split("/").slice(0,3)[2].split(".").slice(1).join(".");\n}())'})();
(function(){var instance=qubit.opentag.filter.Filter;var filter=new instance({"include":true,"name":"Is Confirmation Page and UV Transaction Exists","priority":1});var pkg="live.filters.IsConfirmationPageAndUVTransactionExists";qubit.Define.clientNamespace(pkg,filter);filter.customStarter=function(session,cb){var waitForUV=function(time){time=time||50;var uv=window.universal_variable;if(uv&&uv.transaction)cb();else setTimeout(function(){waitForUV(time*2)},time)};waitForUV()};filter.customScript=function(session){if(window.location.href.indexOf("/checkout/confirmationpage.aspx")>
-1||window.universal_variable.transaction)return true};filter.lexicalPattern=""})();
(function(){var instance=qubit.opentag.filter.Filter;var filter=new instance({"name":"HasDefinedDuplicatedCookies"});var pkg="live.filters.HasDefinedDuplicatedCookies";qubit.Define.clientNamespace(pkg,filter);filter.customStarter=function(session,cb){cb(false)};filter.customScript=function(session){function canWorkWithLocalStorage(){var testToken="storageToken";try{var localStorage=window.localStorage;if(typeof localStorage==="object")try{localStorage.setItem(testToken,testToken);localStorage.getItem(testToken);
localStorage.removeItem(testToken)}catch(e){return false}}catch(e){return false}return true}function isDuplicatedCookie(cookieName){var name=cookieName+"\x3d";var splitCookies=document.cookie.split(";");var cookieCounter=0;var i=0;for(var len=splitCookies.length;i<len&&cookieCounter<2;i++){for(var cookie=splitCookies[i];cookie.charAt(0)===" ";)cookie=cookie.substring(1);if(cookie.indexOf(name)===0)cookieCounter++}return cookieCounter>1}var cookieList=["_qsst_s","_qst_s","_qubitCountry"];var result=
false;var canWriteOnLocalStorage=canWorkWithLocalStorage();var alreadyCleanedCookies=false;var alreadyCleanedCookiesToken="cookiesCleaned";if(canWriteOnLocalStorage)if(localStorage.getItem(alreadyCleanedCookiesToken)!=="true")localStorage.setItem(alreadyCleanedCookiesToken,"true");else alreadyCleanedCookies=true;var i$$0=0;for(var len$$0=cookieList.length;i$$0<len$$0&&!result&&!alreadyCleanedCookies;i$$0++)result=isDuplicatedCookie(cookieList[i$$0]);return result};filter.lexicalPattern=""})();
(function(){var instance=qubit.opentag.filter.Filter;var filter=new instance({"name":"Wait for require \x26 has no ff referrer","patternType":"ALL_URLS"});var pkg="live.filters.WaitForRequireHasNoFfReferrer";qubit.Define.clientNamespace(pkg,filter);filter.customStarter=function(session,cb){function waitForRequire(timeout){timeout=timeout&&timeout*2||50;var qb=window.__qubit;if(qb&&qb.amd&&qb.amd.require)cb();else setTimeout(waitForRequire,timeout)}waitForRequire()};filter.customScript=function(session){return true};
filter.lexicalPattern=""})();(function(){var instance=qubit.opentag.filter.Filter;var filter=new instance({"include":true,"name":"Default filter: Match all","pattern":"","patternType":"ALL_URLS","priority":1});var pkg="live.filters.DefaultFilterMatchAll";qubit.Define.clientNamespace(pkg,filter);filter.customStarter=null;filter.customScript=null;filter.lexicalPattern=""})();
(function(){var instance=qubit.opentag.filter.Filter;var filter=new instance({"include":true,"name":"uv_mapper_qprotocol","priority":1});var pkg="live.filters.Uv_mapper_qprotocol";qubit.Define.clientNamespace(pkg,filter);filter.customStarter=function(session,cb){cb(false)};filter.customScript=function(session){return session.getCookie("uv_mapper_qprotocol")||""};filter.lexicalPattern='{\n    "rows": [{\n        "variables": [{\n            "type": "cookie",\n            "comparator": "0",\n            "value": [\n                "uv_mapper_qprotocol",\n                ""\n            ]\n        }],\n        "starters": [],\n        "operators": []\n    }],\n    "operators": []\n}'})();
(function(){var instance=qubit.opentag.CustomTag;var tag=new instance({"dedupe":false,"locationPlaceHolder":"NOT_END","needsConsent":false,"active":true,"url":"","timeout":5E3,"async":true,"usesDocumentWrite":false,"name":"Rebuild Transaction UV","disabled":false,"id":36229983,"locked":false,"locationObject":"HEAD"});var pkg="live.tags.rebuildtransactionuv.Tag";qubit.Define.clientNamespace(pkg,tag);tag.htmlContent='\x3cscript\x3e\n  var uv \x3d window.universal_variable,\n      tuv \x3d uv.transaction,\n      small_tuv \x3d {};\n  \n  small_tuv.order_id     \x3d tuv.order_id || tuv.orderId;\n  if (typeof tuv.delivery !\x3d\x3d "undefined") {\n    small_tuv.int_order_id \x3d tuv.delivery.int_order_id;\n  }\n  small_tuv.total \t     \x3d tuv.total;\n  small_tuv.total_gbp    \x3d tuv.total_gbp;\n  small_tuv.currency \t \x3d tuv.currency || (uv \x26\x26 uv.page \x26\x26 uv.page.currencyCode);\n  \n  uv.transaction \x3d small_tuv;\n  \n  window._qtd \x3d window._qtd || [];\n  window._qtd.push({\n    resendUniversalVariables: 1\n  });\n  \n  uv.transaction \x3d tuv;\n  \n  window._qtd.push({\n    resendUniversalVariables: 1\n  });\n\x3c/script\x3e';
tag.addClientFiltersList(["live.filters.IsConfirmationPageAndUVTransactionExists"]);tag.addClientVariablesMap({});tag.addParameters([]);tag.genericDependencies=[];tag.addClientDependenciesList(["live.tags.qubitqtrackernew.Tag"]);tag.pre=function(){};tag.script=function(){};tag.post=function(){}})();
(function(){var instance=qubit.opentag.CustomTag;var tag=new instance({"name":"FF - Clean Defined Duplicated Cookies","disabled":false});var pkg="live.tags.ffcleandefinedduplicatedcookies.Tag";qubit.Define.clientNamespace(pkg,tag);tag.htmlContent="\x3cscript\x3e\n  (function () {\n  \n  var subdomainsToRemoveCookies \x3d ['www.farfetch.com','secure.farfetch.com','www.secure.farfetch.com','email.farfetch.com','emailbr.farfetch.com','emailcis.farfetch.com'];\n  var cookieList \x3d ['_qsst_s','_qst_s','_qubitCountry'];\n  var expirationDate \x3d new Date(0);\n  \n  for (var i \x3d 0, len \x3d cookieList.length; i \x3c len; i ++)\n  {\n      for(var j \x3d 0, leny \x3d subdomainsToRemoveCookies.length; j \x3c leny; j ++)\n      {\n          document.cookie \x3d cookieList[i] + '\x3d0; expires\x3d' + expirationDate.toUTCString() + \";domain\x3d\" + subdomainsToRemoveCookies[j] + \";path\x3d/;secure;\";\n          //// DELETE HOST ONLY COOKIES\n          document.cookie \x3d cookieList[i] + '\x3d0; expires\x3d' + expirationDate.toUTCString() + \";path\x3d/;secure;\";\n      }\n  }\n})();\n\x3c/script\x3e";
tag.addClientFiltersList(["live.filters.HasDefinedDuplicatedCookies"]);tag.addClientVariablesMap({});tag.addParameters([]);tag.genericDependencies=[];tag.addClientDependenciesList([]);tag.pre=function(){};tag.script=function(){};tag.post=function(){}})();
(function(){var instance=qubit.opentag.CustomTag;var tag=new instance({"name":"Qubit Save Affiliate Landing Details","description":'{\n VerticalTeam: "TNT/MKT",\n Author: "Qubit",\n ChangedBy: "Qubit",\n Reviewer: "",\n LastChangedDate: "30/03/2017",\n Version: "1.0",\n Description: ""\n}',"disabled":true});var pkg="live.tags.qubitsaveaffiliatelandingdetails.Tag";qubit.Define.clientNamespace(pkg,tag);tag.htmlContent="";tag.addClientFiltersList(["live.filters.WaitForRequireHasNoFfReferrer"]);tag.addClientVariablesMap({"CURRENTDOMAIN":"live.variables.CurrentDomain1"});
tag.addParameters([{"name":"CURRENT DOMAIN","token":"CURRENTDOMAIN"}]);tag.genericDependencies=[];tag.addClientDependenciesList(["live.tags.qubitdeliver1.Tag"]);tag.pre=function(){};tag.script=function(){window.__qubit.amd.require(["cookieman"],function(cm){var statObj={name:"new-session-landing",category:"dedupe",version:1,mode:"live",landing:window.location.href,userID:cm.get("_qubitTracker").length&&cm.get("_qubitTracker")[0].value,referrer:document.referrer||"direct"};var href=window.location.href;
var cookieContent=cm.get("qb-landing-utm").length&&cm.get("qb-landing-utm")[0].value&&decodeURI(cm.get("qb-landing-utm")[0].value);var parseCookie=function(data){try{data=data&&JSON.parse(data)||{};data.delay=parseInt(data.delay,10)||new Date((new Date).getTime()+6E4*60*24*30)-0}catch(e){data={};data.delay=new Date((new Date).getTime()+6E4*60*24*30)-0}return data};var sendEvent=function(obj){window.universal_variable=window.universal_variable||{};window.universal_variable.events=window.universal_variable.events||
[];window.universal_variable.events.push(obj)};var resetBlockThisSession=function(data){if(data.blockThisSession){delete data.blockThisSession;delete data.blockCause}};var getAffiliate=function(affiliate){var affiliates={linkshare:["http://ebates.rakuten.co.jp/","http://www.jal.co.jp/jmb/e-mile/","http://www.a-q-f.com/index.html","http://www.ana.co.jp/amc/reference/tameru/mileagemall/","http://hapitas.jp/","http://otokomaeken.com/","https://line.me/ja/","http://www.kaigai-tsuhan.com/","http://potora.jp/",
"http://fashion-express.hatenablog.jp/","http://www.fullress.com/","http://www.become.co.jp/","http://2nd-blog-cafe.sakura.ne.jp/wp/","https://dig-dug.info/","http://high-brands.com","http://tmall.tsite.jp/","http://www.jaccs.co.jp","http://mallcoin-club.panasonic.jp/coinmall/","http://www.korecow.jp/","http://dorama-fashion.com/","http://lmall.jp/","https://around50beauty.com/","http://fas.girly.jp/","http://yakkoblog626.blog51.fc2.com/","http://www.frenchohlala.com/","http://www.pointtown.com/",
"http://plaza.rakuten.co.jp/chocofashion/","http://www.dnonlinemall.jp/","https://talent-fashion.com/","http://urahara-fashion.com/","http://elne.jp/","http://www.kaigai-tsuhan-guide.com/","https://www.kaigai2han.com","http://osaifu.com/","http://www.aeoncredit.co.jp/tpt/index.html ","http://www.so-net.ne.jp/point/","http://skinnymaster.info/","http://www.gpoint.co.jp/","http://www.kaigaituhan.com/","http://kids-model-magazine.com/","https://shiogao-fashion.com/","http://pointi.jp/","https://sourceofrestockandtrend.com",
"https://www.ts3pum.com/","http://maison-okada.tokyo/","http://www.tsushin.tv/","http://baizotown.ntt-card.com/","http://poincho.ucscard.co.jp/","http://fashionmagazine.jp","http://lifemedia.jp/","http://kaiigai.com/","http://usapyonpyon.blog.so-net.ne.jp/","http://www.polyvore.com","http://www.rewardStyle.com","https://www.shoppingscanner.co.uk","http://www.lyst.com","http://www.shopstyle.fr","https://www.nuji.com","http://www.dailymail.co.uk/","http://www.weluvny.com/en/","http://www.milanstyle.com",
"http://www.fashionsauce.co.uk","http://www.bangli.uk","http://www.weibo.com/5885359931/","http://www.octer.co.uk","http://reginachow.blogspot.com","http://www.lustrelife.com","http://www.thesolesupplier.co.uk","http://www.nextjump.com/","http://www.rebatesme.com","http://www.honglingjin.co.uk","http://www.digidip.net/en","http://www.telegraph.co.uk","http://www.independent.co.uk/","http://www.shopcade.com","http://www.wardrobeicons.com","http://www.lanchic.com","http://www.redcarpet-fashionawards.com",
"http://www.threadsstyling.com","http://rahilee.blog.me","http://www.ibuyclub.com/","http://https://www.youtube.com/channel/UCFFDDhKEm6nyFWV8WncAOkw","http://www.mymanybags.blogspot.com","http://www.whowhatwear.co.uk","http://www.curatedmenswear.com/","http://www.easyfundraising.org.uk","http://intheircloset.com","www.confashions.blogspot.com","http://www.asap54fashionconcierge.com","http://www.fasheon.co.uk","http://viglink.com","http://www.whowhatwear.com","http://www.wednesdaymorningcoffee.com",
"https://sunnyqsales.com","http://www.briholloway.com","http://www.myregistry.com","http://www.semaine.com","http://www.northernmagpie.com","http://www.kture.co.uk","http://oliviapalermo.com/","http://www.fashionbeans.com","http://http://www.thejewelleryeditor.com","http://www.asosfashionfinder.com","http://www.lwcloset.com/","http://www.commeuncamion.com","http://www.coolspotters.com","http://SneakerMth.com/","http://www.solelinks.com","http://www.sheerluxe.com","http://moresneakers.com","http://dealsea.com",
"https://www.shoppingscanner.com","http://www.linktech.cn","http://www.bhg.com/shop","http://www.stylinity.com","http://stylesshopping.com","http://www.starstyle.com","http://www.brandreward.com/","http://www.mifanli.com","http://fashionstylist.com","http://www.purseblog.com/","http://shmoter.ru","http://www.dealmoon.com/","http://cools.com/","http://kojin-yunyu.net/","http://www.fortyfiveten.com","http://www.ebates.com","http://www.modalist.com","http://www.shoptagr.com","http://www.trendmill.com",
"http://keepitchic.com","http://www.shoppingJing.com","http://www.linkshare.com","http://stylemi.ru","http://polnakorzina.ru","https://heartit.kr","http://www.narrativ.com","http://www.timeinc.com","http://yieldkit.com","http://www.on-mkt.com","http://www.bragmybag.com","http://www.glamkids.com","http://bagsnob.com","http://materialworld.co","http://www.82coupon.com/","http://www.nettavisen.no/rabattkode/","http://www.foenix.co","http://www.incentivenetworks.com","http://sneakerhack.com/","http://www.luxurycheckout.com",
"http://www.kufed.com","http://www.laiamagazine.com","http://www.thezoereport.com","http://www.magiclinks.org","http://www.thevoguediaries.com","http://www.dealam.com","http://stylemi.co","http://www.gocashback.com","http://shoerazzi.com","http://shopaholicwifes.blogspot.com/","http://www.fashionline.com.hk","http://www.shopstyle.cn","http://www.55haitao.com","http://www.thekwreport.com","http://www.listupp.it","http://www.useJewel.com","http://www.celebritystyleguide.com/","http://pickyup.com","http://www.stylezeitgeist.com",
"http://deverser.blog.me/","http://www.gemologue.com","http://www.missycoupons.com","http://brandpad.ru","http://navi-london.com","http://jandrewspeaks.com","http://www.33rdrepublic.com","http://www.hausofrihanna.com","http://www.goxip.com","http://www.finder.com.au/shopping","http://www.shopback.sg","http://mastercardrewards.hk/","http://fashionlane.com.au","http://www.yiqifa.com","http://blog.naver.com/directpang","https://www.kaigai2han.com/","http://www.biyroamer.com","http://deals.huaren.us; http://forums.huaren.us",
"http://celiawong.com","https://www.stylicy.com/au/","https://theurge.com.au","http://mastercardrewards.cn/","http://www.duomai.com","http://www.shop.com","http://www.linkprice.com/home/linkprice0101_eng.htm","http://www.buluanmai.com","http://blog.naver.com/pic7800","http://baekstage.com","http://blog.naver.com/soyouplus","http://blog.naver.com/hunyaholic","http://www.xiyanghui.com","http://onlineshopmy.com/","http://haitao.smzdm.com/","http://cafe.naver.com/dieselmania","http://www.gosscloset.com/shopping-mall.html",
"http://www.shopback.my"],zanox:["http://www.fashiola.fr","https://www.stylelounge.fr","http://www.shoppingscanner.co.uk","http://www.dealscove.com/","http://listupp.com/","http://www.rewardStyle.com","http://digidip.net","http://www.37-express.com/fr/?___from_store\x3dcn","http://www.VigLink.com","http://publickids.com/","http://www.navyweb.fr/","http://sneakermyth.com","http://fr.flayr.com/","http://www.collinsonlatitude.com/","http://www.shopcade.com","http://www.standard.co.uk/","http://yifenqian.fr/app",
"http://www.shopstyle.fr","https://www.codereductions.fr/","http://www.stylonomy.fr/","http://www.brandreward.com/","http://www.shoppingscanner.it","http://listupp.it","http://www.sellektor.com","www.dazhe.de/de","http://www.shopalike.dk","https://www.rebatly.com/es","http://www.shoppingspout.de/","http://www.shopalike.nl/","https://gutscheine.heise.de","http://modasto.se","http://www.thelabelfinder.nl","onlineshopping.miles-and-more.com","http://shoptagr.com","http://whatstylewant.com","http://www.shoppingscanner.pl",
"https://zale.dk","http://www.stylink.com","https://blackfridaydeals.nu/","http://www.shopello.se","http://earnonline.flyingbluenews.com","http://www.motikk.com","http://www.woolrich-jassen.nl","http://styletorch.com","http://www.revendless.com","http://www.shopello.dk","http://leadhaber.com","http://mevio.be","http://www.fashiola.pl","http://stylelane.com","http://www.shopello.fi/","http://www.madeformellowdays.com","http://www.shopylandia.it/","http://hightrend.dk","http://www.fashiola.es","http://es.listupp.com",
"http://www.shoppingscanner.es","http://elpais.com/","https://lookastic.es","http://ibplustore.iberia.com/","http://www.shopspy.lt/","http://descuentos.lavanguardia.com/","https://www.picodi.com/pt/"],admitad:["r24-tech.com","http://lookbuck.com/","http://justbutik.ru/","http://shopsy.ru/","http://likewearua.com/","http://\u043a\u0430\u043d\u0430\u0434\u0430\u0433\u0443\u0441.\u0440\u0444/","http://odevajka-obuvajka.ru/","https://smartshopper.ru/","http://snik.co/","http://www.kz.clouty.com/","http://mecash.ru/",
"http://lepodium.ru/","http://modamay.by/","http://shopomio.ru/","http://lagarderob.ru/","http://buduvmode.ru/","http://daybag.ru/","http://by.megashop-online.ru/","http://teasernet.com/","https://www.youtube.com/user/DiGa3000/","http://all-wear-shops.ru/","http://recreativ.ru/","http://compromesso.ru/","http://www.lookshops.ru/","https://www.comprigo.ru/","https://themodish.ru/","http://kelkoo.ru/","http://terra.im/"],performancehorizon:["http://www.shopstyle.co.uk","http://www.lyst.com","http://givingassistant.org",
"http://www.ebates.com","http://www.dealmoon.com","http://modesens.com","http://www.topcashback.com","http://www.mrrebates.com","http://www.viglink.com","http://www.cartera.com","http://www.gocashback.com","https://shopping.avios.com/","http://skimlinks.com","http://www.highsnobiety.com/","http://www.shoppingscanner.it","http://www.condenast.com/","http://www.solelinks.com","http://cheepish.com/w888bizmarriottcsl/","http://www.fashiola.es","http://nextjump.com","http://www.dealam.com","http://whowhatwear.com",
"http://www.flexoffers.com","https://www.shoptagr.com","http://www.magiclinks.org","http://www.asperity.com","https://keepitchic.com","https://www.shopstyle.co.uk/","https://www.ozdiscount.net/","http://www.topcashback.co.uk","http://www.brandreward.com/","http://www.promopro.co.uk/","http://weibo.com/ukshopstop","http://www.honglingjin.co.uk/","http://www.whowhatwear.co.uk","https://www.chicmi.com/","http://www.giveasyoulive.com","http://www.shoppingjing.com/","https://www.picodi.com/sg/","http://www.acties.nl/",
"http://www.sneakers4u.nl","http://fashionlab.nl/","https://www.couturefashion.nl/","http://www.kortingscode.nl/","http://shoppable.nl","http://www.shopkorting.nl","https://www.supersales.nl","https://www.shopbuddies.nl/","https://jakandjil.co","http://www.ippies.nl","http://fashionandbusiness.nl","http://digidip.net","http://www.ebates.kr","http://www.mallree.com","https://www.shopstyle.co.jp","https://www.shopstyle.de/","http://www.schnaeppchenfuchs.com","http://www.coupons4u.de","http://www.gutscheinrausch.de/",
"http://www.payback.de","https://www.stylelounge.nl/","http://www.shoop.de","http://www.gutscheincodes.de","http://www.style-observer.com","https://www.trillr.de","http://www.adgoal.de","http://www.yuanpinxiu.cn","http://Fashionhype.com","http://www.stylist24.de/","http://onlineshopping.miles-and-more.com","http://www.symbaloo.com","http://www.linkhaitao.com","http://www.duomai.com/","http://www.extrabux.com","https://www.chinesean.com","http://www.mifanli.com","http://www.55haitao.com","http://www.blinghour.com",
"http://www.weibo.com/baijie001","http://www.yiqifa.com","https://www.shopstyle.cn/","http://www.rebatesme.com","http://www.linktech.cn/newhome/","http://www.smzdm.com/","https://weibo.com/skylosttears","https://www.shopstyle.ca","http://www.youtube.com/c/fashionablyamy","http://shopstyle.com.au","http://www.cashrewards.com.au","http://www.thebargainavenue.com.au","http://www.kaigai2han.com/","http://www.dealmoon.com.au","https://www.stylicy.com","http://www.shopstyle.com.au","https://goxip.com/hk",
"http://www.linkhaitao.com","http://stylelounge.se","https://www.stylelounge.de","http://www.lustrelife.com","http://www.slipperswinkel.com","http://www.horloges4u.com","http://www.runhotel.hk","http://www.hotdeals.com","https://www.promospro.com","https://www.codespromofr.com/","https://www.allecodes.de/","https://www.savelution.com/","http://www.fyvor.com/","https://www.updays.com/","https://www.yessavings.com/","http://www.fashiola.de","http://www.fashiola.co.uk","http://www.fashiola.fr","http://www.kleding.nl",
"https://www.whatdropsnow.com/","https://www.shopping.ba.com/","https://www.rewards-redspottedhanky.com/"]};affiliates=affiliates[affiliate];var matchingAffiliate=document.referrer.match(new RegExp(affiliates.join("|")));return matchingAffiliate&&matchingAffiliate[0]};var saveIfZanoxLinkshareAdmitadPerformanceHorizon=function(data){if(href.match(/utm_medium=(aff|referral)/i)||href.match(/src=(linkshare|zanox|admitad)/i)||href.match(/utm_campaign=PH(AU|CA|CN|FR|DE|IT|JP|KR|NL|ROW|UK|US)/ig)){var affiliate;
if(href.match(/linkshare|zanox|admitad/i))affiliate=href.match(/linkshare|zanox|admitad/i);else if(href.match(/PH(AU|CA|CN|FR|DE|IT|JP|KR|NL|ROW|UK|US)/ig))affiliate=["performancehorizon"];affiliate=affiliate&&affiliate[0]&&affiliate[0].toLowerCase();if(affiliate){data.delay=new Date((new Date).getTime()+6E4*60*24*30)-0;data.affiliate=affiliate}else{data.blockThisSession=true;data.blockCause="non-linkshare/zanox/admitad/performancehorizon affiliate"}}};var saveIfDisplayOrEmailLink=function(data){if(href.match(/utm_medium=(email|display)/i)&&
!href.match(/AUTOMA|SAV_|BR_|WELCOM|Welcome1|AUTOMWISH/i)){data.blockThisSession=true;data.blockCause="email or display"}};var saveIfSEOLink=function(data){if(/google|bing|yahoo|baidu|duckduckgo|exalead|gigablast|sogou|soso|volunia|yandex|yodao|dogpile|yippy|blingo|info|deeperweb|hotbot|kayak/.test(document.referrer)){data.blockThisSession=true;data.blockCause="seo"}};var saveIfPPCLink=function(data){var fromPPC=href.match(/(utm_medium=(cpc|paid_search|ppc)|gclid=|bfdqbt=)/i);var notBrand=href.match(/^((?!campaign=brand).)*$/i);
if(fromPPC&&notBrand){data.blockThisSession=true;data.blockCause="ppc"}};var data$$0=parseCookie(cookieContent);resetBlockThisSession(data$$0);saveIfZanoxLinkshareAdmitadPerformanceHorizon(data$$0);saveIfDisplayOrEmailLink(data$$0);saveIfSEOLink(data$$0);statObj.data=data$$0;sendEvent(statObj);if(data$$0.affiliate){if(getAffiliate(data$$0.affiliate))data$$0.affiliateDomain=getAffiliate(data$$0.affiliate);cm.set("qb-landing-utm",encodeURI(JSON.stringify(data$$0)),{path:"/",expires:new Date(data$$0.delay),
domain:".farfetch.com"})}})};tag.post=function(){}})();
(function(){var instance=qubit.opentag.CustomTag;var tag=new instance({"dedupe":false,"locationPlaceHolder":"NOT_END","needsConsent":false,"active":true,"description":'{\n VerticalTeam: "PRIME/MKT",\n Author: "",\n ChangedBy: "Armando Moreira",\n Reviewer: "",\n LastChangedDate: "17/06/2016",\n Version: "1.0",\n Description: "Change Pixels to HTTPS"\n}',"url":"https://dd6zx4ibq538k.cloudfront.net/smartserve-2034.js","timeout":5E3,"async":true,"usesDocumentWrite":false,"name":"Qubit Deliver (2)","disabled":false,
"locked":false,"locationObject":"HEAD"});var pkg="live.tags.qubitdeliver1.Tag";qubit.Define.clientNamespace(pkg,tag);tag.htmlContent="";tag.addClientFiltersList(["live.filters.DefaultFilterMatchAll"]);tag.addClientVariablesMap({});tag.addParameters([]);tag.genericDependencies=[];tag.addClientDependenciesList([]);tag.pre=function(){};tag.script=function(){};tag.post=function(){}})();
(function(){var instance=qubit.opentag.CustomTag;var tag=new instance({"dedupe":false,"locationPlaceHolder":"NOT_END","needsConsent":false,"active":true,"description":'{\n VerticalTeam: "PRIME/MKT",\n Author: "",\n ChangedBy: "Armando Moreira",\n Reviewer: "",\n LastChangedDate: "17/06/2016",\n Version: "1.0",\n Description: "Change Pixels to HTTPS"\n}',"url":"dtxtngytz5im1.cloudfront.net/qtracker-5.0.0.min.js","timeout":5E3,"async":true,"usesDocumentWrite":false,"prePostWindowScope":true,"name":"Qubit QTracker (New)",
"disabled":false,"id":35686881,"locked":false,"locationObject":"HEAD"});var pkg="live.tags.qubitqtrackernew.Tag";qubit.Define.clientNamespace(pkg,tag);tag.htmlContent="";tag.addClientFiltersList([]);tag.addClientVariablesMap({});tag.addParameters([]);tag.genericDependencies=[];tag.addClientDependenciesList([]);tag.pre=function(){window._qtd=[{options:{domain:".farfetch.com",serverUrl:"pong.qubitproducts.com/t2",clientId:"farfetch"}}];_qtd.push({custom:{_c_sc_sub:{type:"fn",key:function(){return $(".lbSubTotal").text().replace(/[^0-9\.]/g,
"")},pattern:"newcheckb4.aspx"}}});_qtd.push({custom:{_c_sc_dc:{type:"fn",key:function(){return $(".lbShippingTotal").text().replace(/[^0-9\.]/g,"")},pattern:"newcheckb4.aspx"}}});_qtd.push({custom:{_c_sc_val:{type:"fn",key:function(){return $(".lbShoppingTotal").text().replace(/[^0-9\.]/g,"")},pattern:"newcheckb4.aspx"}}});_qtd.push({custom:{_c_con_ct:{type:"fn",key:function(){if(window.$&&window.$(".lbShoppingTotal").length>0)return $(".lbShoppingTotal").text();else return null},pattern:"newcheckb5.aspx"}}});
_qtd.push({custom:{_c_con_msg:{type:"id",key:"ctl00_ctl00_dvMessages",pattern:"newcheckb1.aspx?rnd\x3d"}}});_qtd.push({custom:{_c_sc_cu:{type:"fn",key:function(){if(window.$){var value=$(".lbShoppingTotal").text();if(!value)return null;if(value.indexOf("\u00a3")>=0)return"GBP";if(value.indexOf("\u20ac")>=0)return"EUR";if(value.indexOf("$")>=0)return"USD";return"OTHER:"+value}},pattern:"newcheckb4.aspx"}}});_qtd.push({custom:{_c_con_cu:{type:"fn",key:function(){if(window.$){var value=$(".lbShoppingTotal").text();
if(!value)return null;if(value.indexOf("\u00a3")>=0)return"GBP";if(value.indexOf("\u20ac")>=0)return"EUR";if(value.indexOf("$")>=0)return"USD";return"OTHER:"+value}},pattern:"newcheckb5.aspx"}}});_qtd.push({custom:{_c_op_bu:{type:"fn",key:function(){if(document.cookie.indexOf("optimizelyBucket")>=0){var cookie=document.cookie.indexOf("optimizelyBucket");var ___dc=document.cookie.substring(cookie);return ___dc.substring(18,___dc.indexOf("; "))}},pattern:".*"}}});_qtd.push({custom:{_c_cookie:{type:"fn",
key:function(){var readCookie=function(name){var nameEQ=name+"\x3d";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){for(var c=ca[i];c.charAt(0)==" ";)c=c.substring(1,c.length);if(c.indexOf(nameEQ)===0)return c.substring(nameEQ.length,c.length)}return null};var cookieName="s_kenid";var value=readCookie(cookieName);if(value)return{name:cookieName,value:value};else return null},pattern:".*"}}})};tag.script=function(){};tag.post=function(){}})();
(function(){var instance=qubit.opentag.CustomTag;var tag=new instance({"dedupe":false,"locationPlaceHolder":"NOT_END","needsConsent":false,"active":true,"url":"https://d1m54pdnjzjnhe.cloudfront.net/farfetch/exit-feedback/farfetch-custom-parent-selector-pfb.min.js","timeout":5E3,"async":true,"usesDocumentWrite":false,"prePostWindowScope":true,"name":"Qubit Proactive Exit Feedback","disabled":false,"id":36229978,"locked":false,"locationObject":"HEAD"});var pkg="live.tags.qubitproactiveexitfeedback.Tag";
qubit.Define.clientNamespace(pkg,tag);tag.htmlContent="";tag.addClientFiltersList(["live.filters.DefaultFilterMatchAll"]);tag.addClientVariablesMap({});tag.addParameters([]);tag.genericDependencies=[];tag.addClientDependenciesList([]);tag.pre=function(){window.q_pfb_opts={"triggerElement":window.jQuery("#qb-pfb-toggle"),"$":window.jQuery,"showProb":.6,"hideFilter":"farfetch.com/holiday/wonderfulstore/|/br","journeyDepth":1,"closeCountDays":30,"trackingId":"farfetch","domain":".farfetch.com","clientId":33446,
"profileId":2034,"configId":14}};tag.script=function(){};tag.post=function(){}})();
(function(){var instance=qubit.opentag.CustomTag;var tag=new instance({"dedupe":false,"locationPlaceHolder":"NOT_END","needsConsent":false,"active":true,"url":"","timeout":5E3,"async":true,"usesDocumentWrite":false,"name":"Qubit UV Mapper (qprotocol)","disabled":true,"id":40383657,"locked":false,"locationObject":"HEAD"});var pkg="live.tags.qubituvmapperqprotocol.Tag";qubit.Define.clientNamespace(pkg,tag);tag.htmlContent='\x3cscript\x3e\n/*\n  Git commit sha: b8df2116d35bd6707d789b6ff73fb77ab299e9b1\n  Map name: universal-variable-ec\n*/\n(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a\x3dtypeof require\x3d\x3d"function"\x26\x26require;if(!u\x26\x26a)return a(o,!0);if(i)return i(o,!0);var f\x3dnew Error("Cannot find module \'"+o+"\'");throw f.code\x3d"MODULE_NOT_FOUND",f}var l\x3dn[o]\x3d{exports:{}};t[o][0].call(l.exports,function(e){var n\x3dt[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i\x3dtypeof require\x3d\x3d"function"\x26\x26require;for(var o\x3d0;o\x3cr.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nvar isoCountries\x3d{AF:"Afghanistan",AX:"Aland Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua And Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BA:"Bosnia And Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo",CD:"Congo, Democratic Republic",CK:"Cook Islands",CR:"Costa Rica",CI:"Cote D\'Ivoire",HR:"Croatia",CU:"Cuba",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Territories",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island \x26 Mcdonald Islands",VA:"Holy See (Vatican City State)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic Of",IQ:"Iraq",IE:"Ireland",IM:"Isle Of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KR:"Korea",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People\'s Democratic Republic",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libyan Arab Jamahiriya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, Federated States Of",MD:"Moldova",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",AN:"Netherlands Antilles",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestinian Territory, Occupied",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"Reunion",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint Barthelemy",SH:"Saint Helena",KN:"Saint Kitts And Nevis",LC:"Saint Lucia",MF:"Saint Martin",PM:"Saint Pierre And Miquelon",VC:"Saint Vincent And Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome And Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia And Sandwich Isl.",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard And Jan Mayen",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad And Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks And Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela",VN:"Viet Nam",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",WF:"Wallis And Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"};module.exports\x3dfunction(a){return a\x26\x26isoCountries[a.toUpperCase()]||a};\n\n\n},{}],2:[function(require,module,exports){\nvar each\x3drequire("amp-each"),isNumber\x3drequire("amp-is-number"),isEmpty\x3drequire("amp-is-empty");module.exports\x3dfunction(e){var r\x3d{};return each(e,function(e,i){(!isEmpty(e)||isNumber(e))\x26\x26(r[i]\x3de)}),r};\n\n\n},{"amp-each":36,"amp-is-empty":60,"amp-is-number":68}],3:[function(require,module,exports){\nvar isNumber\x3drequire("amp-is-number"),isString\x3drequire("amp-is-string");module.exports\x3dfunction(r){return isNumber(r)?r:isString(r)\x26\x26r.length\x3e0\x26\x26!isNaN(Number(r))?Number(r):void 0};\n\n\n},{"amp-is-number":68,"amp-is-string":70}],4:[function(require,module,exports){\nfunction pollFor(o,l){return o()?void l():void setTimeout(function(){poll(o,l,50)},0)}function poll(o,l,t){return o()?void l():void setTimeout(function(){poll(o,l,2*t)},t)}module.exports\x3dpollFor;\n\n\n},{}],5:[function(require,module,exports){\nvar values\x3drequire("amp-values"),mapper\x3drequire("./mapper"),mapFiles\x3d{"..":{maps:{"universal-variable-ec":{"ec-basket-item-transaction":require("../maps/universal-variable-ec/ec-basket-item-transaction.js"),"ec-basket-item":require("../maps/universal-variable-ec/ec-basket-item.js"),"ec-product-interaction":require("../maps/universal-variable-ec/ec-product-interaction.js"),"ec-product-recommendation":require("../maps/universal-variable-ec/ec-product-recommendation.js"),"ec-product":require("../maps/universal-variable-ec/ec-product.js"),search:require("../maps/universal-variable-ec/search.js"),user:require("../maps/universal-variable-ec/user.js"),view:require("../maps/universal-variable-ec/view.js")}}}},maps\x3dvalues(mapFiles[".."].maps["universal-variable-ec"]),uv\x3dwindow.uv;uv\x26\x26uv.events\x26\x26mapper(maps,uv);\n},{"../maps/universal-variable-ec/ec-basket-item-transaction.js":7,"../maps/universal-variable-ec/ec-basket-item.js":8,"../maps/universal-variable-ec/ec-product-interaction.js":9,"../maps/universal-variable-ec/ec-product-recommendation.js":10,"../maps/universal-variable-ec/ec-product.js":11,"../maps/universal-variable-ec/search.js":27,"../maps/universal-variable-ec/user.js":28,"../maps/universal-variable-ec/view.js":29,"./mapper":6,"amp-values":103}],6:[function(require,module,exports){\nfunction viewEvents(e){return filter(e,function(e){return"View"\x3d\x3d\x3de.eventType})}function notViewEvents(e){return filter(e,function(e){return"View"!\x3d\x3de.eventType})}var each\x3drequire("amp-each"),filter\x3drequire("amp-filter");module.exports\x3dfunction(e,n){function t(e){function t(){var t\x3de.mapFn.apply(this,arguments);t?n.emit(e.eventType,t):n.emit(e.eventType)}e.activation?e.activation(t):t()}n.once("View",function(){each(notViewEvents(e),t)}),each(viewEvents(e),t)};\n\n\n},{"amp-each":36,"amp-filter":51}],7:[function(require,module,exports){\nvar each\x3drequire("amp-each"),extend\x3drequire("amp-extend"),pollFor\x3drequire("../../helpers/poll-for"),convertBasket\x3drequire("./helpers/convert-basket"),convertProduct\x3drequire("./helpers/convert-product"),excludeEmpty\x3drequire("../../helpers/exclude-empty"),convertTransaction\x3drequire("./helpers/convert-transaction"),customItem\x3drequire("./helpers/custom-item"),customProduct\x3drequire("./helpers/custom-product"),customTransaction\x3drequire("./helpers/custom-transaction"),getPrice\x3drequire("./helpers/get-price"),ifNumberThenCast\x3drequire("../../helpers/if-number-then-cast");module.exports\x3d{eventType:"ec.BasketItemTransaction",activation:function(e){function t(){return window.universal_variable\x26\x26window.universal_variable.transaction}function r(){each(window.universal_variable.transaction.line_items,e)}pollFor(t,r)},mapFn:function(e){var t\x3dwindow.universal_variable.transaction;return excludeEmpty({product:convertProduct(e.product),basket:convertBasket(t,t.order_id),stock:ifNumberThenCast(e.product.stock),color:e.product.color,size:e.product.size,quantity:ifNumberThenCast(e.quantity),subtotal:getPrice(e.product,e.subtotal),shippingMethod:e.shipping_method,shippingCost:getPrice(e.product,e.shipping_cost),transaction:convertTransaction(t),custom:extend(customTransaction(t),customProduct(e.product),customItem(e))})}};\n\n\n},{"../../helpers/exclude-empty":2,"../../helpers/if-number-then-cast":3,"../../helpers/poll-for":4,"./helpers/convert-basket":13,"./helpers/convert-product":14,"./helpers/convert-transaction":15,"./helpers/custom-item":18,"./helpers/custom-product":21,"./helpers/custom-transaction":22,"./helpers/get-price":26,"amp-each":36,"amp-extend":49}],8:[function(require,module,exports){\nvar each\x3drequire("amp-each"),extend\x3drequire("amp-extend"),pollFor\x3drequire("../../helpers/poll-for"),convertBasket\x3drequire("./helpers/convert-basket"),convertProduct\x3drequire("./helpers/convert-product"),customItem\x3drequire("./helpers/custom-item"),customBasket\x3drequire("./helpers/custom-basket"),customProduct\x3drequire("./helpers/custom-product"),excludeEmpty\x3drequire("../../helpers/exclude-empty"),getPrice\x3drequire("./helpers/get-price"),ifNumberThenCast\x3drequire("../../helpers/if-number-then-cast");module.exports\x3d{eventType:"ec.BasketItem",activation:function(e){function t(){var e\x3dwindow.universal_variable\x26\x26window.universal_variable.transaction;return window.universal_variable\x26\x26window.universal_variable.basket\x26\x26!e}function r(){each(window.universal_variable.basket.line_items,e)}pollFor(t,r)},mapFn:function(e){var t\x3dwindow.universal_variable.basket;return excludeEmpty({product:convertProduct(e.product),basket:convertBasket(t,t.id),stock:ifNumberThenCast(e.product.stock),color:e.product.color,size:e.product.size,quantity:ifNumberThenCast(e.quantity),subtotal:getPrice(e.product,e.subtotal),shippingMethod:e.shipping_method,shippingCost:getPrice(e.product,e.shipping_cost),custom:extend(customBasket(t),customProduct(e.product),customItem(e))})}};\n\n\n},{"../../helpers/exclude-empty":2,"../../helpers/if-number-then-cast":3,"../../helpers/poll-for":4,"./helpers/convert-basket":13,"./helpers/convert-product":14,"./helpers/custom-basket":17,"./helpers/custom-item":18,"./helpers/custom-product":21,"./helpers/get-price":26,"amp-each":36,"amp-extend":49}],9:[function(require,module,exports){\nvar pollFor\x3drequire("../../helpers/poll-for"),excludeEmpty\x3drequire("../../helpers/exclude-empty"),convertProduct\x3drequire("./helpers/convert-product"),customProduct\x3drequire("./helpers/custom-product"),ifNumberThenCast\x3drequire("../../helpers/if-number-then-cast");module.exports\x3d{eventType:"ec.ProductInteraction",activation:function(e){function r(){return window.universal_variable\x26\x26window.universal_variable.product}function o(){e(window.universal_variable.product)}pollFor(r,o)},mapFn:function(e){return excludeEmpty({product:convertProduct(e),stock:ifNumberThenCast(e.stock),color:e.color,size:e.size,action:"detail",custom:customProduct(e)})}};\n\n\n},{"../../helpers/exclude-empty":2,"../../helpers/if-number-then-cast":3,"../../helpers/poll-for":4,"./helpers/convert-product":14,"./helpers/custom-product":21}],10:[function(require,module,exports){\nvar each\x3drequire("amp-each"),pollFor\x3drequire("../../helpers/poll-for"),convertProduct\x3drequire("./helpers/convert-product"),customProduct\x3drequire("./helpers/custom-product"),excludeEmpty\x3drequire("../../helpers/exclude-empty"),ifNumberThenCast\x3drequire("../../helpers/if-number-then-cast");module.exports\x3d{eventType:"ec.ProductRecommendation",activation:function(e){function r(){var e\x3dwindow.universal_variable\x26\x26window.universal_variable.recommendation;return e\x26\x26e.items\x26\x26e.items.length\x3e0}function o(){each(window.universal_variable.recommendation.items,e)}pollFor(r,o)},mapFn:function(e,r,o){return excludeEmpty({product:convertProduct(e),stock:ifNumberThenCast(e.stock),color:e.color,size:e.size,rank:1\x3d\x3d\x3do.length?0:r/(o.length-1),custom:customProduct(e)})}};\n\n\n},{"../../helpers/exclude-empty":2,"../../helpers/if-number-then-cast":3,"../../helpers/poll-for":4,"./helpers/convert-product":14,"./helpers/custom-product":21,"amp-each":36}],11:[function(require,module,exports){\nvar each\x3drequire("amp-each"),uuid\x3drequire("really-unique-id"),pollFor\x3drequire("../../helpers/poll-for"),excludeEmpty\x3drequire("../../helpers/exclude-empty"),convertProduct\x3drequire("./helpers/convert-product"),customProduct\x3drequire("./helpers/custom-product"),ifNumberThenCast\x3drequire("../../helpers/if-number-then-cast");module.exports\x3d{eventType:"ec.Product",activation:function(e){function r(){var e\x3dwindow.universal_variable\x26\x26window.universal_variable.listing;return window.universal_variable\x26\x26window.universal_variable.product||e\x26\x26e.items\x26\x26e.items.length\x3e0}function i(){if(window.universal_variable.product){var r\x3d{};window.universal_variable.product.linked_products\x26\x26window.universal_variable.product.linked_products.length\x3e0\x26\x26(r.uuid\x3duuid(),each(window.universal_variable.product.linked_products,e,r)),e.call(r,window.universal_variable.product)}else{var i\x3dwindow.universal_variable.listing.items.slice(0,4);each(i,e)}}pollFor(r,i)},mapFn:function(e){return excludeEmpty({product:convertProduct(e,this.uuid),stock:ifNumberThenCast(e.stock),color:e.color,size:e.size,custom:customProduct(e)})}};\n\n\n},{"../../helpers/exclude-empty":2,"../../helpers/if-number-then-cast":3,"../../helpers/poll-for":4,"./helpers/convert-product":14,"./helpers/custom-product":21,"amp-each":36,"really-unique-id":106}],12:[function(require,module,exports){\nvar excludeEmpty\x3drequire("../../../helpers/exclude-empty"),convertCountryCode\x3drequire("../../../helpers/convert-country-code");module.exports\x3dfunction(e){if(e){var r\x3dexcludeEmpty({recipient:e.name,locality:e.city,region:e.state,postalCode:e.postcode,country:convertCountryCode(e.country),countryCode:e.country});return e.address\x26\x26e.address.length\x26\x26(r.lines\x3d[e.address]),excludeEmpty(r)}};\n\n\n},{"../../../helpers/convert-country-code":1,"../../../helpers/exclude-empty":2}],13:[function(require,module,exports){\nvar reduce\x3drequire("amp-reduce"),isBoolean\x3drequire("amp-is-boolean"),excludeEmpty\x3drequire("../../../helpers/exclude-empty"),ifNumberThenCast\x3drequire("../../../helpers/if-number-then-cast"),getPrice\x3drequire("./get-price");module.exports\x3dfunction(e,t){function i(e,t){return ifNumberThenCast(t.quantity)?ifNumberThenCast(t.quantity)+e:e}if(e){var r\x3dexcludeEmpty({id:t,subtotal:getPrice(e,e.subtotal),total:getPrice(e,e.total),vouchers:e.vouchers,voucherDiscount:getPrice(e,e.voucher_discount),promotions:e.promotions,promotionDiscount:getPrice(e,e.promotion_discount),tax:getPrice(e,e.tax),shippingPrice:getPrice(e,e.shipping_cost),shippingMethod:e.shipping_method});if(e.line_items\x26\x26e.line_items.length){var o\x3d0;r.quantity\x3dreduce(e.line_items,i,o)}return e.tax\x26\x26isBoolean(e.subtotal_include_tax)\x26\x26!e.subtotal_include_tax\x26\x26(r.subtotal.value+\x3de.tax),r}};\n\n\n},{"../../../helpers/exclude-empty":2,"../../../helpers/if-number-then-cast":3,"./get-price":26,"amp-is-boolean":59,"amp-reduce":98}],14:[function(require,module,exports){\nvar getPrice\x3drequire("./get-price"),getCategory\x3drequire("./get-category"),excludeEmpty\x3drequire("../../../helpers/exclude-empty");module.exports\x3dfunction(e,r){if(e){var i\x3dexcludeEmpty({name:e.name,id:e.id,sku:e.sku_code,url:e.url,description:e.description,manufacturer:e.manufacturer,stock:e.stock,groupId:r});return i.price\x3dgetPrice(e,e.unit_sale_price||e.unit_price),i.originalPrice\x3dgetPrice(e,e.unit_price||e.unit_sale_price),i.category\x3dgetCategory(e),e.color\x26\x26(i.colors\x3d[e.color]),e.image\x26\x26(i.images\x3d[e.image]),e.size\x26\x26(i.sizes\x3d[e.size]),excludeEmpty(i)}};\n\n\n},{"../../../helpers/exclude-empty":2,"./get-category":25,"./get-price":26}],15:[function(require,module,exports){\nvar isBoolean\x3drequire("amp-is-boolean"),excludeEmpty\x3drequire("../../../helpers/exclude-empty"),convertAddress\x3drequire("./convert-address");module.exports\x3dfunction(e){if(e){var r\x3dexcludeEmpty({id:e.order_id,paymentType:e.payment_type,billingAddress:convertAddress(e.billing),deliveryAddress:convertAddress(e.delivery)});return isBoolean(e.returning)\x26\x26(r.firstTransaction\x3d!e.returning),r}};\n\n\n},{"../../../helpers/exclude-empty":2,"./convert-address":12,"amp-is-boolean":59}],16:[function(require,module,exports){\nfunction parseName(e){var a\x3d{};return a.title\x3dgetMatch(e,/(mr|mrs|miss|dr)?\\.?\\s+/i,0),a.title?a.firstName\x3dgetMatch(e,/(mr|mrs|miss|dr)?\\.?\\s+([a-z-\']+)/i,1):a.firstName\x3dgetMatch(e,/([a-z-\\\']+)/i,0),a.lastName\x3dgetMatch(e,/\\b([a-z-\\\']+)$/i,0),capitalizeValues(a)}function capitalizeValues(e){var a\x3d{};return each(excludeEmpty(e),function(e,t){a[t]\x3dcapitalize(e)}),a}function getMatch(e,a,t){return e.match(a)\x26\x26e.match(a)[t+1]}var isBoolean\x3drequire("amp-is-boolean"),each\x3drequire("amp-each"),capitalize\x3drequire("capitalize"),excludeEmpty\x3drequire("../../../helpers/exclude-empty");module.exports\x3dfunction(e){if(e){var a\x3d{};e.name\x26\x26e.name.length\x26\x26(a\x3dparseName(e.name));var t\x3dexcludeEmpty({id:e.user_id,title:a.title,firstName:a.firstName,lastName:a.lastName,gender:e.gender,username:e.username,email:e.email,language:e.language,hasTransacted:e.has_transacted,facebookId:e.facebook_id,twitterId:e.twitter_id,currency:e.currency});return isBoolean(e.returning)\x26\x26(t.firstSession\x3d!e.returning),t}};\n\n\n},{"../../../helpers/exclude-empty":2,"amp-each":36,"amp-is-boolean":59,"capitalize":104}],17:[function(require,module,exports){\nfunction customBasket(t){return findCustom(t,["id","currency","subtotal","subtotal_include_tax","vouchers","voucher_discount","promotions","promotion_discount","tax","shipping_cost","shipping_method","total","line_items"])}var findCustom\x3drequire("./find-custom");module.exports\x3dcustomBasket;\n\n\n},{"./find-custom":24}],18:[function(require,module,exports){\nfunction customItem(t){return findCustom(t,["product","quantity","subtotal","shipping_method","shipping_cost"])}var findCustom\x3drequire("./find-custom");module.exports\x3dcustomItem;\n\n\n},{"./find-custom":24}],19:[function(require,module,exports){\nfunction customListing(t){return findCustom(t,["query","items","result_count","sort_by","layout"])}var findCustom\x3drequire("./find-custom");module.exports\x3dcustomListing;\n\n\n},{"./find-custom":24}],20:[function(require,module,exports){\nfunction customPage(e){return findCustom(e,["type","breadcrumb","environment","category","subcategory"])}var findCustom\x3drequire("./find-custom");module.exports\x3dcustomPage;\n\n\n},{"./find-custom":24}],21:[function(require,module,exports){\nfunction customProduct(r){return findCustom(r,["id","url","name","description","manufacturer","category","subcategory","linked_products","currency","unit_sale_price","unit_price","sku_code","stock","color","size"])}var findCustom\x3drequire("./find-custom");module.exports\x3dcustomProduct;\n\n\n},{"./find-custom":24}],22:[function(require,module,exports){\nfunction customTransaction(t){return findCustom(t,["order_id","returning","currency","payment_type","subtotal","subtotal_include_tax","vouchers","voucher_discount","promotions","promotion_discount","tax","shipping_cost","shipping_method","total","delivery","billing","line_items"])}var findCustom\x3drequire("./find-custom");module.exports\x3dcustomTransaction;\n\n\n},{"./find-custom":24}],23:[function(require,module,exports){\nfunction customUser(e){return findCustom(e,["name","username","user_id","email","language","returning","has_transacted","facebook_id","twitter_id"])}var findCustom\x3drequire("./find-custom");module.exports\x3dcustomUser;\n\n\n},{"./find-custom":24}],24:[function(require,module,exports){\nfunction findCustom(e,r){if(!e)return{};var i\x3dkeys(e),t\x3dfilter(i,function(r){return!isObject(e[r])||isSimpleArray(e[r])}),u\x3ddifference(t,r);return pick(e,u)}function isSimpleArray(e){return isArray(e)\x26\x26every(e,function(e){return!isObject(e)})}var keys\x3drequire("amp-keys"),pick\x3drequire("amp-pick"),filter\x3drequire("amp-filter"),every\x3drequire("amp-every"),isObject\x3drequire("amp-is-object"),isArray\x3drequire("amp-is-array"),difference\x3drequire("amp-difference");module.exports\x3dfindCustom;\n\n\n},{"amp-difference":30,"amp-every":42,"amp-filter":51,"amp-is-array":58,"amp-is-object":69,"amp-keys":71,"amp-pick":92}],25:[function(require,module,exports){\nmodule.exports\x3dfunction(r){var e\x3dr.breadcrumb||[];return e.length\x3e0?e:(r.category\x26\x26e.push(r.category),r.subcategory\x26\x26e.push(r.subcategory),e)};\n\n\n},{}],26:[function(require,module,exports){\nvar ifNumberThenCast\x3drequire("../../../helpers/if-number-then-cast");module.exports\x3dfunction(r,e){var n\x3difNumberThenCast(e);if(void 0\x3d\x3d\x3dn)return{};var a\x3d{value:n},t\x3dr.currency,u\x3dwindow.universal_variable;return!t\x26\x26u\x26\x26(t\x3du.basket\x26\x26u.basket.currency||u.transaction\x26\x26u.transaction.currency),t\x26\x26(a.currency\x3dt),a};\n\n\n},{"../../../helpers/if-number-then-cast":3}],27:[function(require,module,exports){\nvar pollFor\x3drequire("../../helpers/poll-for"),excludeEmpty\x3drequire("../../helpers/exclude-empty"),customListing\x3drequire("./helpers/custom-listing"),ifNumberThenCast\x3drequire("../../helpers/if-number-then-cast");module.exports\x3d{eventType:"Search",activation:function(e){function i(){return window.universal_variable\x26\x26window.universal_variable.listing\x26\x26window.universal_variable.listing.query\x26\x26window.universal_variable.listing.query.length}function r(){e(window.universal_variable.listing)}pollFor(i,r)},mapFn:function(e){return excludeEmpty({query:e.query,pagination:e.items.length,count:ifNumberThenCast(e.result_count),sortBy:e.sort_by,layout:e.layout,custom:customListing(e)})}};\n\n\n},{"../../helpers/exclude-empty":2,"../../helpers/if-number-then-cast":3,"../../helpers/poll-for":4,"./helpers/custom-listing":19}],28:[function(require,module,exports){\nvar pollFor\x3drequire("../../helpers/poll-for"),excludeEmpty\x3drequire("../../helpers/exclude-empty"),convertUser\x3drequire("./helpers/convert-user"),customUser\x3drequire("./helpers/custom-user");module.exports\x3d{eventType:"User",activation:function(e){function r(){return window.universal_variable\x26\x26window.universal_variable.user}function u(){e(window.universal_variable.user)}pollFor(r,u)},mapFn:function(e){return excludeEmpty({user:convertUser(e),custom:customUser(e)})}};\n\n\n},{"../../helpers/exclude-empty":2,"../../helpers/poll-for":4,"./helpers/convert-user":16,"./helpers/custom-user":23}],29:[function(require,module,exports){\nvar getCategory\x3drequire("./helpers/get-category"),customPage\x3drequire("./helpers/custom-page"),excludeEmpty\x3drequire("../../helpers/exclude-empty");module.exports\x3d{eventType:"View",activation:function(e){window.universal_variable\x26\x26window.universal_variable.page?e(window.universal_variable.page):e()},mapFn:function(e){return e?excludeEmpty({type:e.type||e.category,category:getCategory(window.universal_variable.page),environment:e.environment,custom:customPage(e)}):{}}};\n\n\n},{"../../helpers/exclude-empty":2,"./helpers/custom-page":20,"./helpers/get-category":25}],30:[function(require,module,exports){\nvar filter\x3drequire("amp-filter"),flatten\x3drequire("amp-internal-flatten"),contains\x3drequire("amp-contains");module.exports\x3dfunction(t){var e\x3dflatten(arguments,!0,!0,1);return filter(t,function(t){return!contains(e,t)})};\n\n\n},{"amp-contains":31,"amp-filter":51,"amp-internal-flatten":33}],31:[function(require,module,exports){\nvar values\x3drequire("amp-values"),indexOf\x3drequire("amp-index-of");module.exports\x3dfunction(e,n){return null\x3d\x3de?!1:(e.length!\x3d\x3d+e.length\x26\x26(e\x3dvalues(e)),indexOf(e,n)\x3e\x3d0)};\n\n\n},{"amp-index-of":32,"amp-values":103}],32:[function(require,module,exports){\nvar isNumber\x3drequire("amp-is-number");module.exports\x3dfunction(r,e,u){var i\x3d0,m\x3dr\x26\x26r.length;for(isNumber(u)\x26\x26(i\x3d0\x3eu?Math.max(0,m+u):u);m\x3ei;i++)if(r[i]\x3d\x3d\x3de)return i;return-1};\n\n\n},{"amp-is-number":68}],33:[function(require,module,exports){\nvar isArray\x3drequire("amp-is-array"),isArguments\x3drequire("amp-is-arguments"),flatten\x3dfunction r(e,t,a,n){for(var s,i\x3d[],l\x3d0,u\x3dn||0,g\x3de\x26\x26e.length;g\x3eu;u++)if(s\x3de[u],s\x26\x26s.length\x3e\x3d0\x26\x26(isArray(s)||isArguments(s))){t||(s\x3dr(s,t,a));var f\x3d0,m\x3ds.length;for(i.length+\x3dm;m\x3ef;)i[l++]\x3ds[f++]}else a||(i[l++]\x3ds);return i};module.exports\x3dflatten;\n\n\n},{"amp-is-arguments":34,"amp-is-array":35}],34:[function(require,module,exports){\nvar toString\x3dObject.prototype.toString,hasOwn\x3dObject.prototype.hasOwnProperty,isArgs\x3dfunction(t){return"[object Arguments]"\x3d\x3d\x3dtoString.call(t)};isArgs(arguments)||(isArgs\x3dfunction(t){return t\x26\x26hasOwn.call(t,"callee")}),module.exports\x3disArgs;\n\n\n},{}],35:[function(require,module,exports){\nvar toString\x3dObject.prototype.toString,nativeIsArray\x3dArray.isArray;module.exports\x3dnativeIsArray||function(r){return"[object Array]"\x3d\x3d\x3dtoString.call(r)};\n\n\n},{}],36:[function(require,module,exports){\nvar objKeys\x3drequire("amp-keys"),createCallback\x3drequire("amp-create-callback");module.exports\x3dfunction(e,r,a){if(null\x3d\x3de)return e;r\x3dcreateCallback(r,a);var l,t\x3de.length;if(t\x3d\x3d\x3d+t)for(l\x3d0;t\x3el;l++)r(e[l],l,e);else{var c\x3dobjKeys(e);for(l\x3d0,t\x3dc.length;t\x3el;l++)r(e[c[l]],c[l],e)}return e};\n\n\n},{"amp-create-callback":37,"amp-keys":38}],37:[function(require,module,exports){\nmodule.exports\x3dfunction(n,r,t){if(void 0\x3d\x3d\x3dr)return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,u){return n.call(r,t,u)};case 3:return function(t,u,e){return n.call(r,t,u,e)};case 4:return function(t,u,e,c){return n.call(r,t,u,e,c)}}return function(){return n.apply(r,arguments)}};\n\n\n},{}],38:[function(require,module,exports){\nvar has\x3drequire("amp-has"),indexOf\x3drequire("amp-index-of"),isObject\x3drequire("amp-is-object"),nativeKeys\x3dObject.keys,hasEnumBug\x3d!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps\x3d["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];module.exports\x3dfunction(e){if(!isObject(e))return[];if(nativeKeys)return nativeKeys(e);var r\x3d[];for(var n in e)has(e,n)\x26\x26r.push(n);if(hasEnumBug)for(var t\x3dnonEnumerableProps.length;t--;){var a\x3dnonEnumerableProps[t];has(e,a)\x26\x26-1\x3d\x3d\x3dindexOf(r,a)\x26\x26r.push(a)}return r};\n\n\n},{"amp-has":39,"amp-index-of":40,"amp-is-object":41}],39:[function(require,module,exports){\nvar hasOwn\x3dObject.prototype.hasOwnProperty;module.exports\x3dfunction(n,r){return null!\x3dn\x26\x26hasOwn.call(n,r)};\n\n\n},{}],40:[function(require,module,exports){\nvar isNumber\x3drequire("amp-is-number");module.exports\x3dfunction(r,e,u){var i\x3d0,m\x3dr\x26\x26r.length;for(isNumber(u)\x26\x26(i\x3d0\x3eu?Math.max(0,m+u):u);m\x3ei;i++)if(r[i]\x3d\x3d\x3de)return i;return-1};\n\n\n},{"amp-is-number":68}],41:[function(require,module,exports){\nmodule.exports\x3dfunction(o){var t\x3dtypeof o;return!!o\x26\x26("function"\x3d\x3d\x3dt||"object"\x3d\x3d\x3dt)};\n\n\n},{}],42:[function(require,module,exports){\nvar objKeys\x3drequire("amp-keys"),iteratee\x3drequire("amp-iteratee");module.exports\x3dfunction(e,r,t){if(null\x3d\x3de)return!0;var n,i,u\x3de.length!\x3d\x3d+e.length\x26\x26objKeys(e),a\x3d(u||e).length;for(r\x3diteratee(r,t),n\x3d0;a\x3en;n++)if(i\x3du?u[n]:n,!r(e[i],i,e))return!1;return!0};\n\n\n},{"amp-iteratee":43,"amp-keys":71}],43:[function(require,module,exports){\nvar isFunction\x3drequire("amp-is-function"),isObject\x3drequire("amp-is-object"),createCallback\x3drequire("amp-create-callback"),matches\x3drequire("amp-matches"),property\x3drequire("amp-property"),identity\x3dfunction(e){return e};module.exports\x3dfunction(e,r,t){return null\x3d\x3de?identity:isFunction(e)?createCallback(e,r,t):isObject(e)?matches(e):property(e)};\n\n\n},{"amp-create-callback":44,"amp-is-function":45,"amp-is-object":69,"amp-matches":46,"amp-property":48}],44:[function(require,module,exports){\nmodule.exports\x3dfunction(n,r,t){if(void 0\x3d\x3d\x3dr)return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,u){return n.call(r,t,u)};case 3:return function(t,u,e){return n.call(r,t,u,e)};case 4:return function(t,u,e,c){return n.call(r,t,u,e,c)}}return function(){return n.apply(r,arguments)}};\n\n\n},{}],45:[function(require,module,exports){\nvar toString\x3dObject.prototype.toString,func\x3dfunction(t){return"[object Function]"\x3d\x3d\x3dtoString.call(t)};"function"!\x3dtypeof/./\x26\x26(func\x3dfunction(t){return"function"\x3d\x3dtypeof t||!1}),module.exports\x3dfunc;\n\n\n},{}],46:[function(require,module,exports){\nvar getPairs\x3drequire("amp-pairs");module.exports\x3dfunction(r){var e\x3dgetPairs(r),n\x3de.length;return function(r){if(null\x3d\x3dr)return!n;r\x3dnew Object(r);for(var t\x3d0;n\x3et;t++){var i\x3de[t],u\x3di[0];if(i[1]!\x3d\x3dr[u]||!(u in r))return!1}return!0}};\n\n\n},{"amp-pairs":47}],47:[function(require,module,exports){\nvar objKeys\x3drequire("amp-keys");module.exports\x3dfunction(r){for(var e\x3dobjKeys(r),o\x3de.length,a\x3dArray(o),n\x3d0;o\x3en;n++)a[n]\x3d[e[n],r[e[n]]];return a};\n\n\n},{"amp-keys":71}],48:[function(require,module,exports){\nmodule.exports\x3dfunction(n){return function(u){return null\x3d\x3du?void 0:u[n]}};\n\n\n},{}],49:[function(require,module,exports){\nvar isObject\x3drequire("amp-is-object");module.exports\x3dfunction(r){if(!isObject(r))return r;for(var e,t,n\x3d1,i\x3darguments.length;i\x3en;n++){e\x3darguments[n];for(t in e)r[t]\x3de[t]}return r};\n\n\n},{"amp-is-object":50}],50:[function(require,module,exports){\nmodule.exports\x3dfunction(o){var t\x3dtypeof o;return!!o\x26\x26("function"\x3d\x3d\x3dt||"object"\x3d\x3d\x3dt)};\n\n\n},{}],51:[function(require,module,exports){\nvar iteratee\x3drequire("amp-iteratee"),each\x3drequire("amp-each");module.exports\x3dfunction(e,r,a){var t\x3d[];return null\x3d\x3de?t:(r\x3diteratee(r,a),each(e,function(e,a,u){r(e,a,u)\x26\x26t.push(e)}),t)};\n\n\n},{"amp-each":36,"amp-iteratee":52}],52:[function(require,module,exports){\nvar isFunction\x3drequire("amp-is-function"),isObject\x3drequire("amp-is-object"),createCallback\x3drequire("amp-create-callback"),matches\x3drequire("amp-matches"),property\x3drequire("amp-property"),identity\x3dfunction(e){return e};module.exports\x3dfunction(e,r,t){return null\x3d\x3de?identity:isFunction(e)?createCallback(e,r,t):isObject(e)?matches(e):property(e)};\n\n\n},{"amp-create-callback":53,"amp-is-function":54,"amp-is-object":69,"amp-matches":55,"amp-property":57}],53:[function(require,module,exports){\nmodule.exports\x3dfunction(n,r,t){if(void 0\x3d\x3d\x3dr)return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,u){return n.call(r,t,u)};case 3:return function(t,u,e){return n.call(r,t,u,e)};case 4:return function(t,u,e,c){return n.call(r,t,u,e,c)}}return function(){return n.apply(r,arguments)}};\n\n\n},{}],54:[function(require,module,exports){\nvar toString\x3dObject.prototype.toString,func\x3dfunction(t){return"[object Function]"\x3d\x3d\x3dtoString.call(t)};"function"!\x3dtypeof/./\x26\x26(func\x3dfunction(t){return"function"\x3d\x3dtypeof t||!1}),module.exports\x3dfunc;\n\n\n},{}],55:[function(require,module,exports){\nvar getPairs\x3drequire("amp-pairs");module.exports\x3dfunction(r){var e\x3dgetPairs(r),n\x3de.length;return function(r){if(null\x3d\x3dr)return!n;r\x3dnew Object(r);for(var t\x3d0;n\x3et;t++){var i\x3de[t],u\x3di[0];if(i[1]!\x3d\x3dr[u]||!(u in r))return!1}return!0}};\n\n\n},{"amp-pairs":56}],56:[function(require,module,exports){\nvar objKeys\x3drequire("amp-keys");module.exports\x3dfunction(r){for(var e\x3dobjKeys(r),o\x3de.length,a\x3dArray(o),n\x3d0;o\x3en;n++)a[n]\x3d[e[n],r[e[n]]];return a};\n\n\n},{"amp-keys":71}],57:[function(require,module,exports){\nmodule.exports\x3dfunction(n){return function(u){return null\x3d\x3du?void 0:u[n]}};\n\n\n},{}],58:[function(require,module,exports){\nvar toString\x3dObject.prototype.toString,nativeIsArray\x3dArray.isArray;module.exports\x3dnativeIsArray||function(r){return"[object Array]"\x3d\x3d\x3dtoString.call(r)};\n\n\n},{}],59:[function(require,module,exports){\nvar toString\x3dObject.prototype.toString;module.exports\x3dfunction(t){return t\x3d\x3d\x3d!0||t\x3d\x3d\x3d!1||"[object Boolean]"\x3d\x3d\x3dtoString.call(t)};\n\n\n},{}],60:[function(require,module,exports){\nvar isArray\x3drequire("amp-is-array"),isString\x3drequire("amp-is-string"),isArguments\x3drequire("amp-is-arguments"),isNumber\x3drequire("amp-is-number"),isNan\x3drequire("amp-is-nan"),keys\x3drequire("amp-keys");module.exports\x3dfunction(r){return null\x3d\x3dr?!0:isArray(r)||isString(r)||isArguments(r)?0\x3d\x3d\x3dr.length:isNumber(r)?0\x3d\x3d\x3dr||isNan(r):0!\x3d\x3dkeys(r).length?!1:!0};\n\n\n},{"amp-is-arguments":61,"amp-is-array":62,"amp-is-nan":63,"amp-is-number":68,"amp-is-string":70,"amp-keys":64}],61:[function(require,module,exports){\nvar toString\x3dObject.prototype.toString,hasOwn\x3dObject.prototype.hasOwnProperty,isArgs\x3dfunction(t){return"[object Arguments]"\x3d\x3d\x3dtoString.call(t)};isArgs(arguments)||(isArgs\x3dfunction(t){return t\x26\x26hasOwn.call(t,"callee")}),module.exports\x3disArgs;\n\n\n},{}],62:[function(require,module,exports){\nvar toString\x3dObject.prototype.toString,nativeIsArray\x3dArray.isArray;module.exports\x3dnativeIsArray||function(r){return"[object Array]"\x3d\x3d\x3dtoString.call(r)};\n\n\n},{}],63:[function(require,module,exports){\nvar isNumber\x3drequire("amp-is-number");module.exports\x3dfunction(r){return isNumber(r)\x26\x26r!\x3d\x3d+r};\n\n\n},{"amp-is-number":68}],64:[function(require,module,exports){\nvar has\x3drequire("amp-has"),indexOf\x3drequire("amp-index-of"),isObject\x3drequire("amp-is-object"),nativeKeys\x3dObject.keys,hasEnumBug\x3d!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps\x3d["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];module.exports\x3dfunction(e){if(!isObject(e))return[];if(nativeKeys)return nativeKeys(e);var r\x3d[];for(var n in e)has(e,n)\x26\x26r.push(n);if(hasEnumBug)for(var t\x3dnonEnumerableProps.length;t--;){var a\x3dnonEnumerableProps[t];has(e,a)\x26\x26-1\x3d\x3d\x3dindexOf(r,a)\x26\x26r.push(a)}return r};\n\n\n},{"amp-has":65,"amp-index-of":66,"amp-is-object":67}],65:[function(require,module,exports){\nvar hasOwn\x3dObject.prototype.hasOwnProperty;module.exports\x3dfunction(n,r){return null!\x3dn\x26\x26hasOwn.call(n,r)};\n\n\n},{}],66:[function(require,module,exports){\nvar isNumber\x3drequire("amp-is-number");module.exports\x3dfunction(r,e,u){var i\x3d0,m\x3dr\x26\x26r.length;for(isNumber(u)\x26\x26(i\x3d0\x3eu?Math.max(0,m+u):u);m\x3ei;i++)if(r[i]\x3d\x3d\x3de)return i;return-1};\n\n\n},{"amp-is-number":68}],67:[function(require,module,exports){\nmodule.exports\x3dfunction(o){var t\x3dtypeof o;return!!o\x26\x26("function"\x3d\x3d\x3dt||"object"\x3d\x3d\x3dt)};\n\n\n},{}],68:[function(require,module,exports){\nvar toString\x3dObject.prototype.toString;module.exports\x3dfunction(t){return"[object Number]"\x3d\x3d\x3dtoString.call(t)};\n\n\n},{}],69:[function(require,module,exports){\nmodule.exports\x3dfunction(o){var t\x3dtypeof o;return!!o\x26\x26("function"\x3d\x3d\x3dt||"object"\x3d\x3d\x3dt)};\n\n\n},{}],70:[function(require,module,exports){\nvar toString\x3dObject.prototype.toString;module.exports\x3dfunction(t){return"[object String]"\x3d\x3d\x3dtoString.call(t)};\n\n\n},{}],71:[function(require,module,exports){\nvar has\x3drequire("amp-has"),indexOf\x3drequire("amp-index-of"),isObject\x3drequire("amp-is-object"),nativeKeys\x3dObject.keys,hasEnumBug\x3d!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps\x3d["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];module.exports\x3dfunction(e){if(!isObject(e))return[];if(nativeKeys)return nativeKeys(e);var r\x3d[];for(var n in e)has(e,n)\x26\x26r.push(n);if(hasEnumBug)for(var t\x3dnonEnumerableProps.length;t--;){var a\x3dnonEnumerableProps[t];has(e,a)\x26\x26-1\x3d\x3d\x3dindexOf(r,a)\x26\x26r.push(a)}return r};\n\n\n},{"amp-has":72,"amp-index-of":73,"amp-is-object":74}],72:[function(require,module,exports){\nvar hasOwn\x3dObject.prototype.hasOwnProperty;module.exports\x3dfunction(n,r){return null!\x3dn\x26\x26hasOwn.call(n,r)};\n\n\n},{}],73:[function(require,module,exports){\nvar isNumber\x3drequire("amp-is-number");module.exports\x3dfunction(r,e,u){var i\x3d0,m\x3dr\x26\x26r.length;for(isNumber(u)\x26\x26(i\x3d0\x3eu?Math.max(0,m+u):u);m\x3ei;i++)if(r[i]\x3d\x3d\x3de)return i;return-1};\n\n\n},{"amp-is-number":68}],74:[function(require,module,exports){\nmodule.exports\x3dfunction(o){var t\x3dtypeof o;return!!o\x26\x26("function"\x3d\x3d\x3dt||"object"\x3d\x3d\x3dt)};\n\n\n},{}],75:[function(require,module,exports){\nvar createIteratee\x3drequire("amp-iteratee"),objKeys\x3drequire("amp-keys");module.exports\x3dfunction(e,r,t){if(null\x3d\x3de)return[];r\x3dcreateIteratee(r,t,3);for(var a,n\x3de.length!\x3d\x3d+e.length\x26\x26objKeys(e),u\x3d(n||e).length,l\x3dArray(u),o\x3d0;u\x3eo;o++)a\x3dn?n[o]:o,l[o]\x3dr(e[a],a,e);return l};\n\n\n},{"amp-iteratee":76,"amp-keys":83}],76:[function(require,module,exports){\nvar isFunction\x3drequire("amp-is-function"),isObject\x3drequire("amp-is-object"),createCallback\x3drequire("amp-create-callback"),matches\x3drequire("amp-matches"),property\x3drequire("amp-property"),identity\x3dfunction(e){return e};module.exports\x3dfunction(e,r,t){return null\x3d\x3de?identity:isFunction(e)?createCallback(e,r,t):isObject(e)?matches(e):property(e)};\n\n\n},{"amp-create-callback":77,"amp-is-function":78,"amp-is-object":79,"amp-matches":80,"amp-property":82}],77:[function(require,module,exports){\nmodule.exports\x3dfunction(n,r,t){if(void 0\x3d\x3d\x3dr)return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,u){return n.call(r,t,u)};case 3:return function(t,u,e){return n.call(r,t,u,e)};case 4:return function(t,u,e,c){return n.call(r,t,u,e,c)}}return function(){return n.apply(r,arguments)}};\n\n\n},{}],78:[function(require,module,exports){\nvar toString\x3dObject.prototype.toString,func\x3dfunction(t){return"[object Function]"\x3d\x3d\x3dtoString.call(t)};"function"!\x3dtypeof/./\x26\x26(func\x3dfunction(t){return"function"\x3d\x3dtypeof t||!1}),module.exports\x3dfunc;\n\n\n},{}],79:[function(require,module,exports){\nmodule.exports\x3dfunction(o){var t\x3dtypeof o;return!!o\x26\x26("function"\x3d\x3d\x3dt||"object"\x3d\x3d\x3dt)};\n\n\n},{}],80:[function(require,module,exports){\nvar getPairs\x3drequire("amp-pairs");module.exports\x3dfunction(r){var e\x3dgetPairs(r),n\x3de.length;return function(r){if(null\x3d\x3dr)return!n;r\x3dnew Object(r);for(var t\x3d0;n\x3et;t++){var i\x3de[t],u\x3di[0];if(i[1]!\x3d\x3dr[u]||!(u in r))return!1}return!0}};\n\n\n},{"amp-pairs":81}],81:[function(require,module,exports){\nvar objKeys\x3drequire("amp-keys");module.exports\x3dfunction(r){for(var e\x3dobjKeys(r),o\x3de.length,a\x3dArray(o),n\x3d0;o\x3en;n++)a[n]\x3d[e[n],r[e[n]]];return a};\n\n\n},{"amp-keys":83}],82:[function(require,module,exports){\nmodule.exports\x3dfunction(n){return function(u){return null\x3d\x3du?void 0:u[n]}};\n\n\n},{}],83:[function(require,module,exports){\nvar has\x3drequire("amp-has"),indexOf\x3drequire("amp-index-of"),isObject\x3drequire("amp-is-object"),nativeKeys\x3dObject.keys,hasEnumBug\x3d!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps\x3d["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];module.exports\x3dfunction(e){if(!isObject(e))return[];if(nativeKeys)return nativeKeys(e);var r\x3d[];for(var n in e)has(e,n)\x26\x26r.push(n);if(hasEnumBug)for(var t\x3dnonEnumerableProps.length;t--;){var a\x3dnonEnumerableProps[t];has(e,a)\x26\x26-1\x3d\x3d\x3dindexOf(r,a)\x26\x26r.push(a)}return r};\n\n\n},{"amp-has":84,"amp-index-of":85,"amp-is-object":86}],84:[function(require,module,exports){\nvar hasOwn\x3dObject.prototype.hasOwnProperty;module.exports\x3dfunction(n,r){return null!\x3dn\x26\x26hasOwn.call(n,r)};\n\n\n},{}],85:[function(require,module,exports){\nvar isNumber\x3drequire("amp-is-number");module.exports\x3dfunction(r,e,u){var i\x3d0,m\x3dr\x26\x26r.length;for(isNumber(u)\x26\x26(i\x3d0\x3eu?Math.max(0,m+u):u);m\x3ei;i++)if(r[i]\x3d\x3d\x3de)return i;return-1};\n\n\n},{"amp-is-number":68}],86:[function(require,module,exports){\nmodule.exports\x3dfunction(o){var t\x3dtypeof o;return!!o\x26\x26("function"\x3d\x3d\x3dt||"object"\x3d\x3d\x3dt)};\n\n\n},{}],87:[function(require,module,exports){\nmodule.exports\x3dfunction(n,r,t){if(void 0\x3d\x3d\x3dr)return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,u){return n.call(r,t,u)};case 3:return function(t,u,e){return n.call(r,t,u,e)};case 4:return function(t,u,e,c){return n.call(r,t,u,e,c)}}return function(){return n.apply(r,arguments)}};\n\n\n},{}],88:[function(require,module,exports){\nvar isArray\x3drequire("amp-is-array"),isArguments\x3drequire("amp-is-arguments"),flatten\x3dfunction r(e,t,a,n){for(var s,i\x3d[],l\x3d0,u\x3dn||0,g\x3de\x26\x26e.length;g\x3eu;u++)if(s\x3de[u],s\x26\x26s.length\x3e\x3d0\x26\x26(isArray(s)||isArguments(s))){t||(s\x3dr(s,t,a));var f\x3d0,m\x3ds.length;for(i.length+\x3dm;m\x3ef;)i[l++]\x3ds[f++]}else a||(i[l++]\x3ds);return i};module.exports\x3dflatten;\n\n\n},{"amp-is-arguments":89,"amp-is-array":90}],89:[function(require,module,exports){\nvar toString\x3dObject.prototype.toString,hasOwn\x3dObject.prototype.hasOwnProperty,isArgs\x3dfunction(t){return"[object Arguments]"\x3d\x3d\x3dtoString.call(t)};isArgs(arguments)||(isArgs\x3dfunction(t){return t\x26\x26hasOwn.call(t,"callee")}),module.exports\x3disArgs;\n\n\n},{}],90:[function(require,module,exports){\nvar toString\x3dObject.prototype.toString,nativeIsArray\x3dArray.isArray;module.exports\x3dnativeIsArray||function(r){return"[object Array]"\x3d\x3d\x3dtoString.call(r)};\n\n\n},{}],91:[function(require,module,exports){\nvar toString\x3dObject.prototype.toString,func\x3dfunction(t){return"[object Function]"\x3d\x3d\x3dtoString.call(t)};"function"!\x3dtypeof/./\x26\x26(func\x3dfunction(t){return"function"\x3d\x3dtypeof t||!1}),module.exports\x3dfunc;\n\n\n},{}],92:[function(require,module,exports){\nvar createCallback\x3drequire("amp-create-callback"),isFunction\x3drequire("amp-is-function"),flatten\x3drequire("amp-internal-flatten");module.exports\x3dfunction(e,r,a){var n,t\x3d{};if(null\x3d\x3de)return t;if(isFunction(r)){r\x3dcreateCallback(r,a);for(n in e){var i\x3de[n];r(i,n,e)\x26\x26(t[n]\x3di)}}else{var l\x3dflatten(arguments,!1,!1,1);e\x3dnew Object(e);for(var c\x3d0,u\x3dl.length;u\x3ec;c++)n\x3dl[c],n in e\x26\x26(t[n]\x3de[n])}return t};\n\n\n},{"amp-create-callback":87,"amp-internal-flatten":88,"amp-is-function":91}],93:[function(require,module,exports){\nmodule.exports\x3dfunction(n,r,t){if(void 0\x3d\x3d\x3dr)return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,u){return n.call(r,t,u)};case 3:return function(t,u,e){return n.call(r,t,u,e)};case 4:return function(t,u,e,c){return n.call(r,t,u,e,c)}}return function(){return n.apply(r,arguments)}};\n\n\n},{}],94:[function(require,module,exports){\nvar has\x3drequire("amp-has"),indexOf\x3drequire("amp-index-of"),isObject\x3drequire("amp-is-object"),nativeKeys\x3dObject.keys,hasEnumBug\x3d!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps\x3d["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];module.exports\x3dfunction(e){if(!isObject(e))return[];if(nativeKeys)return nativeKeys(e);var r\x3d[];for(var n in e)has(e,n)\x26\x26r.push(n);if(hasEnumBug)for(var t\x3dnonEnumerableProps.length;t--;){var a\x3dnonEnumerableProps[t];has(e,a)\x26\x26-1\x3d\x3d\x3dindexOf(r,a)\x26\x26r.push(a)}return r};\n\n\n},{"amp-has":95,"amp-index-of":96,"amp-is-object":97}],95:[function(require,module,exports){\nvar hasOwn\x3dObject.prototype.hasOwnProperty;module.exports\x3dfunction(n,r){return null!\x3dn\x26\x26hasOwn.call(n,r)};\n\n\n},{}],96:[function(require,module,exports){\nvar isNumber\x3drequire("amp-is-number");module.exports\x3dfunction(r,e,u){var i\x3d0,m\x3dr\x26\x26r.length;for(isNumber(u)\x26\x26(i\x3d0\x3eu?Math.max(0,m+u):u);m\x3ei;i++)if(r[i]\x3d\x3d\x3de)return i;return-1};\n\n\n},{"amp-is-number":68}],97:[function(require,module,exports){\nmodule.exports\x3dfunction(o){var t\x3dtypeof o;return!!o\x26\x26("function"\x3d\x3d\x3dt||"object"\x3d\x3d\x3dt)};\n\n\n},{}],98:[function(require,module,exports){\nvar createCallback\x3drequire("amp-create-callback"),objKeys\x3drequire("amp-keys");module.exports\x3dfunction(e,r,a,l){null\x3d\x3de\x26\x26(e\x3d[]),r\x3dcreateCallback(r,l,4);var t,n\x3de.length!\x3d\x3d+e.length\x26\x26objKeys(e),o\x3d(n||e).length,c\x3d0;if(arguments.length\x3c3){if(!o)throw new TypeError("Reduce of empty array with no initial value");a\x3de[n?n[c++]:c++]}for(;o\x3ec;c++)t\x3dn?n[c]:c,a\x3dr(a,e[t],t,e);return a};\n\n\n},{"amp-create-callback":93,"amp-keys":94}],99:[function(require,module,exports){\nvar has\x3drequire("amp-has"),indexOf\x3drequire("amp-index-of"),isObject\x3drequire("amp-is-object"),nativeKeys\x3dObject.keys,hasEnumBug\x3d!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps\x3d["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];module.exports\x3dfunction(e){if(!isObject(e))return[];if(nativeKeys)return nativeKeys(e);var r\x3d[];for(var n in e)has(e,n)\x26\x26r.push(n);if(hasEnumBug)for(var t\x3dnonEnumerableProps.length;t--;){var a\x3dnonEnumerableProps[t];has(e,a)\x26\x26-1\x3d\x3d\x3dindexOf(r,a)\x26\x26r.push(a)}return r};\n\n\n},{"amp-has":100,"amp-index-of":101,"amp-is-object":102}],100:[function(require,module,exports){\nvar hasOwn\x3dObject.prototype.hasOwnProperty;module.exports\x3dfunction(n,r){return null!\x3dn\x26\x26hasOwn.call(n,r)};\n\n\n},{}],101:[function(require,module,exports){\nvar isNumber\x3drequire("amp-is-number");module.exports\x3dfunction(r,e,u){var i\x3d0,m\x3dr\x26\x26r.length;for(isNumber(u)\x26\x26(i\x3d0\x3eu?Math.max(0,m+u):u);m\x3ei;i++)if(r[i]\x3d\x3d\x3de)return i;return-1};\n\n\n},{"amp-is-number":68}],102:[function(require,module,exports){\nmodule.exports\x3dfunction(o){var t\x3dtypeof o;return!!o\x26\x26("function"\x3d\x3d\x3dt||"object"\x3d\x3d\x3dt)};\n\n\n},{}],103:[function(require,module,exports){\nvar oKeys\x3drequire("amp-keys");module.exports\x3dfunction(r){for(var e\x3doKeys(r),o\x3de.length,a\x3dArray(o),n\x3d0;o\x3en;n++)a[n]\x3dr[e[n]];return a};\n\n\n},{"amp-keys":99}],104:[function(require,module,exports){\nmodule.exports\x3dfunction(r){return r.charAt(0).toUpperCase()+r.substring(1)},module.exports.words\x3dfunction(r){return r.replace(/(^|\\W)(\\w)/g,function(r){return r.toUpperCase()})};\n\n\n},{}],105:[function(require,module,exports){\nmodule.exports\x3dfunction(r){for(var e\x3d5381,o\x3dr.length;o;)e\x3d33*e^r.charCodeAt(--o);return e\x3e\x3d0?e:(2147483647\x26e)+2147483648};\n\n\n},{}],106:[function(require,module,exports){\nfunction uniqueId(){return[randomInt(),hammerTime(),fingerPrintId()].join("-")}function randomInt(){var n\x3dMath.round(1e17);return format(Math.round(1e17*Math.random()),n)}function hammerTime(){var n\x3dnew Date;return n.setFullYear("2239"),format((new Date).getTime(),n.getTime())}function fingerPrintId(){var n\x3dMath.pow(2,32)-1,r\x3dmap(navigator.plugins,function(n){return n.description}).join(""),t\x3dnavigator.userAgent+document.cookie+r;return format(hash(t),n)}function format(n,r){return pad(n.toString(36),r.toString(36).length)}function pad(n,r){function t(n){var r\x3dMath.max(n+1,1),t\x3dnew Array(r);return t.join("0")}return t(r-String(n).length)+n}var hash\x3drequire("string-hash"),map\x3drequire("amp-map");module.exports\x3duniqueId;\n\n\n},{"amp-map":75,"string-hash":105}]},{},[5]);\n\n\x3c/script\x3e';
tag.addClientFiltersList(["live.filters.Uv_mapper_qprotocol"]);tag.addClientVariablesMap({});tag.addParameters([]);tag.genericDependencies=[];tag.addClientDependenciesList([]);tag.pre=function(){};tag.script=function(){};tag.post=function(){}})();
(function(){var instance=qubit.opentag.Container;var container=new instance({"maxCookieLength":0,"cookieDomain":".farfetch.com","pingServerUrl":"","delayDocWrite":false,"name":"LIVE","gzip":true,"disabled":false,"tellLoadTimesProbability":1,"containerId":1640858});var pkg="live.Container";qubit.Define.clientNamespace(pkg,container)})();(function(){try{qubit.opentag.Main.run()}catch(ex$$0){try{console.error("Errors during opentag main runtime.",ex$$0)}catch(ex){}}})();