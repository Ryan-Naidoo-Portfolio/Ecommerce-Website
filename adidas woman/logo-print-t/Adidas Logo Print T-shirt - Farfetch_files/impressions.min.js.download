FFAPI.plugins=FFAPI.plugins||{},FFAPI.plugins.adsHandler={constants:{ADS_SELECTOR:"js-ad",GOOGLE_TAG:"https://www.googletagservices.com/tag/js/gpt.js",DFP_ACCOUNT_ID:"28275802",SETUP_ADS_TID:"1305"},pubAdService:null,ads:[],prebidConfig:null,shouldSetAdsTargeting:"product"===universal_variable.page.pageId,init:function(){var e=window.config&&window.config.mockCms;this.ads=[].slice.call(document.getElementsByClassName(this.constants.ADS_SELECTOR));try{this.prebidConfig=JSON.parse(FFAPI.variables.prebidConfig)}catch(e){}this.loadNativeAdStyles(),e?this.displayMockedAds():(this.loadGoogleTag(),this.shouldSetAdsTargeting&&!universal_variable.user?window.addEventListener("universal_variable.user",this.setupAds.bind(this)):this.setupAds())},loadNativeAdStyles:function(){if(this.ads.some(function(e){return"true"===e.getAttribute("data-native")})){var e=document.createElement("style");e.innerHTML=".ad-slot{top:0;bottom:0;left:0;right:0;}.ad-slot>div,.ad-slot>div>iframe{width:100%!important;height:100%!important;position:absolute;}",document.getElementsByTagName("script")[0].parentNode.appendChild(e)}},loadGoogleTag:function(){window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[];var e=document.createElement("script");e.async=!0,e.type="text/javascript",e.src=this.constants.GOOGLE_TAG,document.getElementsByTagName("script")[0].parentNode.appendChild(e)},setupAds:function(){var r=[];googletag.cmd.push(function(){googletag.pubads().disableInitialLoad()}),this.ads.forEach(function(t){var i=t.id,e=t.getAttribute("data-id"),a="true"===t.getAttribute("data-lazyload"),s=JSON.parse(t.getAttribute("data-adsizes")),n="/"+this.constants.DFP_ACCOUNT_ID+"/"+e;if(googletag.cmd.push(function(){this.pubAdService=this.pubAdService||googletag.pubads();var e=googletag.sizeMapping().addSize([0,0],s.xs).addSize([576,0],s.sm).addSize([960,0],s.md).addSize([1280,0],s.xl).build();googletag.defineSlot(n,s.xl,i).defineSizeMapping(e).addService(this.pubAdService),this.shouldSetAdsTargeting&&this.setAdsTargeting(),a&&this.pubAdService.enableLazyLoad({fetchMarginPercent:50}),this.pubAdService.enableSingleRequest(),this.pubAdService.collapseEmptyDivs(),googletag.enableServices(),googletag.display(t.id)}.bind(this)),FFAPI.variables.prebidFeature&&this.prebidConfig&&this.prebidConfig.adUnits){var d=this.prebidConfig.adUnits[e];d&&r.push(this.prebidBuildAdUnit(n,s,d))}},this),0===r.length?googletag.cmd.push(function(){googletag.pubads().refresh()}):(require(["prebid"]),this.prebidDisplayAds(r)),window.fftracker=window.fftracker||[],window.fftracker.push({type:"action",data:{tid:this.constants.SETUP_ADS_TID}})},prebidBuildAdUnit:function(e,t,i){return{code:e,mediaTypes:{banner:{sizes:t.xs.concat(t.sm).concat(t.md).concat(t.xl)}},bids:i}},prebidDisplayAds:function(t){function i(){pbjs.initAdserverSet||(pbjs.initAdserverSet=!0,googletag.cmd.push(function(){pbjs.que.push(function(){pbjs.setTargetingForGPTAsync(),googletag.pubads().refresh()})}))}window.pbjs=window.pbjs||{},pbjs.que=pbjs.que||[],pbjs.que.push(function(){pbjs.addAdUnits(t);var e=this.prebidConfig.priceBuckets;e&&pbjs.setConfig({priceGranularity:e}),pbjs.requestBids({bidsBackHandler:i})}.bind(this)),setTimeout(function(){i()},this.prebidConfig.timeout)},displayMockedAds:function(){this.ads.forEach(function(e){var t,i=JSON.parse(e.getAttribute("data-adsizes"))[FFAPI.responsive.format];1<i.length?t=i[Math.floor(Math.random()*i.length)]:t=i[0];document.getElementById(e.id).innerHTML='<div><iframe width="'+t[0]+'" height="'+t[1]+'"></div>'})},setAdsTargeting:function(){var e=window.universal_variable.page,t=window.universal_variable.product,i=window.universal_variable.user;if(this.pubAdService.setTargeting("browserLanguage",window.navigator.language||null),e&&this.pubAdService.setTargeting("language",e.locale||null),t){var a={};a.name=t.subCategory?t.subCategory:t.category||null,a.id=t.subCategoryId?t.subCategoryId:t.categoryId||null,this.pubAdService.setTargeting("designerName",t.designerName||null),this.pubAdService.setTargeting("designerId",t.designerId?t.designerId.toString():null),this.pubAdService.setTargeting("categoryName",a.name),this.pubAdService.setTargeting("categoryId",a.id.toString()),this.pubAdService.setTargeting("price",-1<["USD","GBP"].indexOf(t.currencyCode)&&t.unitSalePrice?t.unitSalePrice.toString()+" "+t.currencyCode:null)}this.pubAdService.setTargeting("loggedIn",i&&i.isLogged?"y":"n"),this.pubAdService.setTargeting("returning",i&&i.returning?"y":"n"),this.pubAdService.setTargeting("gender",e.contextGenderId?e.contextGenderId.toString():null)}},FFAPI.variables.customVariablesLoaded?FFAPI.plugins.adsHandler.init():window.events.on("FFAPIvariablesReady",function(){FFAPI.plugins.adsHandler.init()});